<!-- HTML header for doxygen 1.9.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AzeorthCore: D:/azerothcore-wotlk/src/server/game/Events/GameEventMgr.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeParagraphLink.init()
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../20147732.png"/></td>
  <td id="projectalign">
   <div id="projectname">AzeorthCore<span id="projectnumber">&#160;3.3.5a</span>
   </div>
   <div id="projectbrief">OpenSource WoW Emulator</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d7/d51/a01340_source.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">GameEventMgr.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="../../d7/d51/a01340.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">/*</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment"> * This file is part of the AzerothCore Project. See AUTHORS file for Copyright information</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment"> *</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="comment"> * This program is free software; you can redistribute it and/or modify it</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment"> * under the terms of the GNU Affero General Public License as published by the</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment"> * Free Software Foundation; either version 3 of the License, or (at your</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment"> * option) any later version.</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="comment"> *</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="comment"> * This program is distributed in the hope that it will be useful, but WITHOUT</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="comment"> * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="comment"> * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License for</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="comment"> * more details.</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="comment"> *</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="comment"> * You should have received a copy of the GNU General Public License along</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="comment"> * with this program. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="comment"> */</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span> </div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="preprocessor">#include &quot;<a class="code" href="../../d3/da4/a01343.html">GameEventMgr.h</a>&quot;</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="preprocessor">#include &quot;<a class="code" href="../../d7/d92/a00887.html">BattlegroundMgr.h</a>&quot;</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="preprocessor">#include &quot;<a class="code" href="../../d5/d67/a01070.html">DisableMgr.h</a>&quot;</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="preprocessor">#include &quot;<a class="code" href="../../d2/d94/a00716.html">GameObjectAI.h</a>&quot;</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="preprocessor">#include &quot;<a class="code" href="../../d1/dce/a02168.html">GameTime.h</a>&quot;</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="preprocessor">#include &quot;<a class="code" href="../../de/df1/a01151.html">GossipDef.h</a>&quot;</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="preprocessor">#include &quot;<a class="code" href="../../d4/d49/a01643.html">Language.h</a>&quot;</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="preprocessor">#include &quot;<a class="code" href="../../da/de0/a00317.html">Log.h</a>&quot;</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="preprocessor">#include &quot;<a class="code" href="../../d7/d29/a01589.html">MapMgr.h</a>&quot;</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="preprocessor">#include &quot;<a class="code" href="../../d8/d4e/a01355.html">ObjectMgr.h</a>&quot;</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="preprocessor">#include &quot;<a class="code" href="../../da/dd8/a01265.html">Player.h</a>&quot;</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="preprocessor">#include &quot;<a class="code" href="../../d7/d62/a01805.html">PoolMgr.h</a>&quot;</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="preprocessor">#include &quot;<a class="code" href="../../d3/d67/a01958.html">ScriptMgr.h</a>&quot;</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="preprocessor">#include &quot;<a class="code" href="../../d4/d49/a01316.html">Transport.h</a>&quot;</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="preprocessor">#include &quot;<a class="code" href="../../dd/d5c/a00752.html">UnitAI.h</a>&quot;</span></div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span><span class="preprocessor">#include &quot;<a class="code" href="../../d4/d1f/a00506.html">Util.h</a>&quot;</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span><span class="preprocessor">#include &quot;<a class="code" href="../../dc/d35/a02240.html">World.h</a>&quot;</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span><span class="preprocessor">#include &quot;<a class="code" href="../../d1/d39/a02048.html">WorldStatePackets.h</a>&quot;</span></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span><span class="preprocessor">#include &lt;time.h&gt;</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span> </div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno"><a class="line" href="../../d1/d78/a08256.html#a05276e1cc9758c37008cfafe14dec717">   38</a></span><a class="code hl_class" href="../../d1/d78/a08256.html">GameEventMgr</a>* <a class="code hl_function" href="../../d1/d78/a08256.html#a05276e1cc9758c37008cfafe14dec717">GameEventMgr::instance</a>()</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>{</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>    <span class="keyword">static</span> <a class="code hl_class" href="../../d1/d78/a08256.html">GameEventMgr</a> <a class="code hl_function" href="../../d1/d78/a08256.html#a05276e1cc9758c37008cfafe14dec717">instance</a>;</div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>    <span class="keywordflow">return</span> &amp;<a class="code hl_function" href="../../d1/d78/a08256.html#a05276e1cc9758c37008cfafe14dec717">instance</a>;</div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>}</div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span> </div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno"><a class="line" href="../../d1/d78/a08256.html#ac955ad9b948e13cde6de5f9f3dd01d03">   44</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="../../d1/d78/a08256.html#ac955ad9b948e13cde6de5f9f3dd01d03">GameEventMgr::CheckOneGameEvent</a>(<a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a> entry)<span class="keyword"> const</span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>    <span class="keywordflow">switch</span> (<a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[entry].state)</div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>    {</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>        <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5a0951d2c0686f93e6e7d0e002b4521921">GAMEEVENT_NORMAL</a>:</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>            {</div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>                time_t currenttime = <a class="code hl_function" href="../../d1/d55/a04496.html#adbe1785d1327dedf2ac403b7cc8e99c2">GameTime::GetGameTime</a>().count();</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>                <span class="comment">// Get the event information</span></div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>                <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[entry].start &lt; currenttime</div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>                       &amp;&amp; currenttime &lt; <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[entry].end</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>                       &amp;&amp; (currenttime - <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[entry].start) % (<a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[entry].occurence * <a class="code hl_variable" href="../../df/dc8/a00122.html#afacf27522adfacf698390ddafc53fa30">MINUTE</a>) &lt; <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[entry].length * <a class="code hl_variable" href="../../df/dc8/a00122.html#afacf27522adfacf698390ddafc53fa30">MINUTE</a>;</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>            }</div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>        <span class="comment">// if the state is conditions or nextphase, then the event should be active</span></div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5a627f133a79fe9018b98ee3646e334ff7">GAMEEVENT_WORLD_CONDITIONS</a>:</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5aa9ecd88c85a086ee5273110051a00bc0">GAMEEVENT_WORLD_NEXTPHASE</a>:</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>        <span class="comment">// finished world events are inactive</span></div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5a50f420580ff8bcf744a958e2613085bf">GAMEEVENT_WORLD_FINISHED</a>:</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5a2612ea68e0c9d21dae1af2e9ac04bc81">GAMEEVENT_INTERNAL</a>:</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>        <span class="comment">// if inactive world event, check the prerequisite events</span></div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5ac5c7f13cfd107dd2d1efb99ce8dd5136">GAMEEVENT_WORLD_INACTIVE</a>:</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>            {</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>                time_t currenttime = <a class="code hl_function" href="../../d1/d55/a04496.html#adbe1785d1327dedf2ac403b7cc8e99c2">GameTime::GetGameTime</a>().count();</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>                <span class="keywordflow">for</span> (std::set&lt;uint16&gt;::const_iterator itr = <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[entry].prerequisite_events.begin(); itr != <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[entry].prerequisite_events.end(); ++itr)</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>                {</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>                    <span class="keywordflow">if</span> ((<a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[*itr].state != <a class="code hl_enumvalue" href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5aa9ecd88c85a086ee5273110051a00bc0">GAMEEVENT_WORLD_NEXTPHASE</a> &amp;&amp; <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[*itr].state != <a class="code hl_enumvalue" href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5a50f420580ff8bcf744a958e2613085bf">GAMEEVENT_WORLD_FINISHED</a>) ||   <span class="comment">// if prereq not in nextphase or finished state, then can&#39;t start this one</span></div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>                            <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[*itr].nextstart &gt; currenttime)               <span class="comment">// if not in nextphase state for long enough, can&#39;t start this one</span></div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>                        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>                }</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>                <span class="comment">// all prerequisite events are met</span></div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>                <span class="comment">// but if there are no prerequisites, this can be only activated through gm command</span></div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>                <span class="keywordflow">return</span> !(<a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[entry].prerequisite_events.empty());</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>            }</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>    }</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>}</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span> </div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno"><a class="line" href="../../d1/d78/a08256.html#a0eb36f16c54cf394e57c862d3defc444">   82</a></span><a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> <a class="code hl_function" href="../../d1/d78/a08256.html#a0eb36f16c54cf394e57c862d3defc444">GameEventMgr::NextCheck</a>(<a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a> entry)<span class="keyword"> const</span></div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>    time_t currenttime = <a class="code hl_function" href="../../d1/d55/a04496.html#adbe1785d1327dedf2ac403b7cc8e99c2">GameTime::GetGameTime</a>().count();</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span> </div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>    <span class="comment">// for NEXTPHASE state world events, return the delay to start the next event, so the followup event will be checked correctly</span></div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>    <span class="keywordflow">if</span> ((<a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[entry].state == <a class="code hl_enumvalue" href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5aa9ecd88c85a086ee5273110051a00bc0">GAMEEVENT_WORLD_NEXTPHASE</a> || <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[entry].state == <a class="code hl_enumvalue" href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5a50f420580ff8bcf744a958e2613085bf">GAMEEVENT_WORLD_FINISHED</a>) &amp;&amp; <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[entry].nextstart &gt;= currenttime)</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>        <span class="keywordflow">return</span> <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>(<a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[entry].nextstart - currenttime);</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span> </div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>    <span class="comment">// for CONDITIONS state world events, return the length of the wait period, so if the conditions are met, this check will be called again to set the timer as NEXTPHASE event</span></div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[entry].state == <a class="code hl_enumvalue" href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5a627f133a79fe9018b98ee3646e334ff7">GAMEEVENT_WORLD_CONDITIONS</a>)</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>    {</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[entry].length)</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>            <span class="keywordflow">return</span> <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[entry].length * 60;</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>            <span class="keywordflow">return</span> <a class="code hl_define" href="../../d3/da4/a01343.html#adaa73d920934a951856f7ce003ce2342">max_ge_check_delay</a>;</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>    }</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span> </div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>    <span class="comment">// outdated event: we return max</span></div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>    <span class="keywordflow">if</span> (currenttime &gt; <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[entry].end)</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>        <span class="keywordflow">return</span> <a class="code hl_define" href="../../d3/da4/a01343.html#adaa73d920934a951856f7ce003ce2342">max_ge_check_delay</a>;</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span> </div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>    <span class="comment">// never started event, we return delay before start</span></div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[entry].start &gt; currenttime)</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>        <span class="keywordflow">return</span> <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>(<a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[entry].start - currenttime);</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span> </div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>    <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> delay;</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>    <span class="comment">// in event, we return the end of it</span></div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>    <span class="keywordflow">if</span> ((((currenttime - <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[entry].start) % (<a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[entry].occurence * 60)) &lt; (<a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[entry].length * 60)))</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>        <span class="comment">// we return the delay before it ends</span></div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>        delay = (<a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[entry].length * <a class="code hl_variable" href="../../df/dc8/a00122.html#afacf27522adfacf698390ddafc53fa30">MINUTE</a>) - ((currenttime - <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[entry].start) % (<a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[entry].occurence * <a class="code hl_variable" href="../../df/dc8/a00122.html#afacf27522adfacf698390ddafc53fa30">MINUTE</a>));</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>    <span class="keywordflow">else</span>                                                    <span class="comment">// not in window, we return the delay before next start</span></div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>        delay = (<a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[entry].occurence * <a class="code hl_variable" href="../../df/dc8/a00122.html#afacf27522adfacf698390ddafc53fa30">MINUTE</a>) - ((currenttime - <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[entry].start) % (<a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[entry].occurence * <a class="code hl_variable" href="../../df/dc8/a00122.html#afacf27522adfacf698390ddafc53fa30">MINUTE</a>));</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>    <span class="comment">// In case the end is before next check</span></div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[entry].end  &lt; time_t(currenttime + delay))</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>        <span class="keywordflow">return</span> <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>(<a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[entry].end - currenttime);</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>        <span class="keywordflow">return</span> delay;</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>}</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span> </div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno"><a class="line" href="../../d1/d78/a08256.html#a58234f75e541fdaeccc43ddd1c6b9c8b">  121</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d1/d78/a08256.html#a58234f75e541fdaeccc43ddd1c6b9c8b">GameEventMgr::StartInternalEvent</a>(<a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a> event_id)</div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>{</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>    <span class="keywordflow">if</span> (event_id &lt; 1 || event_id &gt;= <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>.size())</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span> </div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id].isValid())</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span> </div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d78/a08256.html#a177cd794e719b24cf1bc70fc7316a8e5">m_ActiveEvents</a>.find(event_id) != <a class="code hl_variable" href="../../d1/d78/a08256.html#a177cd794e719b24cf1bc70fc7316a8e5">m_ActiveEvents</a>.end())</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span> </div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>    <a class="code hl_function" href="../../d1/d78/a08256.html#a1a07f3fb3ac74ddb929d00a0c5078186">StartEvent</a>(event_id);</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>}</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span> </div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno"><a class="line" href="../../d1/d78/a08256.html#a1a07f3fb3ac74ddb929d00a0c5078186">  135</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="../../d1/d78/a08256.html#a1a07f3fb3ac74ddb929d00a0c5078186">GameEventMgr::StartEvent</a>(<a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a> event_id, <span class="keywordtype">bool</span> overwrite)</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>{</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="../../dd/d3c/a04466.html#a6673bbc719c96febfc86a4220a988ed0">DisableMgr::IsDisabledFor</a>(<a class="code hl_enumvalue" href="../../d5/d67/a01070.html#affa2a0d7ee61f6e1bc7c6cb7d2c1b64cad7a3460f1783f4ff25dfd3a6e5416ff0">DISABLE_TYPE_GAME_EVENT</a>, event_id, <span class="keyword">nullptr</span>) &amp;&amp; !overwrite)</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>    {</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>    }</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span> </div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>    <a class="code hl_struct" href="../../d8/dba/a08244.html">GameEventData</a>&amp; data = <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id];</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>    <span class="keywordflow">if</span> (data.<a class="code hl_variable" href="../../d8/dba/a08244.html#a54a6e90fd4b68093a99e32b198eab2fb">state</a> == <a class="code hl_enumvalue" href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5a0951d2c0686f93e6e7d0e002b4521921">GAMEEVENT_NORMAL</a> || data.<a class="code hl_variable" href="../../d8/dba/a08244.html#a54a6e90fd4b68093a99e32b198eab2fb">state</a> == <a class="code hl_enumvalue" href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5a2612ea68e0c9d21dae1af2e9ac04bc81">GAMEEVENT_INTERNAL</a>)</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>    {</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>        <a class="code hl_function" href="../../d1/d78/a08256.html#a51884149cf37ed74fa6c7a44f8a06a61">AddActiveEvent</a>(event_id);</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>        <a class="code hl_function" href="../../d1/d78/a08256.html#a65de367ad07e0033c356f3e4559c96b7">ApplyNewEvent</a>(event_id);</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>        <span class="keywordflow">if</span> (overwrite)</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>        {</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>            <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id].start = <a class="code hl_function" href="../../d1/d55/a04496.html#adbe1785d1327dedf2ac403b7cc8e99c2">GameTime::GetGameTime</a>().count();</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>            <span class="keywordflow">if</span> (data.<a class="code hl_variable" href="../../d8/dba/a08244.html#a1bf3980d02cd0dc304b2ffbd5afb7b9f">end</a> &lt;= data.<a class="code hl_variable" href="../../d8/dba/a08244.html#ac4da43ddbb3b95f00589f49ed250092d">start</a>)</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>                data.<a class="code hl_variable" href="../../d8/dba/a08244.html#a1bf3980d02cd0dc304b2ffbd5afb7b9f">end</a> = data.<a class="code hl_variable" href="../../d8/dba/a08244.html#ac4da43ddbb3b95f00589f49ed250092d">start</a> + data.<a class="code hl_variable" href="../../d8/dba/a08244.html#ac45297bad99ddb339b3aa18ec5912c1c">length</a>;</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>        }</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span> </div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d1/d78/a08256.html#a259b6e7b37520d0c23f06c6988e626c9">IsActiveEvent</a>(event_id))</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>            <a class="code hl_define" href="../../d3/d67/a01958.html#ae8161e629869974bc49b1cbfc73c1087">sScriptMgr</a>-&gt;OnGameEventStart(event_id);</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span> </div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>        <span class="comment">// When event is started, set its worldstate to current time</span></div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>        <span class="keyword">auto</span> itr = <a class="code hl_variable" href="../../d1/d78/a08256.html#aa3fc438e41a455a600381c2d4f0bdb11">_gameEventSeasonalQuestsMap</a>.find(event_id);</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>        <span class="keywordflow">if</span> (itr != <a class="code hl_variable" href="../../d1/d78/a08256.html#aa3fc438e41a455a600381c2d4f0bdb11">_gameEventSeasonalQuestsMap</a>.end() &amp;&amp; !itr-&gt;second.empty())</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>        {</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>            <a class="code hl_define" href="../../d3/d74/a04418.html#ga05dfb35c344e5b947a19e4284e7f5fa7">sWorld</a>-&gt;setWorldState(event_id, <a class="code hl_function" href="../../d1/d55/a04496.html#adbe1785d1327dedf2ac403b7cc8e99c2">GameTime::GetGameTime</a>().count());</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>        }</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span> </div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>    }</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>    {</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>        <span class="keywordflow">if</span> (data.<a class="code hl_variable" href="../../d8/dba/a08244.html#a54a6e90fd4b68093a99e32b198eab2fb">state</a> == <a class="code hl_enumvalue" href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5ac5c7f13cfd107dd2d1efb99ce8dd5136">GAMEEVENT_WORLD_INACTIVE</a>)</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>            <span class="comment">// set to conditions phase</span></div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>            data.<a class="code hl_variable" href="../../d8/dba/a08244.html#a54a6e90fd4b68093a99e32b198eab2fb">state</a> = <a class="code hl_enumvalue" href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5a627f133a79fe9018b98ee3646e334ff7">GAMEEVENT_WORLD_CONDITIONS</a>;</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span> </div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>        <span class="comment">// add to active events</span></div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>        <a class="code hl_function" href="../../d1/d78/a08256.html#a51884149cf37ed74fa6c7a44f8a06a61">AddActiveEvent</a>(event_id);</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>        <span class="comment">// add spawns</span></div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>        <a class="code hl_function" href="../../d1/d78/a08256.html#a65de367ad07e0033c356f3e4559c96b7">ApplyNewEvent</a>(event_id);</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span> </div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>        <span class="comment">// check if can go to next state</span></div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>        <span class="keywordtype">bool</span> conditions_met = <a class="code hl_function" href="../../d1/d78/a08256.html#a90cfd68d799f3ac60f7eaf6eaa867e01">CheckOneGameEventConditions</a>(event_id);</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>        <span class="comment">// save to db</span></div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>        <a class="code hl_function" href="../../d1/d78/a08256.html#a89b36d2ce1114ee9b9316aa1ce41ff41">SaveWorldEventStateToDB</a>(event_id);</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>        <span class="comment">// force game event update to set the update timer if conditions were met from a command</span></div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>        <span class="comment">// this update is needed to possibly start events dependent on the started one</span></div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>        <span class="comment">// or to scedule another update where the next event will be started</span></div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>        <span class="keywordflow">if</span> (overwrite &amp;&amp; conditions_met)</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>            <a class="code hl_define" href="../../d3/d74/a04418.html#ga05dfb35c344e5b947a19e4284e7f5fa7">sWorld</a>-&gt;ForceGameEventUpdate();</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span> </div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d1/d78/a08256.html#a259b6e7b37520d0c23f06c6988e626c9">IsActiveEvent</a>(event_id))</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>            <a class="code hl_define" href="../../d3/d67/a01958.html#ae8161e629869974bc49b1cbfc73c1087">sScriptMgr</a>-&gt;OnGameEventStart(event_id);</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span> </div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>        <span class="keywordflow">return</span> conditions_met;</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>    }</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>}</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span> </div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno"><a class="line" href="../../d1/d78/a08256.html#ad7b6407e4c5fd950446c22e4a82cdc64">  194</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d1/d78/a08256.html#ad7b6407e4c5fd950446c22e4a82cdc64">GameEventMgr::StopEvent</a>(<a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a> event_id, <span class="keywordtype">bool</span> overwrite)</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>{</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>    <a class="code hl_struct" href="../../d8/dba/a08244.html">GameEventData</a>&amp; data = <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id];</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>    <span class="keywordtype">bool</span> serverwide_evt = data.<a class="code hl_variable" href="../../d8/dba/a08244.html#a54a6e90fd4b68093a99e32b198eab2fb">state</a> != <a class="code hl_enumvalue" href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5a0951d2c0686f93e6e7d0e002b4521921">GAMEEVENT_NORMAL</a> &amp;&amp; data.<a class="code hl_variable" href="../../d8/dba/a08244.html#a54a6e90fd4b68093a99e32b198eab2fb">state</a> != <a class="code hl_enumvalue" href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5a2612ea68e0c9d21dae1af2e9ac04bc81">GAMEEVENT_INTERNAL</a>;</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span> </div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>    <a class="code hl_function" href="../../d1/d78/a08256.html#a348077472c4104a3a027f17e48fac77d">RemoveActiveEvent</a>(event_id);</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>    <a class="code hl_function" href="../../d1/d78/a08256.html#a35786821592979db6fe8b9df9176a359">UnApplyEvent</a>(event_id);</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span> </div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>     <span class="comment">// When event is stopped, clean up its worldstate</span></div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>    <a class="code hl_define" href="../../d3/d74/a04418.html#ga05dfb35c344e5b947a19e4284e7f5fa7">sWorld</a>-&gt;setWorldState(event_id, 0);</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span> </div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>    <span class="keywordflow">if</span> (overwrite &amp;&amp; !serverwide_evt)</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>    {</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>        data.<a class="code hl_variable" href="../../d8/dba/a08244.html#ac4da43ddbb3b95f00589f49ed250092d">start</a> = <a class="code hl_function" href="../../d1/d55/a04496.html#adbe1785d1327dedf2ac403b7cc8e99c2">GameTime::GetGameTime</a>().count() - data.<a class="code hl_variable" href="../../d8/dba/a08244.html#ac45297bad99ddb339b3aa18ec5912c1c">length</a> * <a class="code hl_variable" href="../../df/dc8/a00122.html#afacf27522adfacf698390ddafc53fa30">MINUTE</a>;</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>        <span class="keywordflow">if</span> (data.<a class="code hl_variable" href="../../d8/dba/a08244.html#a1bf3980d02cd0dc304b2ffbd5afb7b9f">end</a> &lt;= data.<a class="code hl_variable" href="../../d8/dba/a08244.html#ac4da43ddbb3b95f00589f49ed250092d">start</a>)</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>            data.<a class="code hl_variable" href="../../d8/dba/a08244.html#a1bf3980d02cd0dc304b2ffbd5afb7b9f">end</a> = data.<a class="code hl_variable" href="../../d8/dba/a08244.html#ac4da43ddbb3b95f00589f49ed250092d">start</a> + data.<a class="code hl_variable" href="../../d8/dba/a08244.html#ac45297bad99ddb339b3aa18ec5912c1c">length</a>;</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>    }</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (serverwide_evt)</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>    {</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>        <span class="comment">// if finished world event, then only gm command can stop it</span></div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>        <span class="keywordflow">if</span> (overwrite || data.<a class="code hl_variable" href="../../d8/dba/a08244.html#a54a6e90fd4b68093a99e32b198eab2fb">state</a> != <a class="code hl_enumvalue" href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5a50f420580ff8bcf744a958e2613085bf">GAMEEVENT_WORLD_FINISHED</a>)</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>        {</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>            <span class="comment">// reset conditions</span></div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>            data.<a class="code hl_variable" href="../../d8/dba/a08244.html#ae0259f021337b3ad47dfbbc1f361965f">nextstart</a> = 0;</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>            data.<a class="code hl_variable" href="../../d8/dba/a08244.html#a54a6e90fd4b68093a99e32b198eab2fb">state</a> = <a class="code hl_enumvalue" href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5ac5c7f13cfd107dd2d1efb99ce8dd5136">GAMEEVENT_WORLD_INACTIVE</a>;</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>            GameEventConditionMap::iterator itr;</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>            <span class="keywordflow">for</span> (itr = data.<a class="code hl_variable" href="../../d8/dba/a08244.html#adca87b4b2205273a29dd2a547be90da6">conditions</a>.begin(); itr != data.<a class="code hl_variable" href="../../d8/dba/a08244.html#adca87b4b2205273a29dd2a547be90da6">conditions</a>.end(); ++itr)</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>                itr-&gt;second.done = 0;</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span> </div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>            <a class="code hl_typedef" href="../../d0/d3e/a00566.html#a96bac9a371212c6bab7a9448214666c0">CharacterDatabaseTransaction</a> trans = <a class="code hl_variable" href="../../d9/d19/a00560.html#a7e7534bc66d79434bd280b77cb124eec">CharacterDatabase</a>.BeginTransaction();</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>            <a class="code hl_class" href="../../d4/dcb/a05336.html">CharacterDatabasePreparedStatement</a>* stmt = <a class="code hl_variable" href="../../d9/d19/a00560.html#a7e7534bc66d79434bd280b77cb124eec">CharacterDatabase</a>.GetPreparedStatement(<a class="code hl_enumvalue" href="../../dc/d25/a00596.html#a76116b4fa282d8e35bf8f8e940b5cba7a51c20332895bfb84502a43681c4eb711">CHAR_DEL_ALL_GAME_EVENT_CONDITION_SAVE</a>);</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>            stmt-&gt;<a class="code hl_function" href="../../d1/d06/a05468.html#a52fc2e65042c1db51f0923725a0f0ed0">SetData</a>(0, <a class="code hl_typedef" href="../../d1/da8/a00230.html#a15a8d014fadf85c99a2268d8cbd00767">uint8</a>(event_id));</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>            trans-&gt;Append(stmt);</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span> </div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>            stmt = <a class="code hl_variable" href="../../d9/d19/a00560.html#a7e7534bc66d79434bd280b77cb124eec">CharacterDatabase</a>.GetPreparedStatement(<a class="code hl_enumvalue" href="../../dc/d25/a00596.html#a76116b4fa282d8e35bf8f8e940b5cba7a1b1c3e937a709055b3e1b7a98100a9f9">CHAR_DEL_GAME_EVENT_SAVE</a>);</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>            stmt-&gt;<a class="code hl_function" href="../../d1/d06/a05468.html#a52fc2e65042c1db51f0923725a0f0ed0">SetData</a>(0, <a class="code hl_typedef" href="../../d1/da8/a00230.html#a15a8d014fadf85c99a2268d8cbd00767">uint8</a>(event_id));</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>            trans-&gt;Append(stmt);</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span> </div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>            <a class="code hl_variable" href="../../d9/d19/a00560.html#a7e7534bc66d79434bd280b77cb124eec">CharacterDatabase</a>.CommitTransaction(trans);</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>        }</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>    }</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span> </div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="../../d1/d78/a08256.html#a259b6e7b37520d0c23f06c6988e626c9">IsActiveEvent</a>(event_id))</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>        <a class="code hl_define" href="../../d3/d67/a01958.html#ae8161e629869974bc49b1cbfc73c1087">sScriptMgr</a>-&gt;OnGameEventStop(event_id);</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>}</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span> </div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno"><a class="line" href="../../d1/d78/a08256.html#a61419244efe985de58d3459749ec6c86">  240</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d1/d78/a08256.html#a61419244efe985de58d3459749ec6c86">GameEventMgr::LoadFromDB</a>()</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>{</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>    {</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>        <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> oldMSTime = <a class="code hl_function" href="../../d4/ddf/a00488.html#a4476c8e13ea790c3536f2749105f9cb9">getMSTime</a>();</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>        <span class="comment">//                                                    1                 2                           3                  4        5        6          7             8            9          10</span></div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>        <a class="code hl_typedef" href="../../d0/d3e/a00566.html#ab0c9feeec448a181290fcb39565b8253">QueryResult</a> result = <a class="code hl_variable" href="../../d9/d19/a00560.html#afa9a6509f9913c9c7dd3081523badd7c">WorldDatabase</a>.Query(<span class="stringliteral">&quot;SELECT eventEntry, UNIX_TIMESTAMP(start_time), UNIX_TIMESTAMP(end_time), occurence, length, holiday, holidayStage, description, world_event, announce FROM game_event&quot;</span>);</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>        <span class="keywordflow">if</span> (!result)</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>        {</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>            <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>.clear();</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>            <a class="code hl_define" href="../../da/de0/a00317.html#adf09840a666e1d86bcd3439105db6edc">LOG_WARN</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; Loaded 0 game events. DB table `game_event` is empty.&quot;</span>);</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>        }</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span> </div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>        <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> count = 0;</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>        <span class="keywordflow">do</span></div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>        {</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>            <a class="code hl_class" href="../../d3/d02/a05368.html">Field</a>* fields = result-&gt;Fetch();</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span> </div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>            <a class="code hl_typedef" href="../../d1/da8/a00230.html#a15a8d014fadf85c99a2268d8cbd00767">uint8</a> event_id = fields[0].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a15a8d014fadf85c99a2268d8cbd00767">uint8</a>&gt;();</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>            <span class="keywordflow">if</span> (event_id == 0)</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>            {</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>                <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;sql.sql&quot;</span>, <span class="stringliteral">&quot;`game_event` game event entry 0 is reserved and can&#39;t be used.&quot;</span>);</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>            }</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span> </div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>            <a class="code hl_struct" href="../../d8/dba/a08244.html">GameEventData</a>&amp; pGameEvent = <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id];</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>            pGameEvent.<a class="code hl_variable" href="../../d8/dba/a08244.html#a858501847212a8771f676641ad61aacd">eventId</a>      = fields[0].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>&gt;();</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>            <a class="code hl_typedef" href="../../d1/da8/a00230.html#ac4dd6ce78ce3b840c53bd4b3c63ed09b">uint64</a> starttime        = fields[1].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#ac4dd6ce78ce3b840c53bd4b3c63ed09b">uint64</a>&gt;();</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>            pGameEvent.<a class="code hl_variable" href="../../d8/dba/a08244.html#ac4da43ddbb3b95f00589f49ed250092d">start</a>        = time_t(starttime);</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>            <a class="code hl_typedef" href="../../d1/da8/a00230.html#ac4dd6ce78ce3b840c53bd4b3c63ed09b">uint64</a> endtime          = fields[2].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#ac4dd6ce78ce3b840c53bd4b3c63ed09b">uint64</a>&gt;();</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>            <span class="keywordflow">if</span> (fields[2].IsNull())</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>                endtime             = <a class="code hl_function" href="../../d1/d55/a04496.html#adbe1785d1327dedf2ac403b7cc8e99c2">GameTime::GetGameTime</a>().count() + 63072000; <span class="comment">// add 2 years to current date</span></div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>            pGameEvent.<a class="code hl_variable" href="../../d8/dba/a08244.html#a1bf3980d02cd0dc304b2ffbd5afb7b9f">end</a>          = time_t(endtime);</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>            pGameEvent.<a class="code hl_variable" href="../../d8/dba/a08244.html#a04c813525fef572000608f32650565ff">occurence</a>    = fields[3].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#ac4dd6ce78ce3b840c53bd4b3c63ed09b">uint64</a>&gt;();</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>            pGameEvent.<a class="code hl_variable" href="../../d8/dba/a08244.html#ac45297bad99ddb339b3aa18ec5912c1c">length</a>       = fields[4].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#ac4dd6ce78ce3b840c53bd4b3c63ed09b">uint64</a>&gt;();</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>            pGameEvent.<a class="code hl_variable" href="../../d8/dba/a08244.html#aa13c2c2eacb9475e18c1d1370566e988">holiday_id</a>   = <a class="code hl_enumeration" href="../../d9/d4e/a04307.html#ad279224fea61f9754572051fc5ff1fab">HolidayIds</a>(fields[5].Get&lt;uint32&gt;());</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span> </div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>            pGameEvent.<a class="code hl_variable" href="../../d8/dba/a08244.html#a23a3f6d7f036f6c5b47b84ef1242d056">holidayStage</a> = fields[6].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a15a8d014fadf85c99a2268d8cbd00767">uint8</a>&gt;();</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>            pGameEvent.<a class="code hl_variable" href="../../d8/dba/a08244.html#aebdadbaadbba367601674146a27a283f">description</a>  = fields[7].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;std::string&gt;();</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>            pGameEvent.<a class="code hl_variable" href="../../d8/dba/a08244.html#a54a6e90fd4b68093a99e32b198eab2fb">state</a>        = (<a class="code hl_enumeration" href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5">GameEventState</a>)(fields[8].Get&lt;uint8&gt;());</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>            pGameEvent.<a class="code hl_variable" href="../../d8/dba/a08244.html#a7271996d66a36e41b21502fa4d5305fe">announce</a>     = fields[9].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a15a8d014fadf85c99a2268d8cbd00767">uint8</a>&gt;();</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>            pGameEvent.<a class="code hl_variable" href="../../d8/dba/a08244.html#ae0259f021337b3ad47dfbbc1f361965f">nextstart</a>    = 0;</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span> </div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>            ++count;</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span> </div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>            <span class="keywordflow">if</span> (pGameEvent.<a class="code hl_variable" href="../../d8/dba/a08244.html#ac45297bad99ddb339b3aa18ec5912c1c">length</a> == 0 &amp;&amp; pGameEvent.<a class="code hl_variable" href="../../d8/dba/a08244.html#a54a6e90fd4b68093a99e32b198eab2fb">state</a> == <a class="code hl_enumvalue" href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5a0951d2c0686f93e6e7d0e002b4521921">GAMEEVENT_NORMAL</a>)                            <span class="comment">// length&gt;0 is validity check</span></div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>            {</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>                <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;sql.sql&quot;</span>, <span class="stringliteral">&quot;`game_event` game event id ({}) isn&#39;t a world event and has length = 0, thus it can&#39;t be used.&quot;</span>, event_id);</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>            }</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span> </div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>            <span class="keywordflow">if</span> (pGameEvent.<a class="code hl_variable" href="../../d8/dba/a08244.html#aa13c2c2eacb9475e18c1d1370566e988">holiday_id</a> != <a class="code hl_enumvalue" href="../../d9/d4e/a04307.html#ad279224fea61f9754572051fc5ff1faba28168544ac4271e71835f87f564500f7">HOLIDAY_NONE</a>)</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>            {</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>                <span class="keywordflow">if</span> (!<a class="code hl_variable" href="../../d9/d7c/a01073.html#a817e11f567a65f71476999c0012318bd">sHolidaysStore</a>.LookupEntry(pGameEvent.<a class="code hl_variable" href="../../d8/dba/a08244.html#aa13c2c2eacb9475e18c1d1370566e988">holiday_id</a>))</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>                {</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>                    <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;sql.sql&quot;</span>, <span class="stringliteral">&quot;`game_event` game event id ({}) have not existed holiday id {}.&quot;</span>, event_id, pGameEvent.<a class="code hl_variable" href="../../d8/dba/a08244.html#aa13c2c2eacb9475e18c1d1370566e988">holiday_id</a>);</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>                    pGameEvent.<a class="code hl_variable" href="../../d8/dba/a08244.html#aa13c2c2eacb9475e18c1d1370566e988">holiday_id</a> = <a class="code hl_enumvalue" href="../../d9/d4e/a04307.html#ad279224fea61f9754572051fc5ff1faba28168544ac4271e71835f87f564500f7">HOLIDAY_NONE</a>;</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>                }</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span> </div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>                <a class="code hl_function" href="../../d1/d78/a08256.html#ab5346c6b86054d0f5f172242d59325eb">SetHolidayEventTime</a>(pGameEvent);</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>            }</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>        } <span class="keywordflow">while</span> (result-&gt;NextRow());</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span> </div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>        <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; Loaded {} Game Events in {} ms&quot;</span>, count, <a class="code hl_function" href="../../d4/ddf/a00488.html#a23a2c8663a05f2b03a6f85501972e8c0">GetMSTimeDiffToNow</a>(oldMSTime));</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>        <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>    }</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span> </div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>    <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;Loading Game Event Saves Data...&quot;</span>);</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>    {</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>        <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> oldMSTime = <a class="code hl_function" href="../../d4/ddf/a00488.html#a4476c8e13ea790c3536f2749105f9cb9">getMSTime</a>();</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span> </div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>        <span class="comment">//                                                       0       1        2</span></div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>        <a class="code hl_typedef" href="../../d0/d3e/a00566.html#ab0c9feeec448a181290fcb39565b8253">QueryResult</a> result = <a class="code hl_variable" href="../../d9/d19/a00560.html#a7e7534bc66d79434bd280b77cb124eec">CharacterDatabase</a>.Query(<span class="stringliteral">&quot;SELECT eventEntry, state, next_start FROM game_event_save&quot;</span>);</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span> </div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>        <span class="keywordflow">if</span> (!result)</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>        {</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>            <a class="code hl_define" href="../../da/de0/a00317.html#adf09840a666e1d86bcd3439105db6edc">LOG_WARN</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; Loaded 0 Game Event Saves In Game Events. DB Table `game_event_save` Is Empty.&quot;</span>);</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>        }</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>        {</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>            <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> count = 0;</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>            <span class="keywordflow">do</span></div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>            {</div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>                <a class="code hl_class" href="../../d3/d02/a05368.html">Field</a>* fields = result-&gt;Fetch();</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span> </div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>                <a class="code hl_typedef" href="../../d1/da8/a00230.html#a15a8d014fadf85c99a2268d8cbd00767">uint8</a> event_id = fields[0].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a15a8d014fadf85c99a2268d8cbd00767">uint8</a>&gt;();</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span> </div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>                <span class="keywordflow">if</span> (event_id &gt;= <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>.size())</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>                {</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>                    <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;sql.sql&quot;</span>, <span class="stringliteral">&quot;`game_event_save` game event entry ({}) is out of range compared to max event entry in `game_event`&quot;</span>, event_id);</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>                }</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span> </div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id].state != <a class="code hl_enumvalue" href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5a0951d2c0686f93e6e7d0e002b4521921">GAMEEVENT_NORMAL</a> &amp;&amp; <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id].state != <a class="code hl_enumvalue" href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5a2612ea68e0c9d21dae1af2e9ac04bc81">GAMEEVENT_INTERNAL</a>)</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>                {</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>                    <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id].state = (<a class="code hl_enumeration" href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5">GameEventState</a>)(fields[1].Get&lt;uint8&gt;());</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>                    <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id].nextstart    = time_t(fields[2].Get&lt;uint32&gt;());</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>                }</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>                <span class="keywordflow">else</span></div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>                {</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>                    <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;sql.sql&quot;</span>, <span class="stringliteral">&quot;game_event_save includes event save for non-worldevent id {}&quot;</span>, event_id);</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>                }</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span> </div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>                ++count;</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>            } <span class="keywordflow">while</span> (result-&gt;NextRow());</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span> </div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; Loaded {} Game Event Saves In Game Events in {} ms&quot;</span>, count, <a class="code hl_function" href="../../d4/ddf/a00488.html#a23a2c8663a05f2b03a6f85501972e8c0">GetMSTimeDiffToNow</a>(oldMSTime));</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>        }</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>    }</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span> </div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>    <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;Loading Game Event Prerequisite Data...&quot;</span>);</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>    {</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>        <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> oldMSTime = <a class="code hl_function" href="../../d4/ddf/a00488.html#a4476c8e13ea790c3536f2749105f9cb9">getMSTime</a>();</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span> </div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>        <span class="comment">//                                                   0             1</span></div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>        <a class="code hl_typedef" href="../../d0/d3e/a00566.html#ab0c9feeec448a181290fcb39565b8253">QueryResult</a> result = <a class="code hl_variable" href="../../d9/d19/a00560.html#afa9a6509f9913c9c7dd3081523badd7c">WorldDatabase</a>.Query(<span class="stringliteral">&quot;SELECT eventEntry, prerequisite_event FROM game_event_prerequisite&quot;</span>);</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>        <span class="keywordflow">if</span> (!result)</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>        {</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>            <a class="code hl_define" href="../../da/de0/a00317.html#adf09840a666e1d86bcd3439105db6edc">LOG_WARN</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; Loaded 0 Game Rvent Prerequisites in Game Events. DB Table `game_event_prerequisite` Is Empty.&quot;</span>);</div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>        }</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>        {</div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>            <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> count = 0;</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>            <span class="keywordflow">do</span></div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>            {</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>                <a class="code hl_class" href="../../d3/d02/a05368.html">Field</a>* fields = result-&gt;Fetch();</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span> </div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>                <a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a> event_id = fields[0].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a15a8d014fadf85c99a2268d8cbd00767">uint8</a>&gt;();</div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span> </div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>                <span class="keywordflow">if</span> (event_id &gt;= <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>.size())</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>                {</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>                    <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;sql.sql&quot;</span>, <span class="stringliteral">&quot;`game_event_prerequisite` game event id ({}) is out of range compared to max event id in `game_event`&quot;</span>, event_id);</div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>                }</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span> </div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id].state != <a class="code hl_enumvalue" href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5a0951d2c0686f93e6e7d0e002b4521921">GAMEEVENT_NORMAL</a> &amp;&amp; <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id].state != <a class="code hl_enumvalue" href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5a2612ea68e0c9d21dae1af2e9ac04bc81">GAMEEVENT_INTERNAL</a>)</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>                {</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>                    <a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a> prerequisite_event = fields[1].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>&gt;();</div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>                    <span class="keywordflow">if</span> (prerequisite_event &gt;= <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>.size())</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>                    {</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>                        <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;sql.sql&quot;</span>, <span class="stringliteral">&quot;`game_event_prerequisite` game event prerequisite id ({}) is out of range compared to max event id in `game_event`&quot;</span>, prerequisite_event);</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>                        <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>                    }</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>                    <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id].prerequisite_events.insert(prerequisite_event);</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>                }</div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>                <span class="keywordflow">else</span></div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>                {</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>                    <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;sql.sql&quot;</span>, <span class="stringliteral">&quot;game_event_prerequisiste includes event entry for non-worldevent id {}&quot;</span>, event_id);</div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>                }</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span> </div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>                ++count;</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>            } <span class="keywordflow">while</span> (result-&gt;NextRow());</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span> </div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; Loaded {} game event prerequisites in Game Events in {} ms&quot;</span>, count, <a class="code hl_function" href="../../d4/ddf/a00488.html#a23a2c8663a05f2b03a6f85501972e8c0">GetMSTimeDiffToNow</a>(oldMSTime));</div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>        }</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>    }</div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span> </div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>    <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;Loading Game Event Creature Data...&quot;</span>);</div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>    {</div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>        <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> oldMSTime = <a class="code hl_function" href="../../d4/ddf/a00488.html#a4476c8e13ea790c3536f2749105f9cb9">getMSTime</a>();</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span> </div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>        <span class="comment">//                                                 0        1</span></div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>        <a class="code hl_typedef" href="../../d0/d3e/a00566.html#ab0c9feeec448a181290fcb39565b8253">QueryResult</a> result = <a class="code hl_variable" href="../../d9/d19/a00560.html#afa9a6509f9913c9c7dd3081523badd7c">WorldDatabase</a>.Query(<span class="stringliteral">&quot;SELECT guid, eventEntry FROM game_event_creature&quot;</span>);</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span> </div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>        <span class="keywordflow">if</span> (!result)</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>        {</div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>            <a class="code hl_define" href="../../da/de0/a00317.html#adf09840a666e1d86bcd3439105db6edc">LOG_WARN</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; Loaded 0 creatures in game events. DB table `game_event_creature` is empty&quot;</span>);</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>        }</div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>        {</div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>            <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> count = 0;</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>            <span class="keywordflow">do</span></div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>            {</div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>                <a class="code hl_class" href="../../d3/d02/a05368.html">Field</a>* fields = result-&gt;Fetch();</div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span> </div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>                <a class="code hl_typedef" href="../../da/d98/a07852.html#aa278d50613c05dc1333df5185a6993eb">ObjectGuid::LowType</a> guid = fields[0].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>&gt;();</div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>                <a class="code hl_typedef" href="../../d1/da8/a00230.html#aecf4e3680a32207d17f62a3426731878">int16</a> event_id = fields[1].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a3bb8a71f4ae9af551f71e9eb2c9c3325">int8</a>&gt;();</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span> </div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>                <a class="code hl_struct" href="../../d0/dd1/a07484.html">CreatureData</a> <span class="keyword">const</span>* data = <a class="code hl_define" href="../../d8/d4e/a01355.html#a736e30da2b5261060ac6cdbb5de3b787">sObjectMgr</a>-&gt;GetCreatureData(guid);</div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>                <span class="keywordflow">if</span> (!data)</div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>                {</div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>                    <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;sql.sql&quot;</span>, <span class="stringliteral">&quot;`game_event_creature` contains creature (GUID: {}) not found in `creature` table.&quot;</span>, guid);</div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>                }</div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span> </div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>                <a class="code hl_typedef" href="../../d1/da8/a00230.html#a0bf9964a3ce962c07ad3d8b5432bbbcd">int32</a> internal_event_id = <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>.size() + event_id - 1;</div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span> </div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>                <span class="keywordflow">if</span> (internal_event_id &lt; 0 || internal_event_id &gt;= <a class="code hl_typedef" href="../../d1/da8/a00230.html#a0bf9964a3ce962c07ad3d8b5432bbbcd">int32</a>(<a class="code hl_variable" href="../../d1/d78/a08256.html#a340bf17cd48de8175a242d54e0bc88b9">mGameEventCreatureGuids</a>.size()))</div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>                {</div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>                    <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;sql.sql&quot;</span>, <span class="stringliteral">&quot;`game_event_creature` game event id ({}) is out of range compared to max event id in `game_event`&quot;</span>, event_id);</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>                }</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span> </div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span>                <a class="code hl_typedef" href="../../d1/d78/a08256.html#a47049ee9c568f10b36c295610954992e">GuidLowList</a>&amp; crelist = <a class="code hl_variable" href="../../d1/d78/a08256.html#a340bf17cd48de8175a242d54e0bc88b9">mGameEventCreatureGuids</a>[internal_event_id];</div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>                crelist.push_back(guid);</div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span> </div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span>                ++count;</div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span>            } <span class="keywordflow">while</span> (result-&gt;NextRow());</div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span> </div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; Loaded {} Creatures In Game Events in {} ms&quot;</span>, count, <a class="code hl_function" href="../../d4/ddf/a00488.html#a23a2c8663a05f2b03a6f85501972e8c0">GetMSTimeDiffToNow</a>(oldMSTime));</div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>        }</div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>    }</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span> </div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>    <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;Loading Game Event GO Data...&quot;</span>);</div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>    {</div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>        <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> oldMSTime = <a class="code hl_function" href="../../d4/ddf/a00488.html#a4476c8e13ea790c3536f2749105f9cb9">getMSTime</a>();</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span> </div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>        <span class="comment">//                                                0         1</span></div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>        <a class="code hl_typedef" href="../../d0/d3e/a00566.html#ab0c9feeec448a181290fcb39565b8253">QueryResult</a> result = <a class="code hl_variable" href="../../d9/d19/a00560.html#afa9a6509f9913c9c7dd3081523badd7c">WorldDatabase</a>.Query(<span class="stringliteral">&quot;SELECT guid, eventEntry FROM game_event_gameobject&quot;</span>);</div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span> </div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>        <span class="keywordflow">if</span> (!result)</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>        {</div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>            <a class="code hl_define" href="../../da/de0/a00317.html#adf09840a666e1d86bcd3439105db6edc">LOG_WARN</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; Loaded 0 gameobjects in game events. DB table `game_event_gameobject` is empty.&quot;</span>);</div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>        }</div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>        {</div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>            <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> count = 0;</div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>            <span class="keywordflow">do</span></div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>            {</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>                <a class="code hl_class" href="../../d3/d02/a05368.html">Field</a>* fields = result-&gt;Fetch();</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span> </div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>                <a class="code hl_typedef" href="../../da/d98/a07852.html#aa278d50613c05dc1333df5185a6993eb">ObjectGuid::LowType</a> guid = fields[0].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>&gt;();</div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>                <a class="code hl_typedef" href="../../d1/da8/a00230.html#aecf4e3680a32207d17f62a3426731878">int16</a> event_id = fields[1].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a3bb8a71f4ae9af551f71e9eb2c9c3325">int8</a>&gt;();</div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span> </div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>                <a class="code hl_typedef" href="../../d1/da8/a00230.html#a0bf9964a3ce962c07ad3d8b5432bbbcd">int32</a> internal_event_id = <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>.size() + event_id - 1;</div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span> </div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>                <a class="code hl_struct" href="../../d7/d9e/a07744.html">GameObjectData</a> <span class="keyword">const</span>* data = <a class="code hl_define" href="../../d8/d4e/a01355.html#a736e30da2b5261060ac6cdbb5de3b787">sObjectMgr</a>-&gt;GetGOData(guid);</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>                <span class="keywordflow">if</span> (!data)</div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>                {</div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>                    <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;sql.sql&quot;</span>, <span class="stringliteral">&quot;`game_event_gameobject` contains gameobject (GUID: {}) not found in `gameobject` table.&quot;</span>, guid);</div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>                }</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span> </div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>                <span class="keywordflow">if</span> (internal_event_id &lt; 0 || internal_event_id &gt;= <a class="code hl_typedef" href="../../d1/da8/a00230.html#a0bf9964a3ce962c07ad3d8b5432bbbcd">int32</a>(<a class="code hl_variable" href="../../d1/d78/a08256.html#a7e8911e4170a84527a7eb3d73a8a30f1">mGameEventGameobjectGuids</a>.size()))</div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>                {</div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>                    <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;sql.sql&quot;</span>, <span class="stringliteral">&quot;`game_event_gameobject` game event id ({}) is out of range compared to max event id in `game_event`&quot;</span>, event_id);</div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>                }</div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span> </div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>                <a class="code hl_typedef" href="../../d1/d78/a08256.html#a47049ee9c568f10b36c295610954992e">GuidLowList</a>&amp; golist = <a class="code hl_variable" href="../../d1/d78/a08256.html#a7e8911e4170a84527a7eb3d73a8a30f1">mGameEventGameobjectGuids</a>[internal_event_id];</div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>                golist.push_back(guid);</div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span> </div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span>                ++count;</div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>            } <span class="keywordflow">while</span> (result-&gt;NextRow());</div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span> </div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; Loaded {} Gameobjects In Game Events in {} ms&quot;</span>, count, <a class="code hl_function" href="../../d4/ddf/a00488.html#a23a2c8663a05f2b03a6f85501972e8c0">GetMSTimeDiffToNow</a>(oldMSTime));</div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>        }</div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>    }</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span> </div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>    <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;Loading Game Event Model/Equipment Change Data...&quot;</span>);</div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>    {</div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>        <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> oldMSTime = <a class="code hl_function" href="../../d4/ddf/a00488.html#a4476c8e13ea790c3536f2749105f9cb9">getMSTime</a>();</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span> </div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>        <span class="comment">//                                                     0              1             2            3                         4                               5                                 6</span></div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>        <a class="code hl_typedef" href="../../d0/d3e/a00566.html#ab0c9feeec448a181290fcb39565b8253">QueryResult</a> result = <a class="code hl_variable" href="../../d9/d19/a00560.html#afa9a6509f9913c9c7dd3081523badd7c">WorldDatabase</a>.Query(<span class="stringliteral">&quot;SELECT creature.guid, creature.id1, creature.id2, creature.id3, game_event_model_equip.eventEntry, game_event_model_equip.modelid, game_event_model_equip.equipment_id &quot;</span></div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>                             <span class="stringliteral">&quot;FROM creature JOIN game_event_model_equip ON creature.guid=game_event_model_equip.guid&quot;</span>);</div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span> </div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>        <span class="keywordflow">if</span> (!result)</div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>        {</div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span>            <a class="code hl_define" href="../../da/de0/a00317.html#adf09840a666e1d86bcd3439105db6edc">LOG_WARN</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; Loaded 0 Model/Equipment Changes In Game Events. DB Table `game_event_model_equip` Is Empty.&quot;</span>);</div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>        }</div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>        {</div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>            <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> count = 0;</div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>            <span class="keywordflow">do</span></div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span>            {</div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>                <a class="code hl_class" href="../../d3/d02/a05368.html">Field</a>* fields = result-&gt;Fetch();</div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span> </div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span>                <a class="code hl_typedef" href="../../da/d98/a07852.html#aa278d50613c05dc1333df5185a6993eb">ObjectGuid::LowType</a> guid = fields[0].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>&gt;();</div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>                <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> entry = fields[1].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>&gt;();</div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>                <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> entry2 = fields[2].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>&gt;();</div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span>                <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> entry3 = fields[3].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>&gt;();</div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span>                <a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a> event_id = fields[4].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a15a8d014fadf85c99a2268d8cbd00767">uint8</a>&gt;();</div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span> </div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span>                <span class="keywordflow">if</span> (event_id &gt;= <a class="code hl_variable" href="../../d1/d78/a08256.html#a6b958e82cbac452d531da25e2dba66d7">mGameEventModelEquip</a>.size())</div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span>                {</div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>                    <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;sql.sql&quot;</span>, <span class="stringliteral">&quot;`game_event_model_equip` game event id ({}) is out of range compared to max event id in `game_event`&quot;</span>, event_id);</div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span>                }</div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span> </div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>                <a class="code hl_typedef" href="../../d1/d78/a08256.html#a70bc9ff853dd8cb95db57ad231d4b7b0">ModelEquipList</a>&amp; equiplist = <a class="code hl_variable" href="../../d1/d78/a08256.html#a6b958e82cbac452d531da25e2dba66d7">mGameEventModelEquip</a>[event_id];</div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>                <a class="code hl_struct" href="../../dd/d37/a08248.html">ModelEquip</a> newModelEquipSet;</div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span>                newModelEquipSet.<a class="code hl_variable" href="../../dd/d37/a08248.html#a53296cbdf02039d19610c21e0f7d5d1d">modelid</a> = fields[5].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>&gt;();</div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span>                newModelEquipSet.<a class="code hl_variable" href="../../dd/d37/a08248.html#af21361c600fb9609f554b64bc5cfb4c2">equipment_id</a> = fields[6].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a15a8d014fadf85c99a2268d8cbd00767">uint8</a>&gt;();</div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>                newModelEquipSet.<a class="code hl_variable" href="../../dd/d37/a08248.html#a93a895fa31cef29fa739225316886e78">equipement_id_prev</a> = 0;</div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span>                newModelEquipSet.<a class="code hl_variable" href="../../dd/d37/a08248.html#a976ce0cdd7c8e95465bc999d26347bde">modelid_prev</a> = 0;</div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span> </div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>                <span class="keywordflow">if</span> (newModelEquipSet.<a class="code hl_variable" href="../../dd/d37/a08248.html#af21361c600fb9609f554b64bc5cfb4c2">equipment_id</a> &gt; 0)</div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>                {</div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>                    <a class="code hl_typedef" href="../../d1/da8/a00230.html#a3bb8a71f4ae9af551f71e9eb2c9c3325">int8</a> equipId = <span class="keyword">static_cast&lt;</span><a class="code hl_typedef" href="../../d1/da8/a00230.html#a3bb8a71f4ae9af551f71e9eb2c9c3325">int8</a><span class="keyword">&gt;</span>(newModelEquipSet.<a class="code hl_variable" href="../../dd/d37/a08248.html#af21361c600fb9609f554b64bc5cfb4c2">equipment_id</a>);</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span>                    <span class="keywordflow">if</span> ((!<a class="code hl_define" href="../../d8/d4e/a01355.html#a736e30da2b5261060ac6cdbb5de3b787">sObjectMgr</a>-&gt;GetEquipmentInfo(entry, equipId)) || (entry2 &amp;&amp; !<a class="code hl_define" href="../../d8/d4e/a01355.html#a736e30da2b5261060ac6cdbb5de3b787">sObjectMgr</a>-&gt;GetEquipmentInfo(entry2, equipId)) || (entry3 &amp;&amp; !<a class="code hl_define" href="../../d8/d4e/a01355.html#a736e30da2b5261060ac6cdbb5de3b787">sObjectMgr</a>-&gt;GetEquipmentInfo(entry3, equipId)))</div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span>                    {</div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span>                        <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;sql.sql&quot;</span>, <span class="stringliteral">&quot;Table `game_event_model_equip` have creature (Guid: {}) with equipment_id {} not found in table `creature_equip_template`, set to no equipment.&quot;</span>,</div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>                                         guid, newModelEquipSet.<a class="code hl_variable" href="../../dd/d37/a08248.html#af21361c600fb9609f554b64bc5cfb4c2">equipment_id</a>);</div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>                        <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>                    }</div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>                }</div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span> </div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span>                equiplist.push_back(std::pair&lt;ObjectGuid::LowType, ModelEquip&gt;(guid, newModelEquipSet));</div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span> </div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>                ++count;</div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span>            } <span class="keywordflow">while</span> (result-&gt;NextRow());</div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span> </div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; Loaded {} Model/Equipment Changes In Game Events in {} ms&quot;</span>, count, <a class="code hl_function" href="../../d4/ddf/a00488.html#a23a2c8663a05f2b03a6f85501972e8c0">GetMSTimeDiffToNow</a>(oldMSTime));</div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span>        }</div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>    }</div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span> </div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>    <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;Loading Game Event Quest Data...&quot;</span>);</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>    {</div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>        <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> oldMSTime = <a class="code hl_function" href="../../d4/ddf/a00488.html#a4476c8e13ea790c3536f2749105f9cb9">getMSTime</a>();</div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span> </div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>        <span class="comment">//                                               0     1      2</span></div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>        <a class="code hl_typedef" href="../../d0/d3e/a00566.html#ab0c9feeec448a181290fcb39565b8253">QueryResult</a> result = <a class="code hl_variable" href="../../d9/d19/a00560.html#afa9a6509f9913c9c7dd3081523badd7c">WorldDatabase</a>.Query(<span class="stringliteral">&quot;SELECT id, quest, eventEntry FROM game_event_creature_quest&quot;</span>);</div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span> </div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>        <span class="keywordflow">if</span> (!result)</div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>        {</div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>            <a class="code hl_define" href="../../da/de0/a00317.html#adf09840a666e1d86bcd3439105db6edc">LOG_WARN</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; Loaded 0 Quests Additions In Game Events. DB Table `game_event_creature_quest` Is Empty.&quot;</span>);</div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span>        }</div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>        {</div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>            <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> count = 0;</div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>            <span class="keywordflow">do</span></div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>            {</div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span>                <a class="code hl_class" href="../../d3/d02/a05368.html">Field</a>* fields = result-&gt;Fetch();</div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span> </div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>                <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> <span class="keywordtype">id</span>       = fields[0].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>&gt;();</div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>                <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> quest    = fields[1].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>&gt;();</div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span>                <a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a> event_id = fields[2].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a15a8d014fadf85c99a2268d8cbd00767">uint8</a>&gt;();</div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span> </div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>                <span class="keywordflow">if</span> (event_id &gt;= <a class="code hl_variable" href="../../d1/d78/a08256.html#a7b61b9926bb2e7ad9a3be4e541f9a4e8">mGameEventCreatureQuests</a>.size())</div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>                {</div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>                    <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;sql.sql&quot;</span>, <span class="stringliteral">&quot;`game_event_creature_quest` game event id ({}) is out of range compared to max event id in `game_event`&quot;</span>, event_id);</div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>                }</div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span> </div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>                <a class="code hl_typedef" href="../../d1/d78/a08256.html#aba8e2aaa06b172227768debf82e99b5a">QuestRelList</a>&amp; questlist = <a class="code hl_variable" href="../../d1/d78/a08256.html#a7b61b9926bb2e7ad9a3be4e541f9a4e8">mGameEventCreatureQuests</a>[event_id];</div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>                questlist.push_back(<a class="code hl_typedef" href="../../d1/d78/a08256.html#ae2b1a729f3af63b9dac537b6ac3b1d3f">QuestRelation</a>(<span class="keywordtype">id</span>, quest));</div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span> </div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>                ++count;</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>            } <span class="keywordflow">while</span> (result-&gt;NextRow());</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span> </div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; Loaded {} Quests Additions In Game Events in {} ms&quot;</span>, count, <a class="code hl_function" href="../../d4/ddf/a00488.html#a23a2c8663a05f2b03a6f85501972e8c0">GetMSTimeDiffToNow</a>(oldMSTime));</div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>        }</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>    }</div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span> </div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>    <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;Loading Game Event GO Quest Data...&quot;</span>);</div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>    {</div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>        <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> oldMSTime = <a class="code hl_function" href="../../d4/ddf/a00488.html#a4476c8e13ea790c3536f2749105f9cb9">getMSTime</a>();</div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span> </div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span>        <span class="comment">//                                               0     1      2</span></div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span>        <a class="code hl_typedef" href="../../d0/d3e/a00566.html#ab0c9feeec448a181290fcb39565b8253">QueryResult</a> result = <a class="code hl_variable" href="../../d9/d19/a00560.html#afa9a6509f9913c9c7dd3081523badd7c">WorldDatabase</a>.Query(<span class="stringliteral">&quot;SELECT id, quest, eventEntry FROM game_event_gameobject_quest&quot;</span>);</div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span> </div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>        <span class="keywordflow">if</span> (!result)</div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>        {</div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>            <a class="code hl_define" href="../../da/de0/a00317.html#adf09840a666e1d86bcd3439105db6edc">LOG_WARN</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; Loaded 0 go Quests Additions In Game Events. DB Table `game_event_gameobject_quest` Is Empty.&quot;</span>);</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>        }</div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>        {</div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>            <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> count = 0;</div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>            <span class="keywordflow">do</span></div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>            {</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>                <a class="code hl_class" href="../../d3/d02/a05368.html">Field</a>* fields = result-&gt;Fetch();</div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span> </div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>                <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> <span class="keywordtype">id</span>       = fields[0].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>&gt;();</div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span>                <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> quest    = fields[1].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>&gt;();</div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>                <a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a> event_id = fields[2].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a15a8d014fadf85c99a2268d8cbd00767">uint8</a>&gt;();</div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span> </div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span>                <span class="keywordflow">if</span> (event_id &gt;= <a class="code hl_variable" href="../../d1/d78/a08256.html#ab470698b19df4edd09f6b32fcfe120fc">mGameEventGameObjectQuests</a>.size())</div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span>                {</div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span>                    <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;sql.sql&quot;</span>, <span class="stringliteral">&quot;`game_event_gameobject_quest` game event id ({}) is out of range compared to max event id in `game_event`&quot;</span>, event_id);</div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>                }</div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span> </div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>                <a class="code hl_typedef" href="../../d1/d78/a08256.html#aba8e2aaa06b172227768debf82e99b5a">QuestRelList</a>&amp; questlist = <a class="code hl_variable" href="../../d1/d78/a08256.html#ab470698b19df4edd09f6b32fcfe120fc">mGameEventGameObjectQuests</a>[event_id];</div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>                questlist.push_back(<a class="code hl_typedef" href="../../d1/d78/a08256.html#ae2b1a729f3af63b9dac537b6ac3b1d3f">QuestRelation</a>(<span class="keywordtype">id</span>, quest));</div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span> </div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>                ++count;</div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>            } <span class="keywordflow">while</span> (result-&gt;NextRow());</div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span> </div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; Loaded {} Quests Additions In Game Events in {} ms&quot;</span>, count, <a class="code hl_function" href="../../d4/ddf/a00488.html#a23a2c8663a05f2b03a6f85501972e8c0">GetMSTimeDiffToNow</a>(oldMSTime));</div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>        }</div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span>    }</div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span> </div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span>    <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;Loading Game Event Quest Condition Data...&quot;</span>);</div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span>    {</div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span>        <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> oldMSTime = <a class="code hl_function" href="../../d4/ddf/a00488.html#a4476c8e13ea790c3536f2749105f9cb9">getMSTime</a>();</div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span> </div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>        <span class="comment">//                                                 0       1         2             3</span></div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>        <a class="code hl_typedef" href="../../d0/d3e/a00566.html#ab0c9feeec448a181290fcb39565b8253">QueryResult</a> result = <a class="code hl_variable" href="../../d9/d19/a00560.html#afa9a6509f9913c9c7dd3081523badd7c">WorldDatabase</a>.Query(<span class="stringliteral">&quot;SELECT quest, eventEntry, condition_id, num FROM game_event_quest_condition&quot;</span>);</div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span> </div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span>        <span class="keywordflow">if</span> (!result)</div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>        {</div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>            <a class="code hl_define" href="../../da/de0/a00317.html#adf09840a666e1d86bcd3439105db6edc">LOG_WARN</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; Loaded 0 quest event Conditions In Game Events. DB Table `game_event_quest_condition` Is Empty.&quot;</span>);</div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span>        }</div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span>        {</div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>            <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> count = 0;</div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>            <span class="keywordflow">do</span></div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>            {</div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>                <a class="code hl_class" href="../../d3/d02/a05368.html">Field</a>* fields = result-&gt;Fetch();</div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span> </div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span>                <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> quest     = fields[0].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>&gt;();</div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>                <a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a> event_id  = fields[1].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a15a8d014fadf85c99a2268d8cbd00767">uint8</a>&gt;();</div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>                <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> condition = fields[2].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>&gt;();</div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span>                <span class="keywordtype">float</span> num       = fields[3].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<span class="keywordtype">float</span>&gt;();</div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span> </div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span>                <span class="keywordflow">if</span> (event_id &gt;= <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>.size())</div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span>                {</div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span>                    <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;sql.sql&quot;</span>, <span class="stringliteral">&quot;`game_event_quest_condition` game event id ({}) is out of range compared to max event id in `game_event`&quot;</span>, event_id);</div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span>                }</div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span> </div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span>                <a class="code hl_variable" href="../../d1/d78/a08256.html#aa2123dfc70039ad79394bc554233a906">mQuestToEventConditions</a>[quest].event_id = event_id;</div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span>                <a class="code hl_variable" href="../../d1/d78/a08256.html#aa2123dfc70039ad79394bc554233a906">mQuestToEventConditions</a>[quest].condition = condition;</div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span>                <a class="code hl_variable" href="../../d1/d78/a08256.html#aa2123dfc70039ad79394bc554233a906">mQuestToEventConditions</a>[quest].num = num;</div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span> </div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span>                ++count;</div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span>            } <span class="keywordflow">while</span> (result-&gt;NextRow());</div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span> </div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; Loaded {} quest event conditions in Game Events in {} ms&quot;</span>, count, <a class="code hl_function" href="../../d4/ddf/a00488.html#a23a2c8663a05f2b03a6f85501972e8c0">GetMSTimeDiffToNow</a>(oldMSTime));</div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span>        }</div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span>    }</div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span> </div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span>    <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;Loading Game Event Condition Data...&quot;</span>);</div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span>    {</div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span>        <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> oldMSTime = <a class="code hl_function" href="../../d4/ddf/a00488.html#a4476c8e13ea790c3536f2749105f9cb9">getMSTime</a>();</div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span> </div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>        <span class="comment">//                                                  0          1            2             3                      4</span></div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span>        <a class="code hl_typedef" href="../../d0/d3e/a00566.html#ab0c9feeec448a181290fcb39565b8253">QueryResult</a> result = <a class="code hl_variable" href="../../d9/d19/a00560.html#afa9a6509f9913c9c7dd3081523badd7c">WorldDatabase</a>.Query(<span class="stringliteral">&quot;SELECT eventEntry, condition_id, req_num, max_world_state_field, done_world_state_field FROM game_event_condition&quot;</span>);</div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span> </div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>        <span class="keywordflow">if</span> (!result)</div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span>        {</div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span>            <a class="code hl_define" href="../../da/de0/a00317.html#adf09840a666e1d86bcd3439105db6edc">LOG_WARN</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; Loaded 0 Conditions In Game Events. DB table `game_event_condition` Is Empty.&quot;</span>);</div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span>        }</div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span>        {</div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span>            <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> count = 0;</div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span>            <span class="keywordflow">do</span></div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>            {</div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span>                <a class="code hl_class" href="../../d3/d02/a05368.html">Field</a>* fields = result-&gt;Fetch();</div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span> </div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>                <a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a> event_id  = fields[0].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a15a8d014fadf85c99a2268d8cbd00767">uint8</a>&gt;();</div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span>                <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> condition = fields[1].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>&gt;();</div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span> </div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span>                <span class="keywordflow">if</span> (event_id &gt;= <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>.size())</div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span>                {</div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span>                    <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;sql.sql&quot;</span>, <span class="stringliteral">&quot;`game_event_condition` game event id ({}) is out of range compared to max event id in `game_event`&quot;</span>, event_id);</div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span>                }</div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span> </div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span>                <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id].conditions[condition].reqNum = fields[2].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<span class="keywordtype">float</span>&gt;();</div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>                <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id].conditions[condition].done = 0;</div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>                <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id].conditions[condition].max_world_state = fields[3].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a>&gt;();</div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>                <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id].conditions[condition].done_world_state = fields[4].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a>&gt;();</div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span> </div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>                ++count;</div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>            } <span class="keywordflow">while</span> (result-&gt;NextRow());</div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span> </div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; Loaded {} conditions in Game Events in {} ms&quot;</span>, count, <a class="code hl_function" href="../../d4/ddf/a00488.html#a23a2c8663a05f2b03a6f85501972e8c0">GetMSTimeDiffToNow</a>(oldMSTime));</div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span>        }</div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span>    }</div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span> </div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span>    <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;Loading Game Event Condition Save Data...&quot;</span>);</div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span>    {</div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span>        <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> oldMSTime = <a class="code hl_function" href="../../d4/ddf/a00488.html#a4476c8e13ea790c3536f2749105f9cb9">getMSTime</a>();</div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span> </div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span>        <span class="comment">//                                                      0           1         2</span></div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span>        <a class="code hl_typedef" href="../../d0/d3e/a00566.html#ab0c9feeec448a181290fcb39565b8253">QueryResult</a> result = <a class="code hl_variable" href="../../d9/d19/a00560.html#a7e7534bc66d79434bd280b77cb124eec">CharacterDatabase</a>.Query(<span class="stringliteral">&quot;SELECT eventEntry, condition_id, done FROM game_event_condition_save&quot;</span>);</div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span> </div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>        <span class="keywordflow">if</span> (!result)</div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span>        {</div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>            <a class="code hl_define" href="../../da/de0/a00317.html#adf09840a666e1d86bcd3439105db6edc">LOG_WARN</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; Loaded 0 Condition Saves In Game Events. DB Table `game_event_condition_save` Is Empty.&quot;</span>);</div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span>        }</div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span>        {</div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span>            <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> count = 0;</div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span>            <span class="keywordflow">do</span></div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span>            {</div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span>                <a class="code hl_class" href="../../d3/d02/a05368.html">Field</a>* fields = result-&gt;Fetch();</div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span> </div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span>                <a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a> event_id  = fields[0].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a15a8d014fadf85c99a2268d8cbd00767">uint8</a>&gt;();</div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>                <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> condition = fields[1].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>&gt;();</div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span> </div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span>                <span class="keywordflow">if</span> (event_id &gt;= <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>.size())</div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span>                {</div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span>                    <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;sql.sql&quot;</span>, <span class="stringliteral">&quot;`game_event_condition_save` game event id ({}) is out of range compared to max event id in `game_event`&quot;</span>, event_id);</div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>                }</div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span> </div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span>                GameEventConditionMap::iterator itr = <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id].conditions.find(condition);</div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span>                <span class="keywordflow">if</span> (itr != <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id].conditions.end())</div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>                {</div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span>                    itr-&gt;second.done = fields[2].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<span class="keywordtype">float</span>&gt;();</div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span>                }</div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span>                <span class="keywordflow">else</span></div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span>                {</div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span>                    <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;sql.sql&quot;</span>, <span class="stringliteral">&quot;game_event_condition_save contains not present condition evt id {} cond id {}&quot;</span>, event_id, condition);</div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span>                }</div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span> </div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span>                ++count;</div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span>            } <span class="keywordflow">while</span> (result-&gt;NextRow());</div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span> </div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; Loaded {} Condition Saves In Game Events In {} ms&quot;</span>, count, <a class="code hl_function" href="../../d4/ddf/a00488.html#a23a2c8663a05f2b03a6f85501972e8c0">GetMSTimeDiffToNow</a>(oldMSTime));</div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span>        }</div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span>    }</div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span> </div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span>    <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;Loading Game Event NPCflag Data...&quot;</span>);</div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span>    {</div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span>        <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> oldMSTime = <a class="code hl_function" href="../../d4/ddf/a00488.html#a4476c8e13ea790c3536f2749105f9cb9">getMSTime</a>();</div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span> </div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span>        <span class="comment">//                                                0       1        2</span></div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span>        <a class="code hl_typedef" href="../../d0/d3e/a00566.html#ab0c9feeec448a181290fcb39565b8253">QueryResult</a> result = <a class="code hl_variable" href="../../d9/d19/a00560.html#afa9a6509f9913c9c7dd3081523badd7c">WorldDatabase</a>.Query(<span class="stringliteral">&quot;SELECT guid, eventEntry, npcflag FROM game_event_npcflag&quot;</span>);</div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span> </div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span>        <span class="keywordflow">if</span> (!result)</div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno">  778</span>        {</div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span>            <a class="code hl_define" href="../../da/de0/a00317.html#adf09840a666e1d86bcd3439105db6edc">LOG_WARN</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; Loaded 0 Npcflags In Game Events. DB Table `game_event_npcflag` Is Empty.&quot;</span>);</div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span>        }</div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span>        {</div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span>            <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> count = 0;</div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span>            <span class="keywordflow">do</span></div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span>            {</div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span>                <a class="code hl_class" href="../../d3/d02/a05368.html">Field</a>* fields = result-&gt;Fetch();</div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span> </div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span>                <a class="code hl_typedef" href="../../da/d98/a07852.html#aa278d50613c05dc1333df5185a6993eb">ObjectGuid::LowType</a> guid = fields[0].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>&gt;();</div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span>                <a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a> event_id = fields[1].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a15a8d014fadf85c99a2268d8cbd00767">uint8</a>&gt;();</div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span>                <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> npcflag = fields[2].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>&gt;();</div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span> </div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span>                <span class="keywordflow">if</span> (event_id &gt;= <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>.size())</div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span>                {</div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span>                    <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;sql.sql&quot;</span>, <span class="stringliteral">&quot;`game_event_npcflag` game event id ({}) is out of range compared to max event id in `game_event`&quot;</span>, event_id);</div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span>                }</div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span> </div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span>                <a class="code hl_variable" href="../../d1/d78/a08256.html#a23a28a5ae28efdd54deceeca15969196">mGameEventNPCFlags</a>[event_id].push_back(<a class="code hl_typedef" href="../../d1/d78/a08256.html#aea098683abd57a8a9b4878eb6a3ee747">GuidNPCFlagPair</a>(guid, npcflag));</div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span> </div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span>                ++count;</div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span>            } <span class="keywordflow">while</span> (result-&gt;NextRow());</div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span> </div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; Loaded {} Npcflags In Game Events In {} ms&quot;</span>, count, <a class="code hl_function" href="../../d4/ddf/a00488.html#a23a2c8663a05f2b03a6f85501972e8c0">GetMSTimeDiffToNow</a>(oldMSTime));</div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span>        }</div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span>    }</div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span> </div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span>    <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;Loading Game Event Seasonal Quest Relations...&quot;</span>);</div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span>    {</div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span>        <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> oldMSTime = <a class="code hl_function" href="../../d4/ddf/a00488.html#a4476c8e13ea790c3536f2749105f9cb9">getMSTime</a>();</div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span> </div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span>        <span class="comment">//                                                  0          1</span></div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span>        <a class="code hl_typedef" href="../../d0/d3e/a00566.html#ab0c9feeec448a181290fcb39565b8253">QueryResult</a> result = <a class="code hl_variable" href="../../d9/d19/a00560.html#afa9a6509f9913c9c7dd3081523badd7c">WorldDatabase</a>.Query(<span class="stringliteral">&quot;SELECT questId, eventEntry FROM game_event_seasonal_questrelation&quot;</span>);</div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span> </div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span>        <span class="keywordflow">if</span> (!result)</div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span>        {</div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span>            <a class="code hl_define" href="../../da/de0/a00317.html#adf09840a666e1d86bcd3439105db6edc">LOG_WARN</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; Loaded 0 Seasonal Quests Additions In Game Events. DB Table `game_event_seasonal_questrelation` Is Empty.&quot;</span>);</div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span>        }</div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span>        {</div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span>            <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> count = 0;</div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span>            <span class="keywordflow">do</span></div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span>            {</div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span>                <a class="code hl_class" href="../../d3/d02/a05368.html">Field</a>* fields = result-&gt;Fetch();</div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span> </div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span>                <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> questId  = fields[0].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>&gt;();</div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span>                <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> eventEntry = fields[1].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>&gt;(); <span class="comment">// TODO: Change to uint8</span></div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span> </div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span>                <a class="code hl_class" href="../../d1/db9/a09560.html">Quest</a>* questTemplate = <span class="keyword">const_cast&lt;</span><a class="code hl_class" href="../../d1/db9/a09560.html">Quest</a>*<span class="keyword">&gt;</span>(<a class="code hl_define" href="../../d8/d4e/a01355.html#a736e30da2b5261060ac6cdbb5de3b787">sObjectMgr</a>-&gt;GetQuestTemplate(questId));</div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span> </div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span>                <span class="keywordflow">if</span> (!questTemplate)</div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span>                {</div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span>                    <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;sql.sql&quot;</span>, <span class="stringliteral">&quot;`game_event_seasonal_questrelation` quest id ({}) does not exist in `quest_template`&quot;</span>, questId);</div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>                }</div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span> </div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span>                <span class="keywordflow">if</span> (eventEntry &gt;= <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>.size())</div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span>                {</div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span>                    <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;sql.sql&quot;</span>, <span class="stringliteral">&quot;`game_event_seasonal_questrelation` event id ({}) is out of range compared to max event in `game_event`&quot;</span>, eventEntry);</div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span>                }</div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span> </div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span>                questTemplate-&gt;SetEventIdForQuest((<a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a>)eventEntry);</div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span>                <a class="code hl_variable" href="../../d1/d78/a08256.html#aa3fc438e41a455a600381c2d4f0bdb11">_gameEventSeasonalQuestsMap</a>[eventEntry].push_back(questId);</div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span>                ++count;</div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span>            } <span class="keywordflow">while</span> (result-&gt;NextRow());</div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span> </div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; Loaded {} Quests Additions In Game Events in {} ms&quot;</span>, count, <a class="code hl_function" href="../../d4/ddf/a00488.html#a23a2c8663a05f2b03a6f85501972e8c0">GetMSTimeDiffToNow</a>(oldMSTime));</div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span>        }</div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span>    }</div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span> </div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span>    <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;Loading Game Event Vendor Additions Data...&quot;</span>);</div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span>    {</div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span>        <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> oldMSTime = <a class="code hl_function" href="../../d4/ddf/a00488.html#a4476c8e13ea790c3536f2749105f9cb9">getMSTime</a>();</div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span> </div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span>        <span class="comment">//                                                    0        1    2       3         4          5</span></div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span>        <a class="code hl_typedef" href="../../d0/d3e/a00566.html#ab0c9feeec448a181290fcb39565b8253">QueryResult</a> result = <a class="code hl_variable" href="../../d9/d19/a00560.html#afa9a6509f9913c9c7dd3081523badd7c">WorldDatabase</a>.Query(<span class="stringliteral">&quot;SELECT eventEntry, guid, item, maxcount, incrtime, ExtendedCost FROM game_event_npc_vendor ORDER BY guid, slot ASC&quot;</span>);</div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span> </div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span>        <span class="keywordflow">if</span> (!result)</div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span>        {</div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span>            <a class="code hl_define" href="../../da/de0/a00317.html#adf09840a666e1d86bcd3439105db6edc">LOG_WARN</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; Loaded 0 Vendor Additions In Game Events. DB Table `game_event_npc_vendor` Is Empty.&quot;</span>);</div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span>        }</div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span>        {</div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span>            <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> count = 0;</div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span>            <span class="keywordflow">do</span></div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span>            {</div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span>                <a class="code hl_class" href="../../d3/d02/a05368.html">Field</a>* fields = result-&gt;Fetch();</div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span> </div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span>                <a class="code hl_typedef" href="../../d1/da8/a00230.html#a15a8d014fadf85c99a2268d8cbd00767">uint8</a> event_id  = fields[0].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a15a8d014fadf85c99a2268d8cbd00767">uint8</a>&gt;();</div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span> </div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span>                <span class="keywordflow">if</span> (event_id &gt;= <a class="code hl_variable" href="../../d1/d78/a08256.html#a7a78bd9b0c6f4cc32e386794955ac3b5">mGameEventVendors</a>.size())</div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span>                {</div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span>                    <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;sql.sql&quot;</span>, <span class="stringliteral">&quot;`game_event_npc_vendor` game event id ({}) is out of range compared to max event id in `game_event`&quot;</span>, event_id);</div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span>                }</div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span> </div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span>                <a class="code hl_typedef" href="../../d1/d78/a08256.html#adcc6d8a9aaefca1ae44783598d70531f">NPCVendorList</a>&amp; vendors = <a class="code hl_variable" href="../../d1/d78/a08256.html#a7a78bd9b0c6f4cc32e386794955ac3b5">mGameEventVendors</a>[event_id];</div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span>                <a class="code hl_struct" href="../../d1/d86/a08252.html">NPCVendorEntry</a> newEntry;</div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span>                <a class="code hl_typedef" href="../../da/d98/a07852.html#aa278d50613c05dc1333df5185a6993eb">ObjectGuid::LowType</a> guid = fields[1].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>&gt;();</div>
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno">  885</span>                newEntry.<a class="code hl_variable" href="../../d1/d86/a08252.html#a8f2e01fb177f33afeef9e37ffd456ff2">item</a> = fields[2].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>&gt;();</div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span>                newEntry.<a class="code hl_variable" href="../../d1/d86/a08252.html#a48cb32b398e0dc6928a30bb254b05a11">maxcount</a> = fields[3].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>&gt;();</div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span>                newEntry.<a class="code hl_variable" href="../../d1/d86/a08252.html#ab86bdb08475c1c2b75755fffcb6b8275">incrtime</a> = fields[4].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>&gt;();</div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno">  888</span>                newEntry.<a class="code hl_variable" href="../../d1/d86/a08252.html#ac826dc078ef456ed93bf23175bce243d">ExtendedCost</a> = fields[5].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>&gt;();</div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span>                <span class="comment">// get the event npc flag for checking if the npc will be vendor during the event or not</span></div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span>                <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> event_npc_flag = 0;</div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span>                <a class="code hl_typedef" href="../../d1/d78/a08256.html#ab33aa86e40a4465f89f444ba16bd962d">NPCFlagList</a>&amp; flist = <a class="code hl_variable" href="../../d1/d78/a08256.html#a23a28a5ae28efdd54deceeca15969196">mGameEventNPCFlags</a>[event_id];</div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span>                <span class="keywordflow">for</span> (NPCFlagList::const_iterator itr = flist.begin(); itr != flist.end(); ++itr)</div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span>                {</div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno">  894</span>                    <span class="keywordflow">if</span> (itr-&gt;first == guid)</div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span>                    {</div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno">  896</span>                        event_npc_flag = itr-&gt;second;</div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span>                        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno">  898</span>                    }</div>
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno">  899</span>                }</div>
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno">  900</span>                <span class="comment">// get creature entry</span></div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno">  901</span>                newEntry.<a class="code hl_variable" href="../../d1/d86/a08252.html#a924aaeec6de12ef02b5d2f9801571a1f">entry</a> = 0;</div>
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno">  902</span> </div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span>                <span class="keywordflow">if</span> (<a class="code hl_struct" href="../../d0/dd1/a07484.html">CreatureData</a> <span class="keyword">const</span>* data = <a class="code hl_define" href="../../d8/d4e/a01355.html#a736e30da2b5261060ac6cdbb5de3b787">sObjectMgr</a>-&gt;GetCreatureData(guid))</div>
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno">  904</span>                    newEntry.<a class="code hl_variable" href="../../d1/d86/a08252.html#a924aaeec6de12ef02b5d2f9801571a1f">entry</a> = data-&gt;id1;</div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno">  905</span> </div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span>                <span class="comment">// check validity with event&#39;s npcflag</span></div>
<div class="line"><a id="l00907" name="l00907"></a><span class="lineno">  907</span>                if (!<a class="code hl_define" href="../../d8/d4e/a01355.html#a736e30da2b5261060ac6cdbb5de3b787">sObjectMgr</a>-&gt;IsVendorItemValid(newEntry.<a class="code hl_variable" href="../../d1/d86/a08252.html#a924aaeec6de12ef02b5d2f9801571a1f">entry</a>, newEntry.<a class="code hl_variable" href="../../d1/d86/a08252.html#a8f2e01fb177f33afeef9e37ffd456ff2">item</a>, newEntry.<a class="code hl_variable" href="../../d1/d86/a08252.html#a48cb32b398e0dc6928a30bb254b05a11">maxcount</a>, newEntry.<a class="code hl_variable" href="../../d1/d86/a08252.html#ab86bdb08475c1c2b75755fffcb6b8275">incrtime</a>, newEntry.<a class="code hl_variable" href="../../d1/d86/a08252.html#ac826dc078ef456ed93bf23175bce243d">ExtendedCost</a>, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>, event_npc_flag))</div>
<div class="line"><a id="l00908" name="l00908"></a><span class="lineno">  908</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00909" name="l00909"></a><span class="lineno">  909</span> </div>
<div class="line"><a id="l00910" name="l00910"></a><span class="lineno">  910</span>                vendors.push_back(newEntry);</div>
<div class="line"><a id="l00911" name="l00911"></a><span class="lineno">  911</span> </div>
<div class="line"><a id="l00912" name="l00912"></a><span class="lineno">  912</span>                ++count;</div>
<div class="line"><a id="l00913" name="l00913"></a><span class="lineno">  913</span>            } <span class="keywordflow">while</span> (result-&gt;NextRow());</div>
<div class="line"><a id="l00914" name="l00914"></a><span class="lineno">  914</span> </div>
<div class="line"><a id="l00915" name="l00915"></a><span class="lineno">  915</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; Loaded {} Vendor Additions In Game Events in {} ms&quot;</span>, count, <a class="code hl_function" href="../../d4/ddf/a00488.html#a23a2c8663a05f2b03a6f85501972e8c0">GetMSTimeDiffToNow</a>(oldMSTime));</div>
<div class="line"><a id="l00916" name="l00916"></a><span class="lineno">  916</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a id="l00917" name="l00917"></a><span class="lineno">  917</span>        }</div>
<div class="line"><a id="l00918" name="l00918"></a><span class="lineno">  918</span>    }</div>
<div class="line"><a id="l00919" name="l00919"></a><span class="lineno">  919</span> </div>
<div class="line"><a id="l00920" name="l00920"></a><span class="lineno">  920</span>    <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;Loading Game Event Battleground Data...&quot;</span>);</div>
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno">  921</span>    {</div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno">  922</span>        <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> oldMSTime = <a class="code hl_function" href="../../d4/ddf/a00488.html#a4476c8e13ea790c3536f2749105f9cb9">getMSTime</a>();</div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno">  923</span> </div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno">  924</span>        <span class="comment">//                                                   0         1</span></div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno">  925</span>        <a class="code hl_typedef" href="../../d0/d3e/a00566.html#ab0c9feeec448a181290fcb39565b8253">QueryResult</a> result = <a class="code hl_variable" href="../../d9/d19/a00560.html#afa9a6509f9913c9c7dd3081523badd7c">WorldDatabase</a>.Query(<span class="stringliteral">&quot;SELECT eventEntry, bgflag FROM game_event_battleground_holiday&quot;</span>);</div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno">  926</span> </div>
<div class="line"><a id="l00927" name="l00927"></a><span class="lineno">  927</span>        <span class="keywordflow">if</span> (!result)</div>
<div class="line"><a id="l00928" name="l00928"></a><span class="lineno">  928</span>        {</div>
<div class="line"><a id="l00929" name="l00929"></a><span class="lineno">  929</span>            <a class="code hl_define" href="../../da/de0/a00317.html#adf09840a666e1d86bcd3439105db6edc">LOG_WARN</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; Loaded 0 Battleground Holidays In Game Events. DB table `game_event_battleground_holiday` is empty.&quot;</span>);</div>
<div class="line"><a id="l00930" name="l00930"></a><span class="lineno">  930</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a id="l00931" name="l00931"></a><span class="lineno">  931</span>        }</div>
<div class="line"><a id="l00932" name="l00932"></a><span class="lineno">  932</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno">  933</span>        {</div>
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno">  934</span>            <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> count = 0;</div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno">  935</span>            <span class="keywordflow">do</span></div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno">  936</span>            {</div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno">  937</span>                <a class="code hl_class" href="../../d3/d02/a05368.html">Field</a>* fields = result-&gt;Fetch();</div>
<div class="line"><a id="l00938" name="l00938"></a><span class="lineno">  938</span> </div>
<div class="line"><a id="l00939" name="l00939"></a><span class="lineno">  939</span>                <a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a> event_id = fields[0].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a15a8d014fadf85c99a2268d8cbd00767">uint8</a>&gt;();</div>
<div class="line"><a id="l00940" name="l00940"></a><span class="lineno">  940</span> </div>
<div class="line"><a id="l00941" name="l00941"></a><span class="lineno">  941</span>                <span class="keywordflow">if</span> (event_id &gt;= <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>.size())</div>
<div class="line"><a id="l00942" name="l00942"></a><span class="lineno">  942</span>                {</div>
<div class="line"><a id="l00943" name="l00943"></a><span class="lineno">  943</span>                    <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;sql.sql&quot;</span>, <span class="stringliteral">&quot;`game_event_battleground_holiday` game event id ({}) is out of range compared to max event id in `game_event`&quot;</span>, event_id);</div>
<div class="line"><a id="l00944" name="l00944"></a><span class="lineno">  944</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno">  945</span>                }</div>
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno">  946</span> </div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span>                <a class="code hl_variable" href="../../d1/d78/a08256.html#a75d9f60bb8efddc6290683f0bc22bc0f">mGameEventBattlegroundHolidays</a>[event_id] = fields[1].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>&gt;();</div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span> </div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span>                ++count;</div>
<div class="line"><a id="l00950" name="l00950"></a><span class="lineno">  950</span>            } <span class="keywordflow">while</span> (result-&gt;NextRow());</div>
<div class="line"><a id="l00951" name="l00951"></a><span class="lineno">  951</span> </div>
<div class="line"><a id="l00952" name="l00952"></a><span class="lineno">  952</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; Loaded {} Battleground Holidays In Game Events in {} ms&quot;</span>, count, <a class="code hl_function" href="../../d4/ddf/a00488.html#a23a2c8663a05f2b03a6f85501972e8c0">GetMSTimeDiffToNow</a>(oldMSTime));</div>
<div class="line"><a id="l00953" name="l00953"></a><span class="lineno">  953</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a id="l00954" name="l00954"></a><span class="lineno">  954</span>        }</div>
<div class="line"><a id="l00955" name="l00955"></a><span class="lineno">  955</span>    }</div>
<div class="line"><a id="l00956" name="l00956"></a><span class="lineno">  956</span> </div>
<div class="line"><a id="l00957" name="l00957"></a><span class="lineno">  957</span>    <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;Loading Game Event Pool Data...&quot;</span>);</div>
<div class="line"><a id="l00958" name="l00958"></a><span class="lineno">  958</span>    {</div>
<div class="line"><a id="l00959" name="l00959"></a><span class="lineno">  959</span>        <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> oldMSTime = <a class="code hl_function" href="../../d4/ddf/a00488.html#a4476c8e13ea790c3536f2749105f9cb9">getMSTime</a>();</div>
<div class="line"><a id="l00960" name="l00960"></a><span class="lineno">  960</span> </div>
<div class="line"><a id="l00961" name="l00961"></a><span class="lineno">  961</span>        <span class="comment">//                                                               0                         1</span></div>
<div class="line"><a id="l00962" name="l00962"></a><span class="lineno">  962</span>        <a class="code hl_typedef" href="../../d0/d3e/a00566.html#ab0c9feeec448a181290fcb39565b8253">QueryResult</a> result = <a class="code hl_variable" href="../../d9/d19/a00560.html#afa9a6509f9913c9c7dd3081523badd7c">WorldDatabase</a>.Query(<span class="stringliteral">&quot;SELECT pool_template.entry, game_event_pool.eventEntry FROM pool_template&quot;</span></div>
<div class="line"><a id="l00963" name="l00963"></a><span class="lineno">  963</span>                             <span class="stringliteral">&quot; JOIN game_event_pool ON pool_template.entry = game_event_pool.pool_entry&quot;</span>);</div>
<div class="line"><a id="l00964" name="l00964"></a><span class="lineno">  964</span> </div>
<div class="line"><a id="l00965" name="l00965"></a><span class="lineno">  965</span>        <span class="keywordflow">if</span> (!result)</div>
<div class="line"><a id="l00966" name="l00966"></a><span class="lineno">  966</span>        {</div>
<div class="line"><a id="l00967" name="l00967"></a><span class="lineno">  967</span>            <a class="code hl_define" href="../../da/de0/a00317.html#adf09840a666e1d86bcd3439105db6edc">LOG_WARN</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; Loaded 0 Pools For Game Events. DB Table `game_event_pool` Is Empty.&quot;</span>);</div>
<div class="line"><a id="l00968" name="l00968"></a><span class="lineno">  968</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a id="l00969" name="l00969"></a><span class="lineno">  969</span>        }</div>
<div class="line"><a id="l00970" name="l00970"></a><span class="lineno">  970</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno">  971</span>        {</div>
<div class="line"><a id="l00972" name="l00972"></a><span class="lineno">  972</span>            <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> count = 0;</div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span>            <span class="keywordflow">do</span></div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span>            {</div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno">  975</span>                <a class="code hl_class" href="../../d3/d02/a05368.html">Field</a>* fields = result-&gt;Fetch();</div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno">  976</span> </div>
<div class="line"><a id="l00977" name="l00977"></a><span class="lineno">  977</span>                <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> entry   = fields[0].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>&gt;();</div>
<div class="line"><a id="l00978" name="l00978"></a><span class="lineno">  978</span>                <a class="code hl_typedef" href="../../d1/da8/a00230.html#aecf4e3680a32207d17f62a3426731878">int16</a> event_id = fields[1].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a3bb8a71f4ae9af551f71e9eb2c9c3325">int8</a>&gt;();</div>
<div class="line"><a id="l00979" name="l00979"></a><span class="lineno">  979</span> </div>
<div class="line"><a id="l00980" name="l00980"></a><span class="lineno">  980</span>                <a class="code hl_typedef" href="../../d1/da8/a00230.html#a0bf9964a3ce962c07ad3d8b5432bbbcd">int32</a> internal_event_id = <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>.size() + event_id - 1;</div>
<div class="line"><a id="l00981" name="l00981"></a><span class="lineno">  981</span> </div>
<div class="line"><a id="l00982" name="l00982"></a><span class="lineno">  982</span>                <span class="keywordflow">if</span> (internal_event_id &lt; 0 || internal_event_id &gt;= <a class="code hl_typedef" href="../../d1/da8/a00230.html#a0bf9964a3ce962c07ad3d8b5432bbbcd">int32</a>(<a class="code hl_variable" href="../../d1/d78/a08256.html#a26e2b8498a7fe67293acbf09ae1e9e8f">mGameEventPoolIds</a>.size()))</div>
<div class="line"><a id="l00983" name="l00983"></a><span class="lineno">  983</span>                {</div>
<div class="line"><a id="l00984" name="l00984"></a><span class="lineno">  984</span>                    <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;sql.sql&quot;</span>, <span class="stringliteral">&quot;`game_event_pool` game event id ({}) is out of range compared to max event id in `game_event`&quot;</span>, event_id);</div>
<div class="line"><a id="l00985" name="l00985"></a><span class="lineno">  985</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00986" name="l00986"></a><span class="lineno">  986</span>                }</div>
<div class="line"><a id="l00987" name="l00987"></a><span class="lineno">  987</span> </div>
<div class="line"><a id="l00988" name="l00988"></a><span class="lineno">  988</span>                <span class="keywordflow">if</span> (!<a class="code hl_define" href="../../d7/d62/a01805.html#a9189dd9c6265b9e6d57104dd61a5fe85">sPoolMgr</a>-&gt;CheckPool(entry))</div>
<div class="line"><a id="l00989" name="l00989"></a><span class="lineno">  989</span>                {</div>
<div class="line"><a id="l00990" name="l00990"></a><span class="lineno">  990</span>                    <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;sql.sql&quot;</span>, <span class="stringliteral">&quot;Pool Id ({}) has all creatures or gameobjects with explicit chance sum &lt;&gt;100 and no equal chance defined. The pool system cannot pick one to spawn.&quot;</span>, entry);</div>
<div class="line"><a id="l00991" name="l00991"></a><span class="lineno">  991</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00992" name="l00992"></a><span class="lineno">  992</span>                }</div>
<div class="line"><a id="l00993" name="l00993"></a><span class="lineno">  993</span> </div>
<div class="line"><a id="l00994" name="l00994"></a><span class="lineno">  994</span>                <a class="code hl_typedef" href="../../d1/d78/a08256.html#ab3f5d0658fb968dcc19141f20735d5d2">IdList</a>&amp; poollist = <a class="code hl_variable" href="../../d1/d78/a08256.html#a26e2b8498a7fe67293acbf09ae1e9e8f">mGameEventPoolIds</a>[internal_event_id];</div>
<div class="line"><a id="l00995" name="l00995"></a><span class="lineno">  995</span>                poollist.push_back(entry);</div>
<div class="line"><a id="l00996" name="l00996"></a><span class="lineno">  996</span> </div>
<div class="line"><a id="l00997" name="l00997"></a><span class="lineno">  997</span>                ++count;</div>
<div class="line"><a id="l00998" name="l00998"></a><span class="lineno">  998</span>            } <span class="keywordflow">while</span> (result-&gt;NextRow());</div>
<div class="line"><a id="l00999" name="l00999"></a><span class="lineno">  999</span> </div>
<div class="line"><a id="l01000" name="l01000"></a><span class="lineno"> 1000</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; Loaded {} Pools For Game Events in {} ms&quot;</span>, count, <a class="code hl_function" href="../../d4/ddf/a00488.html#a23a2c8663a05f2b03a6f85501972e8c0">GetMSTimeDiffToNow</a>(oldMSTime));</div>
<div class="line"><a id="l01001" name="l01001"></a><span class="lineno"> 1001</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a id="l01002" name="l01002"></a><span class="lineno"> 1002</span>        }</div>
<div class="line"><a id="l01003" name="l01003"></a><span class="lineno"> 1003</span>    }</div>
<div class="line"><a id="l01004" name="l01004"></a><span class="lineno"> 1004</span>}</div>
<div class="line"><a id="l01005" name="l01005"></a><span class="lineno"> 1005</span> </div>
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"><a class="line" href="../../d1/d78/a08256.html#a174197311760e9c22650e362368ec630"> 1006</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d1/d78/a08256.html#a174197311760e9c22650e362368ec630">GameEventMgr::LoadHolidayDates</a>()</div>
<div class="line"><a id="l01007" name="l01007"></a><span class="lineno"> 1007</span>{</div>
<div class="line"><a id="l01008" name="l01008"></a><span class="lineno"> 1008</span>    <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> oldMSTime = <a class="code hl_function" href="../../d4/ddf/a00488.html#a4476c8e13ea790c3536f2749105f9cb9">getMSTime</a>();</div>
<div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span> </div>
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"> 1010</span>    <span class="comment">//                                               0   1        2           3</span></div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span>    <a class="code hl_typedef" href="../../d0/d3e/a00566.html#ab0c9feeec448a181290fcb39565b8253">QueryResult</a> result = <a class="code hl_variable" href="../../d9/d19/a00560.html#afa9a6509f9913c9c7dd3081523badd7c">WorldDatabase</a>.Query(<span class="stringliteral">&quot;SELECT id, date_id, date_value, holiday_duration FROM holiday_dates&quot;</span>);</div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span> </div>
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"> 1013</span>    <span class="keywordflow">if</span> (!result)</div>
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"> 1014</span>    {</div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"> 1015</span>        <a class="code hl_define" href="../../da/de0/a00317.html#adf09840a666e1d86bcd3439105db6edc">LOG_WARN</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; Loaded 0 holiday dates. DB table `holiday_dates` is empty.&quot;</span>);</div>
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"> 1016</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span>    }</div>
<div class="line"><a id="l01018" name="l01018"></a><span class="lineno"> 1018</span> </div>
<div class="line"><a id="l01019" name="l01019"></a><span class="lineno"> 1019</span>    <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> count = 0;</div>
<div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span>    <span class="keywordflow">do</span></div>
<div class="line"><a id="l01021" name="l01021"></a><span class="lineno"> 1021</span>    {</div>
<div class="line"><a id="l01022" name="l01022"></a><span class="lineno"> 1022</span>        <a class="code hl_class" href="../../d3/d02/a05368.html">Field</a>* fields = result-&gt;Fetch();</div>
<div class="line"><a id="l01023" name="l01023"></a><span class="lineno"> 1023</span> </div>
<div class="line"><a id="l01024" name="l01024"></a><span class="lineno"> 1024</span>        <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> holidayId = fields[0].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>&gt;();</div>
<div class="line"><a id="l01025" name="l01025"></a><span class="lineno"> 1025</span>        <a class="code hl_struct" href="../../d1/d3d/a30196.html">HolidaysEntry</a>* entry = <span class="keyword">const_cast&lt;</span><a class="code hl_struct" href="../../d1/d3d/a30196.html">HolidaysEntry</a>*<span class="keyword">&gt;</span>(<a class="code hl_variable" href="../../d9/d7c/a01073.html#a817e11f567a65f71476999c0012318bd">sHolidaysStore</a>.LookupEntry(holidayId));</div>
<div class="line"><a id="l01026" name="l01026"></a><span class="lineno"> 1026</span>        <span class="keywordflow">if</span> (!entry)</div>
<div class="line"><a id="l01027" name="l01027"></a><span class="lineno"> 1027</span>        {</div>
<div class="line"><a id="l01028" name="l01028"></a><span class="lineno"> 1028</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;sql.sql&quot;</span>, <span class="stringliteral">&quot;holiday_dates entry has invalid holiday id {}.&quot;</span>, holidayId);</div>
<div class="line"><a id="l01029" name="l01029"></a><span class="lineno"> 1029</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01030" name="l01030"></a><span class="lineno"> 1030</span>        }</div>
<div class="line"><a id="l01031" name="l01031"></a><span class="lineno"> 1031</span> </div>
<div class="line"><a id="l01032" name="l01032"></a><span class="lineno"> 1032</span>        <a class="code hl_typedef" href="../../d1/da8/a00230.html#a15a8d014fadf85c99a2268d8cbd00767">uint8</a> dateId = fields[1].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a15a8d014fadf85c99a2268d8cbd00767">uint8</a>&gt;();</div>
<div class="line"><a id="l01033" name="l01033"></a><span class="lineno"> 1033</span>        <span class="keywordflow">if</span> (dateId &gt;= <a class="code hl_define" href="../../d1/d7a/a04262.html#ae9554dfb95ff901f440f4166cf1d04ab">MAX_HOLIDAY_DATES</a>)</div>
<div class="line"><a id="l01034" name="l01034"></a><span class="lineno"> 1034</span>        {</div>
<div class="line"><a id="l01035" name="l01035"></a><span class="lineno"> 1035</span>            <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;sql.sql&quot;</span>, <span class="stringliteral">&quot;holiday_dates entry has out of range date_id {}.&quot;</span>, dateId);</div>
<div class="line"><a id="l01036" name="l01036"></a><span class="lineno"> 1036</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"> 1037</span>        }</div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"> 1038</span>        entry-&gt;Date[dateId] = fields[2].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>&gt;();</div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"> 1039</span> </div>
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"> 1040</span>        <span class="keywordflow">if</span> (<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> duration = fields[3].Get&lt;uint32&gt;())</div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"> 1041</span>            entry-&gt;Duration[0] = duration;</div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"> 1042</span> </div>
<div class="line"><a id="l01043" name="l01043"></a><span class="lineno"> 1043</span>        <span class="keyword">auto</span> itr = std::lower_bound(<a class="code hl_variable" href="../../d1/d78/a08256.html#afca80ec9e1640a85eaae605f2e166748">modifiedHolidays</a>.begin(), <a class="code hl_variable" href="../../d1/d78/a08256.html#afca80ec9e1640a85eaae605f2e166748">modifiedHolidays</a>.end(), entry-&gt;Id);</div>
<div class="line"><a id="l01044" name="l01044"></a><span class="lineno"> 1044</span>        <span class="keywordflow">if</span> (itr == <a class="code hl_variable" href="../../d1/d78/a08256.html#afca80ec9e1640a85eaae605f2e166748">modifiedHolidays</a>.end() || *itr != entry-&gt;Id)</div>
<div class="line"><a id="l01045" name="l01045"></a><span class="lineno"> 1045</span>        {</div>
<div class="line"><a id="l01046" name="l01046"></a><span class="lineno"> 1046</span>            <a class="code hl_variable" href="../../d1/d78/a08256.html#afca80ec9e1640a85eaae605f2e166748">modifiedHolidays</a>.insert(itr, entry-&gt;Id);</div>
<div class="line"><a id="l01047" name="l01047"></a><span class="lineno"> 1047</span>        }</div>
<div class="line"><a id="l01048" name="l01048"></a><span class="lineno"> 1048</span> </div>
<div class="line"><a id="l01049" name="l01049"></a><span class="lineno"> 1049</span>        ++count;</div>
<div class="line"><a id="l01050" name="l01050"></a><span class="lineno"> 1050</span>    } <span class="keywordflow">while</span> (result-&gt;NextRow());</div>
<div class="line"><a id="l01051" name="l01051"></a><span class="lineno"> 1051</span> </div>
<div class="line"><a id="l01052" name="l01052"></a><span class="lineno"> 1052</span>    <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;&gt;&gt; Loaded {} Holiday Dates in {} ms&quot;</span>, count, <a class="code hl_function" href="../../d4/ddf/a00488.html#a23a2c8663a05f2b03a6f85501972e8c0">GetMSTimeDiffToNow</a>(oldMSTime));</div>
<div class="line"><a id="l01053" name="l01053"></a><span class="lineno"> 1053</span>}</div>
<div class="line"><a id="l01054" name="l01054"></a><span class="lineno"> 1054</span> </div>
<div class="line"><a id="l01055" name="l01055"></a><span class="lineno"><a class="line" href="../../d1/d78/a08256.html#abd6517d99e2187dce7a8db423c8c8886"> 1055</a></span><a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> <a class="code hl_function" href="../../d1/d78/a08256.html#abd6517d99e2187dce7a8db423c8c8886">GameEventMgr::GetNPCFlag</a>(<a class="code hl_class" href="../../dc/d6f/a07436.html">Creature</a>* cr)</div>
<div class="line"><a id="l01056" name="l01056"></a><span class="lineno"> 1056</span>{</div>
<div class="line"><a id="l01057" name="l01057"></a><span class="lineno"> 1057</span>    <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> mask = 0;</div>
<div class="line"><a id="l01058" name="l01058"></a><span class="lineno"> 1058</span>    <a class="code hl_typedef" href="../../da/d98/a07852.html#aa278d50613c05dc1333df5185a6993eb">ObjectGuid::LowType</a> spawnId = cr-&gt;<a class="code hl_function" href="../../dc/d6f/a07436.html#a94ab8e421d4a244df52b7a6b74b2842a">GetSpawnId</a>();</div>
<div class="line"><a id="l01059" name="l01059"></a><span class="lineno"> 1059</span> </div>
<div class="line"><a id="l01060" name="l01060"></a><span class="lineno"> 1060</span>    <span class="keywordflow">for</span> (ActiveEvents::iterator e_itr = <a class="code hl_variable" href="../../d1/d78/a08256.html#a177cd794e719b24cf1bc70fc7316a8e5">m_ActiveEvents</a>.begin(); e_itr != <a class="code hl_variable" href="../../d1/d78/a08256.html#a177cd794e719b24cf1bc70fc7316a8e5">m_ActiveEvents</a>.end(); ++e_itr)</div>
<div class="line"><a id="l01061" name="l01061"></a><span class="lineno"> 1061</span>    {</div>
<div class="line"><a id="l01062" name="l01062"></a><span class="lineno"> 1062</span>        <span class="keywordflow">for</span> (NPCFlagList::iterator itr = <a class="code hl_variable" href="../../d1/d78/a08256.html#a23a28a5ae28efdd54deceeca15969196">mGameEventNPCFlags</a>[*e_itr].begin(); itr != <a class="code hl_variable" href="../../d1/d78/a08256.html#a23a28a5ae28efdd54deceeca15969196">mGameEventNPCFlags</a>[*e_itr].end(); ++ itr)</div>
<div class="line"><a id="l01063" name="l01063"></a><span class="lineno"> 1063</span>            <span class="keywordflow">if</span> (itr-&gt;first == spawnId)</div>
<div class="line"><a id="l01064" name="l01064"></a><span class="lineno"> 1064</span>                mask |= itr-&gt;second;</div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"> 1065</span>    }</div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"> 1066</span> </div>
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"> 1067</span>    <span class="keywordflow">return</span> mask;</div>
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"> 1068</span>}</div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span> </div>
<div class="line"><a id="l01070" name="l01070"></a><span class="lineno"><a class="line" href="../../d1/d78/a08256.html#a28ca52de327400c39c8709cd40dd1e97"> 1070</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d1/d78/a08256.html#a28ca52de327400c39c8709cd40dd1e97">GameEventMgr::Initialize</a>()</div>
<div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span>{</div>
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"> 1072</span>    <a class="code hl_typedef" href="../../d0/d3e/a00566.html#ab0c9feeec448a181290fcb39565b8253">QueryResult</a> result = <a class="code hl_variable" href="../../d9/d19/a00560.html#afa9a6509f9913c9c7dd3081523badd7c">WorldDatabase</a>.Query(<span class="stringliteral">&quot;SELECT MAX(eventEntry) FROM game_event&quot;</span>);</div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span>    <span class="keywordflow">if</span> (result)</div>
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"> 1074</span>    {</div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span>        <a class="code hl_class" href="../../d3/d02/a05368.html">Field</a>* fields = result-&gt;Fetch();</div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"> 1076</span> </div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span>        <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> maxEventId = fields[0].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a15a8d014fadf85c99a2268d8cbd00767">uint8</a>&gt;();</div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span> </div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"> 1079</span>        <span class="comment">// Id starts with 1 and vector with 0, thus increment</span></div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span>        maxEventId++;</div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span> </div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span>        <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>.resize(maxEventId);</div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span>        <a class="code hl_variable" href="../../d1/d78/a08256.html#a340bf17cd48de8175a242d54e0bc88b9">mGameEventCreatureGuids</a>.resize(maxEventId * 2 - 1);</div>
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"> 1084</span>        <a class="code hl_variable" href="../../d1/d78/a08256.html#a7e8911e4170a84527a7eb3d73a8a30f1">mGameEventGameobjectGuids</a>.resize(maxEventId * 2 - 1);</div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span>        <a class="code hl_variable" href="../../d1/d78/a08256.html#a7b61b9926bb2e7ad9a3be4e541f9a4e8">mGameEventCreatureQuests</a>.resize(maxEventId);</div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span>        <a class="code hl_variable" href="../../d1/d78/a08256.html#ab470698b19df4edd09f6b32fcfe120fc">mGameEventGameObjectQuests</a>.resize(maxEventId);</div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span>        <a class="code hl_variable" href="../../d1/d78/a08256.html#a7a78bd9b0c6f4cc32e386794955ac3b5">mGameEventVendors</a>.resize(maxEventId);</div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span>        <a class="code hl_variable" href="../../d1/d78/a08256.html#a75d9f60bb8efddc6290683f0bc22bc0f">mGameEventBattlegroundHolidays</a>.resize(maxEventId, 0);</div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span>        <a class="code hl_variable" href="../../d1/d78/a08256.html#a26e2b8498a7fe67293acbf09ae1e9e8f">mGameEventPoolIds</a>.resize(maxEventId * 2 - 1);</div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"> 1090</span>        <a class="code hl_variable" href="../../d1/d78/a08256.html#a23a28a5ae28efdd54deceeca15969196">mGameEventNPCFlags</a>.resize(maxEventId);</div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span>        <a class="code hl_variable" href="../../d1/d78/a08256.html#a6b958e82cbac452d531da25e2dba66d7">mGameEventModelEquip</a>.resize(maxEventId);</div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span>    }</div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"> 1093</span>}</div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span> </div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"><a class="line" href="../../d1/d78/a08256.html#a95b7a4e78f4da9bf58cac7bba5554dcc"> 1095</a></span><a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> <a class="code hl_function" href="../../d1/d78/a08256.html#a95b7a4e78f4da9bf58cac7bba5554dcc">GameEventMgr::StartSystem</a>()                           <span class="comment">// return the next event delay in ms</span></div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span>{</div>
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"> 1097</span>    <a class="code hl_variable" href="../../d1/d78/a08256.html#a177cd794e719b24cf1bc70fc7316a8e5">m_ActiveEvents</a>.clear();</div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span>    <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> delay = <a class="code hl_function" href="../../d1/d78/a08256.html#a5028dfb5e2139cbf84a39e1ab4de383b">Update</a>();</div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span>    <a class="code hl_variable" href="../../d1/d78/a08256.html#aceae3117877a732131349ccd5593b0af">isSystemInit</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span>    <span class="keywordflow">return</span> delay;</div>
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"> 1101</span>}</div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span> </div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"><a class="line" href="../../d1/d78/a08256.html#adb0056cf47ac017721acb3374bafcb74"> 1103</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d1/d78/a08256.html#adb0056cf47ac017721acb3374bafcb74">GameEventMgr::StartArenaSeason</a>()</div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span>{</div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"> 1105</span>    <a class="code hl_typedef" href="../../d1/da8/a00230.html#a15a8d014fadf85c99a2268d8cbd00767">uint8</a> season = <a class="code hl_define" href="../../d3/d74/a04418.html#ga05dfb35c344e5b947a19e4284e7f5fa7">sWorld</a>-&gt;getIntConfig(<a class="code hl_enumvalue" href="../../d8/d6f/a02234.html#a17aac4c166ebe43e3b8fdccf9e012e41a03feb682b413bff57fddbc0f97cc7253">CONFIG_ARENA_SEASON_ID</a>);</div>
<div class="line"><a id="l01106" name="l01106"></a><span class="lineno"> 1106</span>    <a class="code hl_typedef" href="../../d0/d3e/a00566.html#ab0c9feeec448a181290fcb39565b8253">QueryResult</a> result = <a class="code hl_variable" href="../../d9/d19/a00560.html#afa9a6509f9913c9c7dd3081523badd7c">WorldDatabase</a>.Query(<span class="stringliteral">&quot;SELECT eventEntry FROM game_event_arena_seasons WHERE season = &#39;{}&#39;&quot;</span>, season);</div>
<div class="line"><a id="l01107" name="l01107"></a><span class="lineno"> 1107</span> </div>
<div class="line"><a id="l01108" name="l01108"></a><span class="lineno"> 1108</span>    <span class="keywordflow">if</span> (!result)</div>
<div class="line"><a id="l01109" name="l01109"></a><span class="lineno"> 1109</span>    {</div>
<div class="line"><a id="l01110" name="l01110"></a><span class="lineno"> 1110</span>        <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;gameevent&quot;</span>, <span class="stringliteral">&quot;ArenaSeason ({}) must be an existant Arena Season&quot;</span>, season);</div>
<div class="line"><a id="l01111" name="l01111"></a><span class="lineno"> 1111</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01112" name="l01112"></a><span class="lineno"> 1112</span>    }</div>
<div class="line"><a id="l01113" name="l01113"></a><span class="lineno"> 1113</span> </div>
<div class="line"><a id="l01114" name="l01114"></a><span class="lineno"> 1114</span>    <a class="code hl_class" href="../../d3/d02/a05368.html">Field</a>* fields = result-&gt;Fetch();</div>
<div class="line"><a id="l01115" name="l01115"></a><span class="lineno"> 1115</span>    <a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a> eventId = fields[0].<a class="code hl_function" href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Get</a>&lt;<a class="code hl_typedef" href="../../d1/da8/a00230.html#a15a8d014fadf85c99a2268d8cbd00767">uint8</a>&gt;();</div>
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"> 1116</span> </div>
<div class="line"><a id="l01117" name="l01117"></a><span class="lineno"> 1117</span>    <span class="keywordflow">if</span> (eventId &gt;= <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>.size())</div>
<div class="line"><a id="l01118" name="l01118"></a><span class="lineno"> 1118</span>    {</div>
<div class="line"><a id="l01119" name="l01119"></a><span class="lineno"> 1119</span>        <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;gameevent&quot;</span>, <span class="stringliteral">&quot;EventEntry {} for ArenaSeason ({}) does not exists&quot;</span>, eventId, season);</div>
<div class="line"><a id="l01120" name="l01120"></a><span class="lineno"> 1120</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01121" name="l01121"></a><span class="lineno"> 1121</span>    }</div>
<div class="line"><a id="l01122" name="l01122"></a><span class="lineno"> 1122</span> </div>
<div class="line"><a id="l01123" name="l01123"></a><span class="lineno"> 1123</span>    <a class="code hl_function" href="../../d1/d78/a08256.html#a1a07f3fb3ac74ddb929d00a0c5078186">StartEvent</a>(eventId, <span class="keyword">true</span>);</div>
<div class="line"><a id="l01124" name="l01124"></a><span class="lineno"> 1124</span>    <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot;Arena Season {} started...&quot;</span>, season);</div>
<div class="line"><a id="l01125" name="l01125"></a><span class="lineno"> 1125</span>    <a class="code hl_define" href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a>(<span class="stringliteral">&quot;server.loading&quot;</span>, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line"><a id="l01126" name="l01126"></a><span class="lineno"> 1126</span>}</div>
<div class="line"><a id="l01127" name="l01127"></a><span class="lineno"> 1127</span> </div>
<div class="line"><a id="l01128" name="l01128"></a><span class="lineno"><a class="line" href="../../d1/d78/a08256.html#a5028dfb5e2139cbf84a39e1ab4de383b"> 1128</a></span><a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> <a class="code hl_function" href="../../d1/d78/a08256.html#a5028dfb5e2139cbf84a39e1ab4de383b">GameEventMgr::Update</a>()                               <span class="comment">// return the next event delay in ms</span></div>
<div class="line"><a id="l01129" name="l01129"></a><span class="lineno"> 1129</span>{</div>
<div class="line"><a id="l01130" name="l01130"></a><span class="lineno"> 1130</span>    time_t currenttime = <a class="code hl_function" href="../../d1/d55/a04496.html#adbe1785d1327dedf2ac403b7cc8e99c2">GameTime::GetGameTime</a>().count();</div>
<div class="line"><a id="l01131" name="l01131"></a><span class="lineno"> 1131</span>    <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> nextEventDelay = <a class="code hl_define" href="../../d3/da4/a01343.html#adaa73d920934a951856f7ce003ce2342">max_ge_check_delay</a>;             <span class="comment">// 1 day</span></div>
<div class="line"><a id="l01132" name="l01132"></a><span class="lineno"> 1132</span>    <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> calcDelay;</div>
<div class="line"><a id="l01133" name="l01133"></a><span class="lineno"> 1133</span>    std::set&lt;uint16&gt; activate, deactivate;</div>
<div class="line"><a id="l01134" name="l01134"></a><span class="lineno"> 1134</span>    <span class="keywordflow">for</span> (<a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a> itr = 1; itr &lt; <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>.size(); ++itr)</div>
<div class="line"><a id="l01135" name="l01135"></a><span class="lineno"> 1135</span>    {</div>
<div class="line"><a id="l01136" name="l01136"></a><span class="lineno"> 1136</span>        <span class="comment">// must do the activating first, and after that the deactivating</span></div>
<div class="line"><a id="l01137" name="l01137"></a><span class="lineno"> 1137</span>        <span class="comment">// so first queue it</span></div>
<div class="line"><a id="l01138" name="l01138"></a><span class="lineno"> 1138</span>        <span class="comment">//LOG_ERROR(&quot;sql.sql&quot;, &quot;Checking event {}&quot;, itr);</span></div>
<div class="line"><a id="l01139" name="l01139"></a><span class="lineno"> 1139</span> </div>
<div class="line"><a id="l01140" name="l01140"></a><span class="lineno"> 1140</span>        <a class="code hl_define" href="../../d3/d67/a01958.html#ae8161e629869974bc49b1cbfc73c1087">sScriptMgr</a>-&gt;OnGameEventCheck(itr);</div>
<div class="line"><a id="l01141" name="l01141"></a><span class="lineno"> 1141</span> </div>
<div class="line"><a id="l01142" name="l01142"></a><span class="lineno"> 1142</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d1/d78/a08256.html#ac955ad9b948e13cde6de5f9f3dd01d03">CheckOneGameEvent</a>(itr))</div>
<div class="line"><a id="l01143" name="l01143"></a><span class="lineno"> 1143</span>        {</div>
<div class="line"><a id="l01144" name="l01144"></a><span class="lineno"> 1144</span>            <span class="comment">// if the world event is in NEXTPHASE state, and the time has passed to finish this event, then do so</span></div>
<div class="line"><a id="l01145" name="l01145"></a><span class="lineno"> 1145</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[itr].state == <a class="code hl_enumvalue" href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5aa9ecd88c85a086ee5273110051a00bc0">GAMEEVENT_WORLD_NEXTPHASE</a> &amp;&amp; <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[itr].nextstart &lt;= currenttime)</div>
<div class="line"><a id="l01146" name="l01146"></a><span class="lineno"> 1146</span>            {</div>
<div class="line"><a id="l01147" name="l01147"></a><span class="lineno"> 1147</span>                <span class="comment">// set this event to finished, null the nextstart time</span></div>
<div class="line"><a id="l01148" name="l01148"></a><span class="lineno"> 1148</span>                <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[itr].state = <a class="code hl_enumvalue" href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5a50f420580ff8bcf744a958e2613085bf">GAMEEVENT_WORLD_FINISHED</a>;</div>
<div class="line"><a id="l01149" name="l01149"></a><span class="lineno"> 1149</span>                <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[itr].nextstart = 0;</div>
<div class="line"><a id="l01150" name="l01150"></a><span class="lineno"> 1150</span>                <span class="comment">// save the state of this gameevent</span></div>
<div class="line"><a id="l01151" name="l01151"></a><span class="lineno"> 1151</span>                <a class="code hl_function" href="../../d1/d78/a08256.html#a89b36d2ce1114ee9b9316aa1ce41ff41">SaveWorldEventStateToDB</a>(itr);</div>
<div class="line"><a id="l01152" name="l01152"></a><span class="lineno"> 1152</span>                <span class="comment">// queue for deactivation</span></div>
<div class="line"><a id="l01153" name="l01153"></a><span class="lineno"> 1153</span>                <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d1/d78/a08256.html#a259b6e7b37520d0c23f06c6988e626c9">IsActiveEvent</a>(itr))</div>
<div class="line"><a id="l01154" name="l01154"></a><span class="lineno"> 1154</span>                    deactivate.insert(itr);</div>
<div class="line"><a id="l01155" name="l01155"></a><span class="lineno"> 1155</span>                <span class="comment">// go to next event, this no longer needs an event update timer</span></div>
<div class="line"><a id="l01156" name="l01156"></a><span class="lineno"> 1156</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01157" name="l01157"></a><span class="lineno"> 1157</span>            }</div>
<div class="line"><a id="l01158" name="l01158"></a><span class="lineno"> 1158</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[itr].state == <a class="code hl_enumvalue" href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5a627f133a79fe9018b98ee3646e334ff7">GAMEEVENT_WORLD_CONDITIONS</a> &amp;&amp; <a class="code hl_function" href="../../d1/d78/a08256.html#a90cfd68d799f3ac60f7eaf6eaa867e01">CheckOneGameEventConditions</a>(itr))</div>
<div class="line"><a id="l01159" name="l01159"></a><span class="lineno"> 1159</span>                <span class="comment">// changed, save to DB the gameevent state, will be updated in next update cycle</span></div>
<div class="line"><a id="l01160" name="l01160"></a><span class="lineno"> 1160</span>                <a class="code hl_function" href="../../d1/d78/a08256.html#a89b36d2ce1114ee9b9316aa1ce41ff41">SaveWorldEventStateToDB</a>(itr);</div>
<div class="line"><a id="l01161" name="l01161"></a><span class="lineno"> 1161</span> </div>
<div class="line"><a id="l01162" name="l01162"></a><span class="lineno"> 1162</span>            <span class="comment">// queue for activation</span></div>
<div class="line"><a id="l01163" name="l01163"></a><span class="lineno"> 1163</span>            <span class="keywordflow">if</span> (!<a class="code hl_function" href="../../d1/d78/a08256.html#a259b6e7b37520d0c23f06c6988e626c9">IsActiveEvent</a>(itr))</div>
<div class="line"><a id="l01164" name="l01164"></a><span class="lineno"> 1164</span>                activate.insert(itr);</div>
<div class="line"><a id="l01165" name="l01165"></a><span class="lineno"> 1165</span>        }</div>
<div class="line"><a id="l01166" name="l01166"></a><span class="lineno"> 1166</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l01167" name="l01167"></a><span class="lineno"> 1167</span>        {</div>
<div class="line"><a id="l01168" name="l01168"></a><span class="lineno"> 1168</span>            <span class="comment">// If event is inactive, periodically clean up its worldstate</span></div>
<div class="line"><a id="l01169" name="l01169"></a><span class="lineno"> 1169</span>            <a class="code hl_define" href="../../d3/d74/a04418.html#ga05dfb35c344e5b947a19e4284e7f5fa7">sWorld</a>-&gt;setWorldState(itr, 0);</div>
<div class="line"><a id="l01170" name="l01170"></a><span class="lineno"> 1170</span> </div>
<div class="line"><a id="l01171" name="l01171"></a><span class="lineno"> 1171</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d1/d78/a08256.html#a259b6e7b37520d0c23f06c6988e626c9">IsActiveEvent</a>(itr))</div>
<div class="line"><a id="l01172" name="l01172"></a><span class="lineno"> 1172</span>            {</div>
<div class="line"><a id="l01173" name="l01173"></a><span class="lineno"> 1173</span>                <span class="comment">// Xinef: do not deactivate internal events on whim</span></div>
<div class="line"><a id="l01174" name="l01174"></a><span class="lineno"> 1174</span>                <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[itr].state != <a class="code hl_enumvalue" href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5a2612ea68e0c9d21dae1af2e9ac04bc81">GAMEEVENT_INTERNAL</a>)</div>
<div class="line"><a id="l01175" name="l01175"></a><span class="lineno"> 1175</span>                    deactivate.insert(itr);</div>
<div class="line"><a id="l01176" name="l01176"></a><span class="lineno"> 1176</span>            }</div>
<div class="line"><a id="l01177" name="l01177"></a><span class="lineno"> 1177</span>            <span class="keywordflow">else</span></div>
<div class="line"><a id="l01178" name="l01178"></a><span class="lineno"> 1178</span>            {</div>
<div class="line"><a id="l01179" name="l01179"></a><span class="lineno"> 1179</span>                <span class="keywordflow">if</span> (!<a class="code hl_variable" href="../../d1/d78/a08256.html#aceae3117877a732131349ccd5593b0af">isSystemInit</a>)</div>
<div class="line"><a id="l01180" name="l01180"></a><span class="lineno"> 1180</span>                {</div>
<div class="line"><a id="l01181" name="l01181"></a><span class="lineno"> 1181</span>                    <a class="code hl_typedef" href="../../d1/da8/a00230.html#aecf4e3680a32207d17f62a3426731878">int16</a> event_nid = (-1) * (itr);</div>
<div class="line"><a id="l01182" name="l01182"></a><span class="lineno"> 1182</span>                    <span class="comment">// spawn all negative ones for this event</span></div>
<div class="line"><a id="l01183" name="l01183"></a><span class="lineno"> 1183</span>                    <a class="code hl_function" href="../../d1/d78/a08256.html#a2d4bee5a141e7042d7114ff064fe9ade">GameEventSpawn</a>(event_nid);</div>
<div class="line"><a id="l01184" name="l01184"></a><span class="lineno"> 1184</span>                }</div>
<div class="line"><a id="l01185" name="l01185"></a><span class="lineno"> 1185</span>            }</div>
<div class="line"><a id="l01186" name="l01186"></a><span class="lineno"> 1186</span>        }</div>
<div class="line"><a id="l01187" name="l01187"></a><span class="lineno"> 1187</span>        calcDelay = <a class="code hl_function" href="../../d1/d78/a08256.html#a0eb36f16c54cf394e57c862d3defc444">NextCheck</a>(itr);</div>
<div class="line"><a id="l01188" name="l01188"></a><span class="lineno"> 1188</span>        <span class="keywordflow">if</span> (calcDelay &lt; nextEventDelay)</div>
<div class="line"><a id="l01189" name="l01189"></a><span class="lineno"> 1189</span>            nextEventDelay = calcDelay;</div>
<div class="line"><a id="l01190" name="l01190"></a><span class="lineno"> 1190</span>    }</div>
<div class="line"><a id="l01191" name="l01191"></a><span class="lineno"> 1191</span>    <span class="comment">// now activate the queue</span></div>
<div class="line"><a id="l01192" name="l01192"></a><span class="lineno"> 1192</span>    <span class="comment">// a now activated event can contain a spawn of a to-be-deactivated one</span></div>
<div class="line"><a id="l01193" name="l01193"></a><span class="lineno"> 1193</span>    <span class="comment">// following the activate - deactivate order, deactivating the first event later will leave the spawn in (wont disappear then reappear clientside)</span></div>
<div class="line"><a id="l01194" name="l01194"></a><span class="lineno"> 1194</span>    <span class="keywordflow">for</span> (std::set&lt;uint16&gt;::iterator itr = activate.begin(); itr != activate.end(); ++itr)</div>
<div class="line"><a id="l01195" name="l01195"></a><span class="lineno"> 1195</span>        <span class="comment">// start the event</span></div>
<div class="line"><a id="l01196" name="l01196"></a><span class="lineno"> 1196</span>        <span class="comment">// returns true the started event completed</span></div>
<div class="line"><a id="l01197" name="l01197"></a><span class="lineno"> 1197</span>        <span class="comment">// in that case, initiate next update in 1 second</span></div>
<div class="line"><a id="l01198" name="l01198"></a><span class="lineno"> 1198</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d1/d78/a08256.html#a1a07f3fb3ac74ddb929d00a0c5078186">StartEvent</a>(*itr))</div>
<div class="line"><a id="l01199" name="l01199"></a><span class="lineno"> 1199</span>            nextEventDelay = 0;</div>
<div class="line"><a id="l01200" name="l01200"></a><span class="lineno"> 1200</span>    <span class="keywordflow">for</span> (std::set&lt;uint16&gt;::iterator itr = deactivate.begin(); itr != deactivate.end(); ++itr)</div>
<div class="line"><a id="l01201" name="l01201"></a><span class="lineno"> 1201</span>        <a class="code hl_function" href="../../d1/d78/a08256.html#ad7b6407e4c5fd950446c22e4a82cdc64">StopEvent</a>(*itr);</div>
<div class="line"><a id="l01202" name="l01202"></a><span class="lineno"> 1202</span> </div>
<div class="line"><a id="l01203" name="l01203"></a><span class="lineno"> 1203</span>    <a class="code hl_define" href="../../da/de0/a00317.html#a47ac782b14a7531c6232777165a1a161">LOG_DEBUG</a>(<span class="stringliteral">&quot;gameevent&quot;</span>, <span class="stringliteral">&quot;Next game event check in {} seconds.&quot;</span>, nextEventDelay + 1);</div>
<div class="line"><a id="l01204" name="l01204"></a><span class="lineno"> 1204</span>    <span class="keywordflow">return</span> (nextEventDelay + 1) * <a class="code hl_variable" href="../../df/dc8/a00122.html#a84190f79c8167211609f67284e066c58">IN_MILLISECONDS</a>;           <span class="comment">// Add 1 second to be sure event has started/stopped at next call</span></div>
<div class="line"><a id="l01205" name="l01205"></a><span class="lineno"> 1205</span>}</div>
<div class="line"><a id="l01206" name="l01206"></a><span class="lineno"> 1206</span> </div>
<div class="line"><a id="l01207" name="l01207"></a><span class="lineno"><a class="line" href="../../d1/d78/a08256.html#a35786821592979db6fe8b9df9176a359"> 1207</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d1/d78/a08256.html#a35786821592979db6fe8b9df9176a359">GameEventMgr::UnApplyEvent</a>(<a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a> event_id)</div>
<div class="line"><a id="l01208" name="l01208"></a><span class="lineno"> 1208</span>{</div>
<div class="line"><a id="l01209" name="l01209"></a><span class="lineno"> 1209</span>    <a class="code hl_define" href="../../da/de0/a00317.html#a47ac782b14a7531c6232777165a1a161">LOG_DEBUG</a>(<span class="stringliteral">&quot;gameevent&quot;</span>, <span class="stringliteral">&quot;GameEvent {} \&quot;{}\&quot; removed.&quot;</span>, event_id, <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id].description);</div>
<div class="line"><a id="l01211" name="l01211"></a><span class="lineno"> 1211</span>    <a class="code hl_function" href="../../d1/d78/a08256.html#a986be1d18003b8288ea3d7b422fc4d9a">RunSmartAIScripts</a>(event_id, <span class="keyword">false</span>);</div>
<div class="line"><a id="l01212" name="l01212"></a><span class="lineno"> 1212</span>    <span class="comment">// un-spawn positive event tagged objects</span></div>
<div class="line"><a id="l01213" name="l01213"></a><span class="lineno"> 1213</span>    <a class="code hl_function" href="../../d1/d78/a08256.html#a2e48d935ab7e575ab566c28108f98579">GameEventUnspawn</a>(event_id);</div>
<div class="line"><a id="l01214" name="l01214"></a><span class="lineno"> 1214</span>    <span class="comment">// spawn negative event tagget objects</span></div>
<div class="line"><a id="l01215" name="l01215"></a><span class="lineno"> 1215</span>    <a class="code hl_typedef" href="../../d1/da8/a00230.html#aecf4e3680a32207d17f62a3426731878">int16</a> event_nid = (-1) * event_id;</div>
<div class="line"><a id="l01216" name="l01216"></a><span class="lineno"> 1216</span>    <a class="code hl_function" href="../../d1/d78/a08256.html#a2d4bee5a141e7042d7114ff064fe9ade">GameEventSpawn</a>(event_nid);</div>
<div class="line"><a id="l01217" name="l01217"></a><span class="lineno"> 1217</span>    <span class="comment">// restore equipment or model</span></div>
<div class="line"><a id="l01218" name="l01218"></a><span class="lineno"> 1218</span>    <a class="code hl_function" href="../../d1/d78/a08256.html#a9243c0f76a791ab4f0613afc06026141">ChangeEquipOrModel</a>(event_id, <span class="keyword">false</span>);</div>
<div class="line"><a id="l01219" name="l01219"></a><span class="lineno"> 1219</span>    <span class="comment">// Remove quests that are events only to non event npc</span></div>
<div class="line"><a id="l01220" name="l01220"></a><span class="lineno"> 1220</span>    <a class="code hl_function" href="../../d1/d78/a08256.html#a361d3a758f1146282aae85b4ed294c59">UpdateEventQuests</a>(event_id, <span class="keyword">false</span>);</div>
<div class="line"><a id="l01221" name="l01221"></a><span class="lineno"> 1221</span>    <a class="code hl_function" href="../../d1/d78/a08256.html#a4947451f4fb593dbc16ac29d77dd603c">UpdateWorldStates</a>(event_id, <span class="keyword">false</span>);</div>
<div class="line"><a id="l01222" name="l01222"></a><span class="lineno"> 1222</span>    <span class="comment">// update npcflags in this event</span></div>
<div class="line"><a id="l01223" name="l01223"></a><span class="lineno"> 1223</span>    <a class="code hl_function" href="../../d1/d78/a08256.html#a8fb888e0cb07a113ec9096ff88ed9f32">UpdateEventNPCFlags</a>(event_id);</div>
<div class="line"><a id="l01224" name="l01224"></a><span class="lineno"> 1224</span>    <span class="comment">// remove vendor items</span></div>
<div class="line"><a id="l01225" name="l01225"></a><span class="lineno"> 1225</span>    <a class="code hl_function" href="../../d1/d78/a08256.html#a46a7a0698d46d61af6af5b836d6d404c">UpdateEventNPCVendor</a>(event_id, <span class="keyword">false</span>);</div>
<div class="line"><a id="l01226" name="l01226"></a><span class="lineno"> 1226</span>    <span class="comment">// update bg holiday</span></div>
<div class="line"><a id="l01227" name="l01227"></a><span class="lineno"> 1227</span>    <a class="code hl_function" href="../../d1/d78/a08256.html#a733cc959fd929bb86442c44fa2cb3ef9">UpdateBattlegroundSettings</a>();</div>
<div class="line"><a id="l01228" name="l01228"></a><span class="lineno"> 1228</span>}</div>
<div class="line"><a id="l01229" name="l01229"></a><span class="lineno"> 1229</span> </div>
<div class="line"><a id="l01230" name="l01230"></a><span class="lineno"><a class="line" href="../../d1/d78/a08256.html#a65de367ad07e0033c356f3e4559c96b7"> 1230</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d1/d78/a08256.html#a65de367ad07e0033c356f3e4559c96b7">GameEventMgr::ApplyNewEvent</a>(<a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a> event_id)</div>
<div class="line"><a id="l01231" name="l01231"></a><span class="lineno"> 1231</span>{</div>
<div class="line"><a id="l01232" name="l01232"></a><span class="lineno"> 1232</span>    <a class="code hl_typedef" href="../../d1/da8/a00230.html#a15a8d014fadf85c99a2268d8cbd00767">uint8</a> announce = <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id].announce;</div>
<div class="line"><a id="l01233" name="l01233"></a><span class="lineno"> 1233</span>    <span class="keywordflow">if</span> (announce == 1 || (announce == 2 &amp;&amp; <a class="code hl_define" href="../../d3/d74/a04418.html#ga05dfb35c344e5b947a19e4284e7f5fa7">sWorld</a>-&gt;getIntConfig(<a class="code hl_enumvalue" href="../../d8/d6f/a02234.html#a17aac4c166ebe43e3b8fdccf9e012e41a39e301a074c376e4a98a7d8222017733">CONFIG_EVENT_ANNOUNCE</a>)))</div>
<div class="line"><a id="l01234" name="l01234"></a><span class="lineno"> 1234</span>        <a class="code hl_define" href="../../d3/d74/a04418.html#ga05dfb35c344e5b947a19e4284e7f5fa7">sWorld</a>-&gt;SendWorldText(<a class="code hl_enumvalue" href="../../d4/d49/a01643.html#af9ee42b1cf006ecb2d2e74fe71c0761aa229b4b99cf47a371d3633cc3f21800df">LANG_EVENTMESSAGE</a>, <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id].description.c_str());</div>
<div class="line"><a id="l01235" name="l01235"></a><span class="lineno"> 1235</span> </div>
<div class="line"><a id="l01236" name="l01236"></a><span class="lineno"> 1236</span>    <a class="code hl_define" href="../../da/de0/a00317.html#a47ac782b14a7531c6232777165a1a161">LOG_DEBUG</a>(<span class="stringliteral">&quot;gameevent&quot;</span>, <span class="stringliteral">&quot;GameEvent {} \&quot;{}\&quot; started.&quot;</span>, event_id, <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id].description);</div>
<div class="line"><a id="l01237" name="l01237"></a><span class="lineno"> 1237</span> </div>
<div class="line"><a id="l01238" name="l01238"></a><span class="lineno"> 1238</span>    <span class="comment">// spawn positive event tagget objects</span></div>
<div class="line"><a id="l01239" name="l01239"></a><span class="lineno"> 1239</span>    <a class="code hl_function" href="../../d1/d78/a08256.html#a2d4bee5a141e7042d7114ff064fe9ade">GameEventSpawn</a>(event_id);</div>
<div class="line"><a id="l01240" name="l01240"></a><span class="lineno"> 1240</span>    <span class="comment">// un-spawn negative event tagged objects</span></div>
<div class="line"><a id="l01241" name="l01241"></a><span class="lineno"> 1241</span>    <a class="code hl_typedef" href="../../d1/da8/a00230.html#aecf4e3680a32207d17f62a3426731878">int16</a> event_nid = (-1) * event_id;</div>
<div class="line"><a id="l01242" name="l01242"></a><span class="lineno"> 1242</span>    <a class="code hl_function" href="../../d1/d78/a08256.html#a2e48d935ab7e575ab566c28108f98579">GameEventUnspawn</a>(event_nid);</div>
<div class="line"><a id="l01243" name="l01243"></a><span class="lineno"> 1243</span>    <span class="comment">// Change equipement or model</span></div>
<div class="line"><a id="l01244" name="l01244"></a><span class="lineno"> 1244</span>    <a class="code hl_function" href="../../d1/d78/a08256.html#a9243c0f76a791ab4f0613afc06026141">ChangeEquipOrModel</a>(event_id, <span class="keyword">true</span>);</div>
<div class="line"><a id="l01245" name="l01245"></a><span class="lineno"> 1245</span>    <span class="comment">// Add quests that are events only to non event npc</span></div>
<div class="line"><a id="l01246" name="l01246"></a><span class="lineno"> 1246</span>    <a class="code hl_function" href="../../d1/d78/a08256.html#a361d3a758f1146282aae85b4ed294c59">UpdateEventQuests</a>(event_id, <span class="keyword">true</span>);</div>
<div class="line"><a id="l01247" name="l01247"></a><span class="lineno"> 1247</span>    <a class="code hl_function" href="../../d1/d78/a08256.html#a4947451f4fb593dbc16ac29d77dd603c">UpdateWorldStates</a>(event_id, <span class="keyword">true</span>);</div>
<div class="line"><a id="l01248" name="l01248"></a><span class="lineno"> 1248</span>    <span class="comment">// update npcflags in this event</span></div>
<div class="line"><a id="l01249" name="l01249"></a><span class="lineno"> 1249</span>    <a class="code hl_function" href="../../d1/d78/a08256.html#a8fb888e0cb07a113ec9096ff88ed9f32">UpdateEventNPCFlags</a>(event_id);</div>
<div class="line"><a id="l01250" name="l01250"></a><span class="lineno"> 1250</span>    <span class="comment">// add vendor items</span></div>
<div class="line"><a id="l01251" name="l01251"></a><span class="lineno"> 1251</span>    <a class="code hl_function" href="../../d1/d78/a08256.html#a46a7a0698d46d61af6af5b836d6d404c">UpdateEventNPCVendor</a>(event_id, <span class="keyword">true</span>);</div>
<div class="line"><a id="l01252" name="l01252"></a><span class="lineno"> 1252</span>    <span class="comment">// update bg holiday</span></div>
<div class="line"><a id="l01253" name="l01253"></a><span class="lineno"> 1253</span>    <a class="code hl_function" href="../../d1/d78/a08256.html#a733cc959fd929bb86442c44fa2cb3ef9">UpdateBattlegroundSettings</a>();</div>
<div class="line"><a id="l01254" name="l01254"></a><span class="lineno"> 1254</span> </div>
<div class="line"><a id="l01256" name="l01256"></a><span class="lineno"> 1256</span>    <a class="code hl_function" href="../../d1/d78/a08256.html#a986be1d18003b8288ea3d7b422fc4d9a">RunSmartAIScripts</a>(event_id, <span class="keyword">true</span>);</div>
<div class="line"><a id="l01257" name="l01257"></a><span class="lineno"> 1257</span> </div>
<div class="line"><a id="l01258" name="l01258"></a><span class="lineno"> 1258</span>    <span class="comment">// If event&#39;s worldstate is 0, it means the event hasn&#39;t been started yet. In that case, reset seasonal quests.</span></div>
<div class="line"><a id="l01259" name="l01259"></a><span class="lineno"> 1259</span>    <span class="comment">// When event ends (if it expires or if it&#39;s stopped via commands) worldstate will be set to 0 again, ready for another seasonal quest reset.</span></div>
<div class="line"><a id="l01260" name="l01260"></a><span class="lineno"> 1260</span>    <span class="keywordflow">if</span> (<a class="code hl_define" href="../../d3/d74/a04418.html#ga05dfb35c344e5b947a19e4284e7f5fa7">sWorld</a>-&gt;getWorldState(event_id) == 0)</div>
<div class="line"><a id="l01261" name="l01261"></a><span class="lineno"> 1261</span>    {</div>
<div class="line"><a id="l01262" name="l01262"></a><span class="lineno"> 1262</span>        <a class="code hl_define" href="../../d3/d74/a04418.html#ga05dfb35c344e5b947a19e4284e7f5fa7">sWorld</a>-&gt;ResetEventSeasonalQuests(event_id);</div>
<div class="line"><a id="l01263" name="l01263"></a><span class="lineno"> 1263</span>    }</div>
<div class="line"><a id="l01264" name="l01264"></a><span class="lineno"> 1264</span>}</div>
<div class="line"><a id="l01265" name="l01265"></a><span class="lineno"> 1265</span> </div>
<div class="line"><a id="l01266" name="l01266"></a><span class="lineno"><a class="line" href="../../d1/d78/a08256.html#a8fb888e0cb07a113ec9096ff88ed9f32"> 1266</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d1/d78/a08256.html#a8fb888e0cb07a113ec9096ff88ed9f32">GameEventMgr::UpdateEventNPCFlags</a>(<a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a> event_id)</div>
<div class="line"><a id="l01267" name="l01267"></a><span class="lineno"> 1267</span>{</div>
<div class="line"><a id="l01268" name="l01268"></a><span class="lineno"> 1268</span>    std::unordered_map&lt;uint32, std::unordered_set&lt;ObjectGuid::LowType&gt;&gt; creaturesByMap;</div>
<div class="line"><a id="l01269" name="l01269"></a><span class="lineno"> 1269</span> </div>
<div class="line"><a id="l01270" name="l01270"></a><span class="lineno"> 1270</span>    <span class="comment">// go through the creatures whose npcflags are changed in the event</span></div>
<div class="line"><a id="l01271" name="l01271"></a><span class="lineno"> 1271</span>    <span class="keywordflow">for</span> (NPCFlagList::iterator itr = <a class="code hl_variable" href="../../d1/d78/a08256.html#a23a28a5ae28efdd54deceeca15969196">mGameEventNPCFlags</a>[event_id].begin(); itr != <a class="code hl_variable" href="../../d1/d78/a08256.html#a23a28a5ae28efdd54deceeca15969196">mGameEventNPCFlags</a>[event_id].end(); ++itr)</div>
<div class="line"><a id="l01272" name="l01272"></a><span class="lineno"> 1272</span>    {</div>
<div class="line"><a id="l01273" name="l01273"></a><span class="lineno"> 1273</span>        <span class="comment">// get the creature data from the low guid to get the entry, to be able to find out the whole guid</span></div>
<div class="line"><a id="l01274" name="l01274"></a><span class="lineno"> 1274</span>        <span class="keywordflow">if</span> (<a class="code hl_struct" href="../../d0/dd1/a07484.html">CreatureData</a> <span class="keyword">const</span>* data = <a class="code hl_define" href="../../d8/d4e/a01355.html#a736e30da2b5261060ac6cdbb5de3b787">sObjectMgr</a>-&gt;GetCreatureData(itr-&gt;first))</div>
<div class="line"><a id="l01275" name="l01275"></a><span class="lineno"> 1275</span>            creaturesByMap[data-&gt;mapid].insert(itr-&gt;first);</div>
<div class="line"><a id="l01276" name="l01276"></a><span class="lineno"> 1276</span>    }</div>
<div class="line"><a id="l01277" name="l01277"></a><span class="lineno"> 1277</span> </div>
<div class="line"><a id="l01278" name="l01278"></a><span class="lineno"> 1278</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; p : creaturesByMap)</div>
<div class="line"><a id="l01279" name="l01279"></a><span class="lineno"> 1279</span>    {</div>
<div class="line"><a id="l01280" name="l01280"></a><span class="lineno"> 1280</span>        <a class="code hl_define" href="../../d7/d29/a01589.html#a9132749f8376c48b0ca7212eb3293905">sMapMgr</a>-&gt;DoForAllMapsWithMapId(p.first, [<span class="keyword">this</span>, &amp;p](<a class="code hl_class" href="../../db/d9f/a09188.html">Map</a>* map)</div>
<div class="line"><a id="l01281" name="l01281"></a><span class="lineno"> 1281</span>        {</div>
<div class="line"><a id="l01282" name="l01282"></a><span class="lineno"> 1282</span>            for (auto&amp; spawnId : p.second)</div>
<div class="line"><a id="l01283" name="l01283"></a><span class="lineno"> 1283</span>            {</div>
<div class="line"><a id="l01284" name="l01284"></a><span class="lineno"> 1284</span>                auto creatureBounds = map-&gt;GetCreatureBySpawnIdStore().equal_range(spawnId);</div>
<div class="line"><a id="l01285" name="l01285"></a><span class="lineno"> 1285</span>                for (auto itr = creatureBounds.first; itr != creatureBounds.second; ++itr)</div>
<div class="line"><a id="l01286" name="l01286"></a><span class="lineno"> 1286</span>                {</div>
<div class="line"><a id="l01287" name="l01287"></a><span class="lineno"> 1287</span>                    Creature* creature = itr-&gt;second;</div>
<div class="line"><a id="l01288" name="l01288"></a><span class="lineno"> 1288</span>                    uint32 npcflag = GetNPCFlag(creature);</div>
<div class="line"><a id="l01289" name="l01289"></a><span class="lineno"> 1289</span>                    if (CreatureTemplate const* creatureTemplate = creature-&gt;GetCreatureTemplate())</div>
<div class="line"><a id="l01290" name="l01290"></a><span class="lineno"> 1290</span>                        npcflag |= creatureTemplate-&gt;npcflag;</div>
<div class="line"><a id="l01291" name="l01291"></a><span class="lineno"> 1291</span> </div>
<div class="line"><a id="l01292" name="l01292"></a><span class="lineno"> 1292</span>                    creature-&gt;ReplaceAllNpcFlags(NPCFlags(npcflag));</div>
<div class="line"><a id="l01293" name="l01293"></a><span class="lineno"> 1293</span>                    <span class="comment">// reset gossip options, since the flag change might have added / removed some</span></div>
<div class="line"><a id="l01294" name="l01294"></a><span class="lineno"> 1294</span>                    <span class="comment">//cr-&gt;ResetGossipOptions();</span></div>
<div class="line"><a id="l01295" name="l01295"></a><span class="lineno"> 1295</span>                }</div>
<div class="line"><a id="l01296" name="l01296"></a><span class="lineno"> 1296</span>            }</div>
<div class="line"><a id="l01297" name="l01297"></a><span class="lineno"> 1297</span>        });</div>
<div class="line"><a id="l01298" name="l01298"></a><span class="lineno"> 1298</span>    }</div>
<div class="line"><a id="l01299" name="l01299"></a><span class="lineno"> 1299</span>}</div>
<div class="line"><a id="l01300" name="l01300"></a><span class="lineno"> 1300</span> </div>
<div class="line"><a id="l01301" name="l01301"></a><span class="lineno"><a class="line" href="../../d1/d78/a08256.html#a733cc959fd929bb86442c44fa2cb3ef9"> 1301</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d1/d78/a08256.html#a733cc959fd929bb86442c44fa2cb3ef9">GameEventMgr::UpdateBattlegroundSettings</a>()</div>
<div class="line"><a id="l01302" name="l01302"></a><span class="lineno"> 1302</span>{</div>
<div class="line"><a id="l01303" name="l01303"></a><span class="lineno"> 1303</span>    <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> mask = 0;</div>
<div class="line"><a id="l01304" name="l01304"></a><span class="lineno"> 1304</span>    <span class="keywordflow">for</span> (ActiveEvents::const_iterator itr = <a class="code hl_variable" href="../../d1/d78/a08256.html#a177cd794e719b24cf1bc70fc7316a8e5">m_ActiveEvents</a>.begin(); itr != <a class="code hl_variable" href="../../d1/d78/a08256.html#a177cd794e719b24cf1bc70fc7316a8e5">m_ActiveEvents</a>.end(); ++itr)</div>
<div class="line"><a id="l01305" name="l01305"></a><span class="lineno"> 1305</span>        mask |= <a class="code hl_variable" href="../../d1/d78/a08256.html#a75d9f60bb8efddc6290683f0bc22bc0f">mGameEventBattlegroundHolidays</a>[*itr];</div>
<div class="line"><a id="l01306" name="l01306"></a><span class="lineno"> 1306</span>    <a class="code hl_define" href="../../d7/d92/a00887.html#abe50926a988d0fff4ee6ba0358c6b278">sBattlegroundMgr</a>-&gt;SetHolidayWeekends(mask);</div>
<div class="line"><a id="l01307" name="l01307"></a><span class="lineno"> 1307</span>}</div>
<div class="line"><a id="l01308" name="l01308"></a><span class="lineno"> 1308</span> </div>
<div class="line"><a id="l01309" name="l01309"></a><span class="lineno"><a class="line" href="../../d1/d78/a08256.html#a46a7a0698d46d61af6af5b836d6d404c"> 1309</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d1/d78/a08256.html#a46a7a0698d46d61af6af5b836d6d404c">GameEventMgr::UpdateEventNPCVendor</a>(<a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a> event_id, <span class="keywordtype">bool</span> activate)</div>
<div class="line"><a id="l01310" name="l01310"></a><span class="lineno"> 1310</span>{</div>
<div class="line"><a id="l01311" name="l01311"></a><span class="lineno"> 1311</span>    <span class="keywordflow">for</span> (NPCVendorList::iterator itr = <a class="code hl_variable" href="../../d1/d78/a08256.html#a7a78bd9b0c6f4cc32e386794955ac3b5">mGameEventVendors</a>[event_id].begin(); itr != <a class="code hl_variable" href="../../d1/d78/a08256.html#a7a78bd9b0c6f4cc32e386794955ac3b5">mGameEventVendors</a>[event_id].end(); ++itr)</div>
<div class="line"><a id="l01312" name="l01312"></a><span class="lineno"> 1312</span>    {</div>
<div class="line"><a id="l01313" name="l01313"></a><span class="lineno"> 1313</span>        <span class="keywordflow">if</span> (activate)</div>
<div class="line"><a id="l01314" name="l01314"></a><span class="lineno"> 1314</span>            <a class="code hl_define" href="../../d8/d4e/a01355.html#a736e30da2b5261060ac6cdbb5de3b787">sObjectMgr</a>-&gt;AddVendorItem(itr-&gt;entry, itr-&gt;item, itr-&gt;maxcount, itr-&gt;incrtime, itr-&gt;ExtendedCost, <span class="keyword">false</span>);</div>
<div class="line"><a id="l01315" name="l01315"></a><span class="lineno"> 1315</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l01316" name="l01316"></a><span class="lineno"> 1316</span>            <a class="code hl_define" href="../../d8/d4e/a01355.html#a736e30da2b5261060ac6cdbb5de3b787">sObjectMgr</a>-&gt;RemoveVendorItem(itr-&gt;entry, itr-&gt;item, <span class="keyword">false</span>);</div>
<div class="line"><a id="l01317" name="l01317"></a><span class="lineno"> 1317</span>    }</div>
<div class="line"><a id="l01318" name="l01318"></a><span class="lineno"> 1318</span>}</div>
<div class="line"><a id="l01319" name="l01319"></a><span class="lineno"> 1319</span> </div>
<div class="line"><a id="l01320" name="l01320"></a><span class="lineno"><a class="line" href="../../d1/d78/a08256.html#a2d4bee5a141e7042d7114ff064fe9ade"> 1320</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d1/d78/a08256.html#a2d4bee5a141e7042d7114ff064fe9ade">GameEventMgr::GameEventSpawn</a>(<a class="code hl_typedef" href="../../d1/da8/a00230.html#aecf4e3680a32207d17f62a3426731878">int16</a> event_id)</div>
<div class="line"><a id="l01321" name="l01321"></a><span class="lineno"> 1321</span>{</div>
<div class="line"><a id="l01322" name="l01322"></a><span class="lineno"> 1322</span>    <a class="code hl_typedef" href="../../d1/da8/a00230.html#a0bf9964a3ce962c07ad3d8b5432bbbcd">int32</a> internal_event_id = <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>.size() + event_id - 1;</div>
<div class="line"><a id="l01323" name="l01323"></a><span class="lineno"> 1323</span> </div>
<div class="line"><a id="l01324" name="l01324"></a><span class="lineno"> 1324</span>    <span class="keywordflow">if</span> (internal_event_id &lt; 0 || internal_event_id &gt;= <a class="code hl_typedef" href="../../d1/da8/a00230.html#a0bf9964a3ce962c07ad3d8b5432bbbcd">int32</a>(<a class="code hl_variable" href="../../d1/d78/a08256.html#a340bf17cd48de8175a242d54e0bc88b9">mGameEventCreatureGuids</a>.size()))</div>
<div class="line"><a id="l01325" name="l01325"></a><span class="lineno"> 1325</span>    {</div>
<div class="line"><a id="l01326" name="l01326"></a><span class="lineno"> 1326</span>        <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;gameevent&quot;</span>, <span class="stringliteral">&quot;GameEventMgr::GameEventSpawn attempt access to out of range mGameEventCreatureGuids element {} (size: {})&quot;</span>,</div>
<div class="line"><a id="l01327" name="l01327"></a><span class="lineno"> 1327</span>                       internal_event_id, <a class="code hl_variable" href="../../d1/d78/a08256.html#a340bf17cd48de8175a242d54e0bc88b9">mGameEventCreatureGuids</a>.size());</div>
<div class="line"><a id="l01328" name="l01328"></a><span class="lineno"> 1328</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01329" name="l01329"></a><span class="lineno"> 1329</span>    }</div>
<div class="line"><a id="l01330" name="l01330"></a><span class="lineno"> 1330</span> </div>
<div class="line"><a id="l01331" name="l01331"></a><span class="lineno"> 1331</span>    <span class="keywordflow">for</span> (GuidLowList::iterator itr = <a class="code hl_variable" href="../../d1/d78/a08256.html#a340bf17cd48de8175a242d54e0bc88b9">mGameEventCreatureGuids</a>[internal_event_id].begin(); itr != <a class="code hl_variable" href="../../d1/d78/a08256.html#a340bf17cd48de8175a242d54e0bc88b9">mGameEventCreatureGuids</a>[internal_event_id].end(); ++itr)</div>
<div class="line"><a id="l01332" name="l01332"></a><span class="lineno"> 1332</span>    {</div>
<div class="line"><a id="l01333" name="l01333"></a><span class="lineno"> 1333</span>        <span class="comment">// Add to correct cell</span></div>
<div class="line"><a id="l01334" name="l01334"></a><span class="lineno"> 1334</span>        <span class="keywordflow">if</span> (<a class="code hl_struct" href="../../d0/dd1/a07484.html">CreatureData</a> <span class="keyword">const</span>* data = <a class="code hl_define" href="../../d8/d4e/a01355.html#a736e30da2b5261060ac6cdbb5de3b787">sObjectMgr</a>-&gt;GetCreatureData(*itr))</div>
<div class="line"><a id="l01335" name="l01335"></a><span class="lineno"> 1335</span>        {</div>
<div class="line"><a id="l01336" name="l01336"></a><span class="lineno"> 1336</span>            <a class="code hl_define" href="../../d8/d4e/a01355.html#a736e30da2b5261060ac6cdbb5de3b787">sObjectMgr</a>-&gt;AddCreatureToGrid(*itr, data);</div>
<div class="line"><a id="l01337" name="l01337"></a><span class="lineno"> 1337</span> </div>
<div class="line"><a id="l01338" name="l01338"></a><span class="lineno"> 1338</span>            <span class="comment">// Spawn if necessary (loaded grids only)</span></div>
<div class="line"><a id="l01339" name="l01339"></a><span class="lineno"> 1339</span>            <a class="code hl_class" href="../../db/d9f/a09188.html">Map</a>* map = <a class="code hl_define" href="../../d7/d29/a01589.html#a9132749f8376c48b0ca7212eb3293905">sMapMgr</a>-&gt;CreateBaseMap(data-&gt;mapid);</div>
<div class="line"><a id="l01340" name="l01340"></a><span class="lineno"> 1340</span>            <span class="comment">// We use spawn coords to spawn</span></div>
<div class="line"><a id="l01341" name="l01341"></a><span class="lineno"> 1341</span>            <span class="keywordflow">if</span> (!map-&gt;<a class="code hl_function" href="../../db/d9f/a09188.html#aae3a929aefb05046ef304ffba10aae71">Instanceable</a>() &amp;&amp; map-&gt;<a class="code hl_function" href="../../db/d9f/a09188.html#abdb1b9067ac6ad5b27ec537c654a2e1a">IsGridLoaded</a>(data-&gt;posX, data-&gt;posY))</div>
<div class="line"><a id="l01342" name="l01342"></a><span class="lineno"> 1342</span>            {</div>
<div class="line"><a id="l01343" name="l01343"></a><span class="lineno"> 1343</span>                <a class="code hl_class" href="../../dc/d6f/a07436.html">Creature</a>* creature = <span class="keyword">new</span> <a class="code hl_class" href="../../dc/d6f/a07436.html">Creature</a>;</div>
<div class="line"><a id="l01344" name="l01344"></a><span class="lineno"> 1344</span>                <span class="keywordflow">if</span> (!creature-&gt;<a class="code hl_function" href="../../dc/d6f/a07436.html#afdb3640b2f108f85cf1746195c75a5bd">LoadCreatureFromDB</a>(*itr, map))</div>
<div class="line"><a id="l01345" name="l01345"></a><span class="lineno"> 1345</span>                    <span class="keyword">delete</span> creature;</div>
<div class="line"><a id="l01346" name="l01346"></a><span class="lineno"> 1346</span>            }</div>
<div class="line"><a id="l01347" name="l01347"></a><span class="lineno"> 1347</span>        }</div>
<div class="line"><a id="l01348" name="l01348"></a><span class="lineno"> 1348</span>    }</div>
<div class="line"><a id="l01349" name="l01349"></a><span class="lineno"> 1349</span> </div>
<div class="line"><a id="l01350" name="l01350"></a><span class="lineno"> 1350</span>    <span class="keywordflow">if</span> (internal_event_id &gt;= <a class="code hl_typedef" href="../../d1/da8/a00230.html#a0bf9964a3ce962c07ad3d8b5432bbbcd">int32</a>(<a class="code hl_variable" href="../../d1/d78/a08256.html#a7e8911e4170a84527a7eb3d73a8a30f1">mGameEventGameobjectGuids</a>.size()))</div>
<div class="line"><a id="l01351" name="l01351"></a><span class="lineno"> 1351</span>    {</div>
<div class="line"><a id="l01352" name="l01352"></a><span class="lineno"> 1352</span>        <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;gameevent&quot;</span>, <span class="stringliteral">&quot;GameEventMgr::GameEventSpawn attempt access to out of range mGameEventGameobjectGuids element {} (size: {})&quot;</span>,</div>
<div class="line"><a id="l01353" name="l01353"></a><span class="lineno"> 1353</span>                       internal_event_id, <a class="code hl_variable" href="../../d1/d78/a08256.html#a7e8911e4170a84527a7eb3d73a8a30f1">mGameEventGameobjectGuids</a>.size());</div>
<div class="line"><a id="l01354" name="l01354"></a><span class="lineno"> 1354</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01355" name="l01355"></a><span class="lineno"> 1355</span>    }</div>
<div class="line"><a id="l01356" name="l01356"></a><span class="lineno"> 1356</span> </div>
<div class="line"><a id="l01357" name="l01357"></a><span class="lineno"> 1357</span>    <span class="keywordflow">for</span> (GuidLowList::iterator itr = <a class="code hl_variable" href="../../d1/d78/a08256.html#a7e8911e4170a84527a7eb3d73a8a30f1">mGameEventGameobjectGuids</a>[internal_event_id].begin(); itr != <a class="code hl_variable" href="../../d1/d78/a08256.html#a7e8911e4170a84527a7eb3d73a8a30f1">mGameEventGameobjectGuids</a>[internal_event_id].end(); ++itr)</div>
<div class="line"><a id="l01358" name="l01358"></a><span class="lineno"> 1358</span>    {</div>
<div class="line"><a id="l01359" name="l01359"></a><span class="lineno"> 1359</span>        <span class="comment">// Add to correct cell</span></div>
<div class="line"><a id="l01360" name="l01360"></a><span class="lineno"> 1360</span>        <span class="keywordflow">if</span> (<a class="code hl_struct" href="../../d7/d9e/a07744.html">GameObjectData</a> <span class="keyword">const</span>* data = <a class="code hl_define" href="../../d8/d4e/a01355.html#a736e30da2b5261060ac6cdbb5de3b787">sObjectMgr</a>-&gt;GetGOData(*itr))</div>
<div class="line"><a id="l01361" name="l01361"></a><span class="lineno"> 1361</span>        {</div>
<div class="line"><a id="l01362" name="l01362"></a><span class="lineno"> 1362</span>            <a class="code hl_define" href="../../d8/d4e/a01355.html#a736e30da2b5261060ac6cdbb5de3b787">sObjectMgr</a>-&gt;AddGameobjectToGrid(*itr, data);</div>
<div class="line"><a id="l01363" name="l01363"></a><span class="lineno"> 1363</span>            <span class="comment">// Spawn if necessary (loaded grids only)</span></div>
<div class="line"><a id="l01364" name="l01364"></a><span class="lineno"> 1364</span>            <span class="comment">// this base map checked as non-instanced and then only existed</span></div>
<div class="line"><a id="l01365" name="l01365"></a><span class="lineno"> 1365</span>            <a class="code hl_class" href="../../db/d9f/a09188.html">Map</a>* map = <a class="code hl_define" href="../../d7/d29/a01589.html#a9132749f8376c48b0ca7212eb3293905">sMapMgr</a>-&gt;CreateBaseMap(data-&gt;mapid);</div>
<div class="line"><a id="l01366" name="l01366"></a><span class="lineno"> 1366</span>            <span class="comment">// We use current coords to unspawn, not spawn coords since creature can have changed grid</span></div>
<div class="line"><a id="l01367" name="l01367"></a><span class="lineno"> 1367</span>            <span class="keywordflow">if</span> (!map-&gt;<a class="code hl_function" href="../../db/d9f/a09188.html#aae3a929aefb05046ef304ffba10aae71">Instanceable</a>() &amp;&amp; map-&gt;<a class="code hl_function" href="../../db/d9f/a09188.html#abdb1b9067ac6ad5b27ec537c654a2e1a">IsGridLoaded</a>(data-&gt;posX, data-&gt;posY))</div>
<div class="line"><a id="l01368" name="l01368"></a><span class="lineno"> 1368</span>            {</div>
<div class="line"><a id="l01369" name="l01369"></a><span class="lineno"> 1369</span>                <a class="code hl_class" href="../../d7/dc7/a07748.html">GameObject</a>* pGameobject = <a class="code hl_define" href="../../d8/d4e/a01355.html#a736e30da2b5261060ac6cdbb5de3b787">sObjectMgr</a>-&gt;IsGameObjectStaticTransport(data-&gt;id) ? <span class="keyword">new</span> <a class="code hl_class" href="../../d5/d49/a08092.html">StaticTransport</a>() : <span class="keyword">new</span> <a class="code hl_class" href="../../d7/dc7/a07748.html">GameObject</a>();</div>
<div class="line"><a id="l01370" name="l01370"></a><span class="lineno"> 1370</span>                <span class="comment">//TODO: find out when it is add to map</span></div>
<div class="line"><a id="l01371" name="l01371"></a><span class="lineno"> 1371</span>                <span class="keywordflow">if</span> (!pGameobject-&gt;<a class="code hl_function" href="../../d7/dc7/a07748.html#acfb1d37bab02bb7a8e87a94fa9eeab8d">LoadGameObjectFromDB</a>(*itr, map, <span class="keyword">false</span>))</div>
<div class="line"><a id="l01372" name="l01372"></a><span class="lineno"> 1372</span>                    <span class="keyword">delete</span> pGameobject;</div>
<div class="line"><a id="l01373" name="l01373"></a><span class="lineno"> 1373</span>                <span class="keywordflow">else</span></div>
<div class="line"><a id="l01374" name="l01374"></a><span class="lineno"> 1374</span>                {</div>
<div class="line"><a id="l01375" name="l01375"></a><span class="lineno"> 1375</span>                    <span class="keywordflow">if</span> (pGameobject-&gt;<a class="code hl_function" href="../../d7/dc7/a07748.html#a480c82a758a0654c31d5cda1ab8495e8">isSpawnedByDefault</a>())</div>
<div class="line"><a id="l01376" name="l01376"></a><span class="lineno"> 1376</span>                        map-&gt;<a class="code hl_function" href="../../db/d9f/a09188.html#aec8fdf932b6233dd3ee23b469d2b10a5">AddToMap</a>(pGameobject);</div>
<div class="line"><a id="l01377" name="l01377"></a><span class="lineno"> 1377</span>                }</div>
<div class="line"><a id="l01378" name="l01378"></a><span class="lineno"> 1378</span>            }</div>
<div class="line"><a id="l01379" name="l01379"></a><span class="lineno"> 1379</span>        }</div>
<div class="line"><a id="l01380" name="l01380"></a><span class="lineno"> 1380</span>    }</div>
<div class="line"><a id="l01381" name="l01381"></a><span class="lineno"> 1381</span> </div>
<div class="line"><a id="l01382" name="l01382"></a><span class="lineno"> 1382</span>    <span class="keywordflow">if</span> (internal_event_id &gt;= <a class="code hl_typedef" href="../../d1/da8/a00230.html#a0bf9964a3ce962c07ad3d8b5432bbbcd">int32</a>(<a class="code hl_variable" href="../../d1/d78/a08256.html#a26e2b8498a7fe67293acbf09ae1e9e8f">mGameEventPoolIds</a>.size()))</div>
<div class="line"><a id="l01383" name="l01383"></a><span class="lineno"> 1383</span>    {</div>
<div class="line"><a id="l01384" name="l01384"></a><span class="lineno"> 1384</span>        <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;gameevent&quot;</span>, <span class="stringliteral">&quot;GameEventMgr::GameEventSpawn attempt access to out of range mGameEventPoolIds element {} (size: {})&quot;</span>,</div>
<div class="line"><a id="l01385" name="l01385"></a><span class="lineno"> 1385</span>                       internal_event_id, <a class="code hl_variable" href="../../d1/d78/a08256.html#a26e2b8498a7fe67293acbf09ae1e9e8f">mGameEventPoolIds</a>.size());</div>
<div class="line"><a id="l01386" name="l01386"></a><span class="lineno"> 1386</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01387" name="l01387"></a><span class="lineno"> 1387</span>    }</div>
<div class="line"><a id="l01388" name="l01388"></a><span class="lineno"> 1388</span> </div>
<div class="line"><a id="l01389" name="l01389"></a><span class="lineno"> 1389</span>    <span class="keywordflow">for</span> (IdList::iterator itr = <a class="code hl_variable" href="../../d1/d78/a08256.html#a26e2b8498a7fe67293acbf09ae1e9e8f">mGameEventPoolIds</a>[internal_event_id].begin(); itr != <a class="code hl_variable" href="../../d1/d78/a08256.html#a26e2b8498a7fe67293acbf09ae1e9e8f">mGameEventPoolIds</a>[internal_event_id].end(); ++itr)</div>
<div class="line"><a id="l01390" name="l01390"></a><span class="lineno"> 1390</span>        <a class="code hl_define" href="../../d7/d62/a01805.html#a9189dd9c6265b9e6d57104dd61a5fe85">sPoolMgr</a>-&gt;SpawnPool(*itr);</div>
<div class="line"><a id="l01391" name="l01391"></a><span class="lineno"> 1391</span>}</div>
<div class="line"><a id="l01392" name="l01392"></a><span class="lineno"> 1392</span> </div>
<div class="line"><a id="l01393" name="l01393"></a><span class="lineno"><a class="line" href="../../d1/d78/a08256.html#a2e48d935ab7e575ab566c28108f98579"> 1393</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d1/d78/a08256.html#a2e48d935ab7e575ab566c28108f98579">GameEventMgr::GameEventUnspawn</a>(<a class="code hl_typedef" href="../../d1/da8/a00230.html#aecf4e3680a32207d17f62a3426731878">int16</a> event_id)</div>
<div class="line"><a id="l01394" name="l01394"></a><span class="lineno"> 1394</span>{</div>
<div class="line"><a id="l01395" name="l01395"></a><span class="lineno"> 1395</span>    <a class="code hl_typedef" href="../../d1/da8/a00230.html#a0bf9964a3ce962c07ad3d8b5432bbbcd">int32</a> internal_event_id = <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>.size() + event_id - 1;</div>
<div class="line"><a id="l01396" name="l01396"></a><span class="lineno"> 1396</span> </div>
<div class="line"><a id="l01397" name="l01397"></a><span class="lineno"> 1397</span>    <span class="keywordflow">if</span> (internal_event_id &lt; 0 || internal_event_id &gt;= <a class="code hl_typedef" href="../../d1/da8/a00230.html#a0bf9964a3ce962c07ad3d8b5432bbbcd">int32</a>(<a class="code hl_variable" href="../../d1/d78/a08256.html#a340bf17cd48de8175a242d54e0bc88b9">mGameEventCreatureGuids</a>.size()))</div>
<div class="line"><a id="l01398" name="l01398"></a><span class="lineno"> 1398</span>    {</div>
<div class="line"><a id="l01399" name="l01399"></a><span class="lineno"> 1399</span>        <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;gameevent&quot;</span>, <span class="stringliteral">&quot;GameEventMgr::GameEventUnspawn attempt access to out of range mGameEventCreatureGuids element {} (size: {})&quot;</span>,</div>
<div class="line"><a id="l01400" name="l01400"></a><span class="lineno"> 1400</span>                       internal_event_id, <a class="code hl_variable" href="../../d1/d78/a08256.html#a340bf17cd48de8175a242d54e0bc88b9">mGameEventCreatureGuids</a>.size());</div>
<div class="line"><a id="l01401" name="l01401"></a><span class="lineno"> 1401</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01402" name="l01402"></a><span class="lineno"> 1402</span>    }</div>
<div class="line"><a id="l01403" name="l01403"></a><span class="lineno"> 1403</span> </div>
<div class="line"><a id="l01404" name="l01404"></a><span class="lineno"> 1404</span>    <span class="keywordflow">for</span> (GuidLowList::iterator itr = <a class="code hl_variable" href="../../d1/d78/a08256.html#a340bf17cd48de8175a242d54e0bc88b9">mGameEventCreatureGuids</a>[internal_event_id].begin(); itr != <a class="code hl_variable" href="../../d1/d78/a08256.html#a340bf17cd48de8175a242d54e0bc88b9">mGameEventCreatureGuids</a>[internal_event_id].end(); ++itr)</div>
<div class="line"><a id="l01405" name="l01405"></a><span class="lineno"> 1405</span>    {</div>
<div class="line"><a id="l01406" name="l01406"></a><span class="lineno"> 1406</span>        <span class="comment">// check if it&#39;s needed by another event, if so, don&#39;t remove</span></div>
<div class="line"><a id="l01407" name="l01407"></a><span class="lineno"> 1407</span>        <span class="keywordflow">if</span> (event_id &gt; 0 &amp;&amp; <a class="code hl_function" href="../../d1/d78/a08256.html#a4a5a551385d8845370ebb857f6bf2b27">hasCreatureActiveEventExcept</a>(*itr, event_id))</div>
<div class="line"><a id="l01408" name="l01408"></a><span class="lineno"> 1408</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01409" name="l01409"></a><span class="lineno"> 1409</span> </div>
<div class="line"><a id="l01410" name="l01410"></a><span class="lineno"> 1410</span>        <span class="comment">// Remove the creature from grid</span></div>
<div class="line"><a id="l01411" name="l01411"></a><span class="lineno"> 1411</span>        <span class="keywordflow">if</span> (<a class="code hl_struct" href="../../d0/dd1/a07484.html">CreatureData</a> <span class="keyword">const</span>* data = <a class="code hl_define" href="../../d8/d4e/a01355.html#a736e30da2b5261060ac6cdbb5de3b787">sObjectMgr</a>-&gt;GetCreatureData(*itr))</div>
<div class="line"><a id="l01412" name="l01412"></a><span class="lineno"> 1412</span>        {</div>
<div class="line"><a id="l01413" name="l01413"></a><span class="lineno"> 1413</span>            <a class="code hl_define" href="../../d8/d4e/a01355.html#a736e30da2b5261060ac6cdbb5de3b787">sObjectMgr</a>-&gt;RemoveCreatureFromGrid(*itr, data);</div>
<div class="line"><a id="l01414" name="l01414"></a><span class="lineno"> 1414</span> </div>
<div class="line"><a id="l01415" name="l01415"></a><span class="lineno"> 1415</span>            <a class="code hl_define" href="../../d7/d29/a01589.html#a9132749f8376c48b0ca7212eb3293905">sMapMgr</a>-&gt;DoForAllMapsWithMapId(data-&gt;mapid, [&amp;itr](<a class="code hl_class" href="../../db/d9f/a09188.html">Map</a>* map)</div>
<div class="line"><a id="l01416" name="l01416"></a><span class="lineno"> 1416</span>            {</div>
<div class="line"><a id="l01417" name="l01417"></a><span class="lineno"> 1417</span>                auto creatureBounds = map-&gt;GetCreatureBySpawnIdStore().equal_range(*itr);</div>
<div class="line"><a id="l01418" name="l01418"></a><span class="lineno"> 1418</span>                for (auto itr2 = creatureBounds.first; itr2 != creatureBounds.second;)</div>
<div class="line"><a id="l01419" name="l01419"></a><span class="lineno"> 1419</span>                {</div>
<div class="line"><a id="l01420" name="l01420"></a><span class="lineno"> 1420</span>                    Creature* creature = itr2-&gt;second;</div>
<div class="line"><a id="l01421" name="l01421"></a><span class="lineno"> 1421</span>                    ++itr2;</div>
<div class="line"><a id="l01422" name="l01422"></a><span class="lineno"> 1422</span>                    creature-&gt;AddObjectToRemoveList();</div>
<div class="line"><a id="l01423" name="l01423"></a><span class="lineno"> 1423</span>                }</div>
<div class="line"><a id="l01424" name="l01424"></a><span class="lineno"> 1424</span>            });</div>
<div class="line"><a id="l01425" name="l01425"></a><span class="lineno"> 1425</span>        }</div>
<div class="line"><a id="l01426" name="l01426"></a><span class="lineno"> 1426</span>    }</div>
<div class="line"><a id="l01427" name="l01427"></a><span class="lineno"> 1427</span> </div>
<div class="line"><a id="l01428" name="l01428"></a><span class="lineno"> 1428</span>    <span class="keywordflow">if</span> (internal_event_id &gt;= <a class="code hl_typedef" href="../../d1/da8/a00230.html#a0bf9964a3ce962c07ad3d8b5432bbbcd">int32</a>(mGameEventGameobjectGuids.size()))</div>
<div class="line"><a id="l01429" name="l01429"></a><span class="lineno"> 1429</span>    {</div>
<div class="line"><a id="l01430" name="l01430"></a><span class="lineno"> 1430</span>        <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;gameevent&quot;</span>, <span class="stringliteral">&quot;GameEventMgr::GameEventUnspawn attempt access to out of range mGameEventGameobjectGuids element {} (size: {})&quot;</span>,</div>
<div class="line"><a id="l01431" name="l01431"></a><span class="lineno"> 1431</span>                       internal_event_id, mGameEventGameobjectGuids.size());</div>
<div class="line"><a id="l01432" name="l01432"></a><span class="lineno"> 1432</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01433" name="l01433"></a><span class="lineno"> 1433</span>    }</div>
<div class="line"><a id="l01434" name="l01434"></a><span class="lineno"> 1434</span> </div>
<div class="line"><a id="l01435" name="l01435"></a><span class="lineno"> 1435</span>    <span class="keywordflow">for</span> (GuidLowList::iterator itr = mGameEventGameobjectGuids[internal_event_id].begin(); itr != mGameEventGameobjectGuids[internal_event_id].end(); ++itr)</div>
<div class="line"><a id="l01436" name="l01436"></a><span class="lineno"> 1436</span>    {</div>
<div class="line"><a id="l01437" name="l01437"></a><span class="lineno"> 1437</span>        <span class="comment">// check if it&#39;s needed by another event, if so, don&#39;t remove</span></div>
<div class="line"><a id="l01438" name="l01438"></a><span class="lineno"> 1438</span>        <span class="keywordflow">if</span> (event_id &gt; 0 &amp;&amp; hasGameObjectActiveEventExcept(*itr, event_id))</div>
<div class="line"><a id="l01439" name="l01439"></a><span class="lineno"> 1439</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01440" name="l01440"></a><span class="lineno"> 1440</span>        <span class="comment">// Remove the gameobject from grid</span></div>
<div class="line"><a id="l01441" name="l01441"></a><span class="lineno"> 1441</span>        <span class="keywordflow">if</span> (<a class="code hl_struct" href="../../d7/d9e/a07744.html">GameObjectData</a> <span class="keyword">const</span>* data = <a class="code hl_define" href="../../d8/d4e/a01355.html#a736e30da2b5261060ac6cdbb5de3b787">sObjectMgr</a>-&gt;GetGOData(*itr))</div>
<div class="line"><a id="l01442" name="l01442"></a><span class="lineno"> 1442</span>        {</div>
<div class="line"><a id="l01443" name="l01443"></a><span class="lineno"> 1443</span>            <a class="code hl_define" href="../../d8/d4e/a01355.html#a736e30da2b5261060ac6cdbb5de3b787">sObjectMgr</a>-&gt;RemoveGameobjectFromGrid(*itr, data);</div>
<div class="line"><a id="l01444" name="l01444"></a><span class="lineno"> 1444</span> </div>
<div class="line"><a id="l01445" name="l01445"></a><span class="lineno"> 1445</span>            <a class="code hl_define" href="../../d7/d29/a01589.html#a9132749f8376c48b0ca7212eb3293905">sMapMgr</a>-&gt;DoForAllMapsWithMapId(data-&gt;mapid, [&amp;itr](<a class="code hl_class" href="../../db/d9f/a09188.html">Map</a>* map)</div>
<div class="line"><a id="l01446" name="l01446"></a><span class="lineno"> 1446</span>            {</div>
<div class="line"><a id="l01447" name="l01447"></a><span class="lineno"> 1447</span>                auto gameobjectBounds = map-&gt;GetGameObjectBySpawnIdStore().equal_range(*itr);</div>
<div class="line"><a id="l01448" name="l01448"></a><span class="lineno"> 1448</span>                for (auto itr2 = gameobjectBounds.first; itr2 != gameobjectBounds.second;)</div>
<div class="line"><a id="l01449" name="l01449"></a><span class="lineno"> 1449</span>                {</div>
<div class="line"><a id="l01450" name="l01450"></a><span class="lineno"> 1450</span>                    GameObject* go = itr2-&gt;second;</div>
<div class="line"><a id="l01451" name="l01451"></a><span class="lineno"> 1451</span>                    ++itr2;</div>
<div class="line"><a id="l01452" name="l01452"></a><span class="lineno"> 1452</span>                    go-&gt;AddObjectToRemoveList();</div>
<div class="line"><a id="l01453" name="l01453"></a><span class="lineno"> 1453</span>                }</div>
<div class="line"><a id="l01454" name="l01454"></a><span class="lineno"> 1454</span>            });</div>
<div class="line"><a id="l01455" name="l01455"></a><span class="lineno"> 1455</span>        }</div>
<div class="line"><a id="l01456" name="l01456"></a><span class="lineno"> 1456</span>    }</div>
<div class="line"><a id="l01457" name="l01457"></a><span class="lineno"> 1457</span>    <span class="keywordflow">if</span> (internal_event_id &gt;= <a class="code hl_typedef" href="../../d1/da8/a00230.html#a0bf9964a3ce962c07ad3d8b5432bbbcd">int32</a>(mGameEventPoolIds.size()))</div>
<div class="line"><a id="l01458" name="l01458"></a><span class="lineno"> 1458</span>    {</div>
<div class="line"><a id="l01459" name="l01459"></a><span class="lineno"> 1459</span>        <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;gameevent&quot;</span>, <span class="stringliteral">&quot;GameEventMgr::GameEventUnspawn attempt access to out of range mGameEventPoolIds element {} (size: {})&quot;</span>, internal_event_id, mGameEventPoolIds.size());</div>
<div class="line"><a id="l01460" name="l01460"></a><span class="lineno"> 1460</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01461" name="l01461"></a><span class="lineno"> 1461</span>    }</div>
<div class="line"><a id="l01462" name="l01462"></a><span class="lineno"> 1462</span> </div>
<div class="line"><a id="l01463" name="l01463"></a><span class="lineno"> 1463</span>    <span class="keywordflow">for</span> (IdList::iterator itr = mGameEventPoolIds[internal_event_id].begin(); itr != mGameEventPoolIds[internal_event_id].end(); ++itr)</div>
<div class="line"><a id="l01464" name="l01464"></a><span class="lineno"> 1464</span>    {</div>
<div class="line"><a id="l01465" name="l01465"></a><span class="lineno"> 1465</span>        <a class="code hl_define" href="../../d7/d62/a01805.html#a9189dd9c6265b9e6d57104dd61a5fe85">sPoolMgr</a>-&gt;DespawnPool(*itr);</div>
<div class="line"><a id="l01466" name="l01466"></a><span class="lineno"> 1466</span>    }</div>
<div class="line"><a id="l01467" name="l01467"></a><span class="lineno"> 1467</span>}</div>
<div class="line"><a id="l01468" name="l01468"></a><span class="lineno"> 1468</span> </div>
<div class="line"><a id="l01469" name="l01469"></a><span class="lineno"><a class="line" href="../../d1/d78/a08256.html#a9243c0f76a791ab4f0613afc06026141"> 1469</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d1/d78/a08256.html#a9243c0f76a791ab4f0613afc06026141">GameEventMgr::ChangeEquipOrModel</a>(<a class="code hl_typedef" href="../../d1/da8/a00230.html#aecf4e3680a32207d17f62a3426731878">int16</a> event_id, <span class="keywordtype">bool</span> activate)</div>
<div class="line"><a id="l01470" name="l01470"></a><span class="lineno"> 1470</span>{</div>
<div class="line"><a id="l01471" name="l01471"></a><span class="lineno"> 1471</span>    <span class="keywordflow">for</span> (ModelEquipList::iterator itr = <a class="code hl_variable" href="../../d1/d78/a08256.html#a6b958e82cbac452d531da25e2dba66d7">mGameEventModelEquip</a>[event_id].begin(); itr != <a class="code hl_variable" href="../../d1/d78/a08256.html#a6b958e82cbac452d531da25e2dba66d7">mGameEventModelEquip</a>[event_id].end(); ++itr)</div>
<div class="line"><a id="l01472" name="l01472"></a><span class="lineno"> 1472</span>    {</div>
<div class="line"><a id="l01473" name="l01473"></a><span class="lineno"> 1473</span>        <span class="comment">// Remove the creature from grid</span></div>
<div class="line"><a id="l01474" name="l01474"></a><span class="lineno"> 1474</span>        <a class="code hl_struct" href="../../d0/dd1/a07484.html">CreatureData</a> <span class="keyword">const</span>* data = <a class="code hl_define" href="../../d8/d4e/a01355.html#a736e30da2b5261060ac6cdbb5de3b787">sObjectMgr</a>-&gt;GetCreatureData(itr-&gt;first);</div>
<div class="line"><a id="l01475" name="l01475"></a><span class="lineno"> 1475</span>        <span class="keywordflow">if</span> (!data)</div>
<div class="line"><a id="l01476" name="l01476"></a><span class="lineno"> 1476</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01477" name="l01477"></a><span class="lineno"> 1477</span> </div>
<div class="line"><a id="l01478" name="l01478"></a><span class="lineno"> 1478</span>        <span class="comment">// Update if spawned</span></div>
<div class="line"><a id="l01479" name="l01479"></a><span class="lineno"> 1479</span>        <a class="code hl_define" href="../../d7/d29/a01589.html#a9132749f8376c48b0ca7212eb3293905">sMapMgr</a>-&gt;DoForAllMapsWithMapId(data-&gt;<a class="code hl_variable" href="../../d0/dd1/a07484.html#ad7b505ecbc54fd74d99d6d396b66ee84">mapid</a>, [&amp;itr, activate](<a class="code hl_class" href="../../db/d9f/a09188.html">Map</a>* map)</div>
<div class="line"><a id="l01480" name="l01480"></a><span class="lineno"> 1480</span>        {</div>
<div class="line"><a id="l01481" name="l01481"></a><span class="lineno"> 1481</span>            auto creatureBounds = map-&gt;GetCreatureBySpawnIdStore().equal_range(itr-&gt;first);</div>
<div class="line"><a id="l01482" name="l01482"></a><span class="lineno"> 1482</span>            for (auto itr2 = creatureBounds.first; itr2 != creatureBounds.second; ++itr2)</div>
<div class="line"><a id="l01483" name="l01483"></a><span class="lineno"> 1483</span>            {</div>
<div class="line"><a id="l01484" name="l01484"></a><span class="lineno"> 1484</span>                Creature* creature = itr2-&gt;second;</div>
<div class="line"><a id="l01485" name="l01485"></a><span class="lineno"> 1485</span>                if (activate)</div>
<div class="line"><a id="l01486" name="l01486"></a><span class="lineno"> 1486</span>                {</div>
<div class="line"><a id="l01487" name="l01487"></a><span class="lineno"> 1487</span>                    itr-&gt;second.equipement_id_prev = creature-&gt;GetCurrentEquipmentId();</div>
<div class="line"><a id="l01488" name="l01488"></a><span class="lineno"> 1488</span>                    itr-&gt;second.modelid_prev = creature-&gt;GetDisplayId();</div>
<div class="line"><a id="l01489" name="l01489"></a><span class="lineno"> 1489</span>                    creature-&gt;LoadEquipment(itr-&gt;second.equipment_id, true);</div>
<div class="line"><a id="l01490" name="l01490"></a><span class="lineno"> 1490</span>                    if (itr-&gt;second.modelid &gt; 0 &amp;&amp; itr-&gt;second.modelid_prev != itr-&gt;second.modelid &amp;&amp; sObjectMgr-&gt;GetCreatureModelInfo(itr-&gt;second.modelid))</div>
<div class="line"><a id="l01491" name="l01491"></a><span class="lineno"> 1491</span>                    {</div>
<div class="line"><a id="l01492" name="l01492"></a><span class="lineno"> 1492</span>                        creature-&gt;SetDisplayId(itr-&gt;second.modelid);</div>
<div class="line"><a id="l01493" name="l01493"></a><span class="lineno"> 1493</span>                        creature-&gt;SetNativeDisplayId(itr-&gt;second.modelid);</div>
<div class="line"><a id="l01494" name="l01494"></a><span class="lineno"> 1494</span>                    }</div>
<div class="line"><a id="l01495" name="l01495"></a><span class="lineno"> 1495</span>                }</div>
<div class="line"><a id="l01496" name="l01496"></a><span class="lineno"> 1496</span>                else</div>
<div class="line"><a id="l01497" name="l01497"></a><span class="lineno"> 1497</span>                {</div>
<div class="line"><a id="l01498" name="l01498"></a><span class="lineno"> 1498</span>                    creature-&gt;LoadEquipment(itr-&gt;second.equipement_id_prev, true);</div>
<div class="line"><a id="l01499" name="l01499"></a><span class="lineno"> 1499</span>                    if (itr-&gt;second.modelid_prev &gt; 0 &amp;&amp; itr-&gt;second.modelid_prev != itr-&gt;second.modelid &amp;&amp; sObjectMgr-&gt;GetCreatureModelInfo(itr-&gt;second.modelid_prev))</div>
<div class="line"><a id="l01500" name="l01500"></a><span class="lineno"> 1500</span>                    {</div>
<div class="line"><a id="l01501" name="l01501"></a><span class="lineno"> 1501</span>                        creature-&gt;SetDisplayId(itr-&gt;second.modelid_prev);</div>
<div class="line"><a id="l01502" name="l01502"></a><span class="lineno"> 1502</span>                        creature-&gt;SetNativeDisplayId(itr-&gt;second.modelid_prev);</div>
<div class="line"><a id="l01503" name="l01503"></a><span class="lineno"> 1503</span>                    }</div>
<div class="line"><a id="l01504" name="l01504"></a><span class="lineno"> 1504</span>                }</div>
<div class="line"><a id="l01505" name="l01505"></a><span class="lineno"> 1505</span>            }</div>
<div class="line"><a id="l01506" name="l01506"></a><span class="lineno"> 1506</span>        });</div>
<div class="line"><a id="l01507" name="l01507"></a><span class="lineno"> 1507</span> </div>
<div class="line"><a id="l01508" name="l01508"></a><span class="lineno"> 1508</span>        <span class="comment">// now last step: put in data</span></div>
<div class="line"><a id="l01509" name="l01509"></a><span class="lineno"> 1509</span>        <span class="comment">// just to have write access to it</span></div>
<div class="line"><a id="l01510" name="l01510"></a><span class="lineno"> 1510</span>        <a class="code hl_struct" href="../../d0/dd1/a07484.html">CreatureData</a>&amp; data2 = <a class="code hl_define" href="../../d8/d4e/a01355.html#a736e30da2b5261060ac6cdbb5de3b787">sObjectMgr</a>-&gt;NewOrExistCreatureData(itr-&gt;first);</div>
<div class="line"><a id="l01511" name="l01511"></a><span class="lineno"> 1511</span>        <span class="keywordflow">if</span> (activate)</div>
<div class="line"><a id="l01512" name="l01512"></a><span class="lineno"> 1512</span>        {</div>
<div class="line"><a id="l01513" name="l01513"></a><span class="lineno"> 1513</span>            itr-&gt;second.modelid_prev = data2.<a class="code hl_variable" href="../../d0/dd1/a07484.html#a51bd5a47d052accca3944095253d0d7a">displayid</a>;</div>
<div class="line"><a id="l01514" name="l01514"></a><span class="lineno"> 1514</span>            itr-&gt;second.equipement_id_prev = data2.<a class="code hl_variable" href="../../d0/dd1/a07484.html#ac2d910ad95ea363dbe0a685d5db6cc79">equipmentId</a>;</div>
<div class="line"><a id="l01515" name="l01515"></a><span class="lineno"> 1515</span>            data2.<a class="code hl_variable" href="../../d0/dd1/a07484.html#a51bd5a47d052accca3944095253d0d7a">displayid</a> = itr-&gt;second.modelid;</div>
<div class="line"><a id="l01516" name="l01516"></a><span class="lineno"> 1516</span>            data2.<a class="code hl_variable" href="../../d0/dd1/a07484.html#ac2d910ad95ea363dbe0a685d5db6cc79">equipmentId</a> = itr-&gt;second.equipment_id;</div>
<div class="line"><a id="l01517" name="l01517"></a><span class="lineno"> 1517</span>        }</div>
<div class="line"><a id="l01518" name="l01518"></a><span class="lineno"> 1518</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l01519" name="l01519"></a><span class="lineno"> 1519</span>        {</div>
<div class="line"><a id="l01520" name="l01520"></a><span class="lineno"> 1520</span>            data2.<a class="code hl_variable" href="../../d0/dd1/a07484.html#a51bd5a47d052accca3944095253d0d7a">displayid</a> = itr-&gt;second.modelid_prev;</div>
<div class="line"><a id="l01521" name="l01521"></a><span class="lineno"> 1521</span>            data2.<a class="code hl_variable" href="../../d0/dd1/a07484.html#ac2d910ad95ea363dbe0a685d5db6cc79">equipmentId</a> = itr-&gt;second.equipement_id_prev;</div>
<div class="line"><a id="l01522" name="l01522"></a><span class="lineno"> 1522</span>        }</div>
<div class="line"><a id="l01523" name="l01523"></a><span class="lineno"> 1523</span>    }</div>
<div class="line"><a id="l01524" name="l01524"></a><span class="lineno"> 1524</span>}</div>
<div class="line"><a id="l01525" name="l01525"></a><span class="lineno"> 1525</span> </div>
<div class="line"><a id="l01526" name="l01526"></a><span class="lineno"><a class="line" href="../../d1/d78/a08256.html#ab32f27d9d20652c91cfa6aef6c67bab1"> 1526</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="../../d1/d78/a08256.html#ab32f27d9d20652c91cfa6aef6c67bab1">GameEventMgr::hasCreatureQuestActiveEventExcept</a>(<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> quest_id, <a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a> event_id)</div>
<div class="line"><a id="l01527" name="l01527"></a><span class="lineno"> 1527</span>{</div>
<div class="line"><a id="l01528" name="l01528"></a><span class="lineno"> 1528</span>    <span class="keywordflow">for</span> (ActiveEvents::iterator e_itr = <a class="code hl_variable" href="../../d1/d78/a08256.html#a177cd794e719b24cf1bc70fc7316a8e5">m_ActiveEvents</a>.begin(); e_itr != <a class="code hl_variable" href="../../d1/d78/a08256.html#a177cd794e719b24cf1bc70fc7316a8e5">m_ActiveEvents</a>.end(); ++e_itr)</div>
<div class="line"><a id="l01529" name="l01529"></a><span class="lineno"> 1529</span>    {</div>
<div class="line"><a id="l01530" name="l01530"></a><span class="lineno"> 1530</span>        <span class="keywordflow">if</span> ((*e_itr) != event_id)</div>
<div class="line"><a id="l01531" name="l01531"></a><span class="lineno"> 1531</span>            <span class="keywordflow">for</span> (QuestRelList::iterator itr = <a class="code hl_variable" href="../../d1/d78/a08256.html#a7b61b9926bb2e7ad9a3be4e541f9a4e8">mGameEventCreatureQuests</a>[*e_itr].begin();</div>
<div class="line"><a id="l01532" name="l01532"></a><span class="lineno"> 1532</span>                    itr != <a class="code hl_variable" href="../../d1/d78/a08256.html#a7b61b9926bb2e7ad9a3be4e541f9a4e8">mGameEventCreatureQuests</a>[*e_itr].end();</div>
<div class="line"><a id="l01533" name="l01533"></a><span class="lineno"> 1533</span>                    ++ itr)</div>
<div class="line"><a id="l01534" name="l01534"></a><span class="lineno"> 1534</span>                <span class="keywordflow">if</span> (itr-&gt;second == quest_id)</div>
<div class="line"><a id="l01535" name="l01535"></a><span class="lineno"> 1535</span>                    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01536" name="l01536"></a><span class="lineno"> 1536</span>    }</div>
<div class="line"><a id="l01537" name="l01537"></a><span class="lineno"> 1537</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01538" name="l01538"></a><span class="lineno"> 1538</span>}</div>
<div class="line"><a id="l01539" name="l01539"></a><span class="lineno"> 1539</span> </div>
<div class="line"><a id="l01540" name="l01540"></a><span class="lineno"><a class="line" href="../../d1/d78/a08256.html#adddda916da8f95d50cfa17f28f76fe91"> 1540</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="../../d1/d78/a08256.html#adddda916da8f95d50cfa17f28f76fe91">GameEventMgr::hasGameObjectQuestActiveEventExcept</a>(<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> quest_id, <a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a> event_id)</div>
<div class="line"><a id="l01541" name="l01541"></a><span class="lineno"> 1541</span>{</div>
<div class="line"><a id="l01542" name="l01542"></a><span class="lineno"> 1542</span>    <span class="keywordflow">for</span> (ActiveEvents::iterator e_itr = <a class="code hl_variable" href="../../d1/d78/a08256.html#a177cd794e719b24cf1bc70fc7316a8e5">m_ActiveEvents</a>.begin(); e_itr != <a class="code hl_variable" href="../../d1/d78/a08256.html#a177cd794e719b24cf1bc70fc7316a8e5">m_ActiveEvents</a>.end(); ++e_itr)</div>
<div class="line"><a id="l01543" name="l01543"></a><span class="lineno"> 1543</span>    {</div>
<div class="line"><a id="l01544" name="l01544"></a><span class="lineno"> 1544</span>        <span class="keywordflow">if</span> ((*e_itr) != event_id)</div>
<div class="line"><a id="l01545" name="l01545"></a><span class="lineno"> 1545</span>            <span class="keywordflow">for</span> (QuestRelList::iterator itr = <a class="code hl_variable" href="../../d1/d78/a08256.html#ab470698b19df4edd09f6b32fcfe120fc">mGameEventGameObjectQuests</a>[*e_itr].begin();</div>
<div class="line"><a id="l01546" name="l01546"></a><span class="lineno"> 1546</span>                    itr != <a class="code hl_variable" href="../../d1/d78/a08256.html#ab470698b19df4edd09f6b32fcfe120fc">mGameEventGameObjectQuests</a>[*e_itr].end();</div>
<div class="line"><a id="l01547" name="l01547"></a><span class="lineno"> 1547</span>                    ++ itr)</div>
<div class="line"><a id="l01548" name="l01548"></a><span class="lineno"> 1548</span>                <span class="keywordflow">if</span> (itr-&gt;second == quest_id)</div>
<div class="line"><a id="l01549" name="l01549"></a><span class="lineno"> 1549</span>                    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01550" name="l01550"></a><span class="lineno"> 1550</span>    }</div>
<div class="line"><a id="l01551" name="l01551"></a><span class="lineno"> 1551</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01552" name="l01552"></a><span class="lineno"> 1552</span>}</div>
<div class="line"><a id="l01553" name="l01553"></a><span class="lineno"><a class="line" href="../../d1/d78/a08256.html#a4a5a551385d8845370ebb857f6bf2b27"> 1553</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="../../d1/d78/a08256.html#a4a5a551385d8845370ebb857f6bf2b27">GameEventMgr::hasCreatureActiveEventExcept</a>(<a class="code hl_typedef" href="../../da/d98/a07852.html#aa278d50613c05dc1333df5185a6993eb">ObjectGuid::LowType</a> creature_guid, <a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a> event_id)</div>
<div class="line"><a id="l01554" name="l01554"></a><span class="lineno"> 1554</span>{</div>
<div class="line"><a id="l01555" name="l01555"></a><span class="lineno"> 1555</span>    <span class="keywordflow">for</span> (ActiveEvents::iterator e_itr = <a class="code hl_variable" href="../../d1/d78/a08256.html#a177cd794e719b24cf1bc70fc7316a8e5">m_ActiveEvents</a>.begin(); e_itr != <a class="code hl_variable" href="../../d1/d78/a08256.html#a177cd794e719b24cf1bc70fc7316a8e5">m_ActiveEvents</a>.end(); ++e_itr)</div>
<div class="line"><a id="l01556" name="l01556"></a><span class="lineno"> 1556</span>    {</div>
<div class="line"><a id="l01557" name="l01557"></a><span class="lineno"> 1557</span>        <span class="keywordflow">if</span> ((*e_itr) != event_id)</div>
<div class="line"><a id="l01558" name="l01558"></a><span class="lineno"> 1558</span>        {</div>
<div class="line"><a id="l01559" name="l01559"></a><span class="lineno"> 1559</span>            <a class="code hl_typedef" href="../../d1/da8/a00230.html#a0bf9964a3ce962c07ad3d8b5432bbbcd">int32</a> internal_event_id = <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>.size() + (*e_itr) - 1;</div>
<div class="line"><a id="l01560" name="l01560"></a><span class="lineno"> 1560</span>            <span class="keywordflow">for</span> (GuidLowList::iterator itr = <a class="code hl_variable" href="../../d1/d78/a08256.html#a340bf17cd48de8175a242d54e0bc88b9">mGameEventCreatureGuids</a>[internal_event_id].begin(); itr != <a class="code hl_variable" href="../../d1/d78/a08256.html#a340bf17cd48de8175a242d54e0bc88b9">mGameEventCreatureGuids</a>[internal_event_id].end(); ++ itr)</div>
<div class="line"><a id="l01561" name="l01561"></a><span class="lineno"> 1561</span>                <span class="keywordflow">if</span> (*itr == creature_guid)</div>
<div class="line"><a id="l01562" name="l01562"></a><span class="lineno"> 1562</span>                    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01563" name="l01563"></a><span class="lineno"> 1563</span>        }</div>
<div class="line"><a id="l01564" name="l01564"></a><span class="lineno"> 1564</span>    }</div>
<div class="line"><a id="l01565" name="l01565"></a><span class="lineno"> 1565</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01566" name="l01566"></a><span class="lineno"> 1566</span>}</div>
<div class="line"><a id="l01567" name="l01567"></a><span class="lineno"><a class="line" href="../../d1/d78/a08256.html#abcc4042cec52a1f35f7c160d975b83f0"> 1567</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="../../d1/d78/a08256.html#abcc4042cec52a1f35f7c160d975b83f0">GameEventMgr::hasGameObjectActiveEventExcept</a>(<a class="code hl_typedef" href="../../da/d98/a07852.html#aa278d50613c05dc1333df5185a6993eb">ObjectGuid::LowType</a> go_guid, <a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a> event_id)</div>
<div class="line"><a id="l01568" name="l01568"></a><span class="lineno"> 1568</span>{</div>
<div class="line"><a id="l01569" name="l01569"></a><span class="lineno"> 1569</span>    <span class="keywordflow">for</span> (ActiveEvents::iterator e_itr = <a class="code hl_variable" href="../../d1/d78/a08256.html#a177cd794e719b24cf1bc70fc7316a8e5">m_ActiveEvents</a>.begin(); e_itr != <a class="code hl_variable" href="../../d1/d78/a08256.html#a177cd794e719b24cf1bc70fc7316a8e5">m_ActiveEvents</a>.end(); ++e_itr)</div>
<div class="line"><a id="l01570" name="l01570"></a><span class="lineno"> 1570</span>    {</div>
<div class="line"><a id="l01571" name="l01571"></a><span class="lineno"> 1571</span>        <span class="keywordflow">if</span> ((*e_itr) != event_id)</div>
<div class="line"><a id="l01572" name="l01572"></a><span class="lineno"> 1572</span>        {</div>
<div class="line"><a id="l01573" name="l01573"></a><span class="lineno"> 1573</span>            <a class="code hl_typedef" href="../../d1/da8/a00230.html#a0bf9964a3ce962c07ad3d8b5432bbbcd">int32</a> internal_event_id = <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>.size() + (*e_itr) - 1;</div>
<div class="line"><a id="l01574" name="l01574"></a><span class="lineno"> 1574</span>            <span class="keywordflow">for</span> (GuidLowList::iterator itr = <a class="code hl_variable" href="../../d1/d78/a08256.html#a7e8911e4170a84527a7eb3d73a8a30f1">mGameEventGameobjectGuids</a>[internal_event_id].begin(); itr != <a class="code hl_variable" href="../../d1/d78/a08256.html#a7e8911e4170a84527a7eb3d73a8a30f1">mGameEventGameobjectGuids</a>[internal_event_id].end(); ++ itr)</div>
<div class="line"><a id="l01575" name="l01575"></a><span class="lineno"> 1575</span>                <span class="keywordflow">if</span> (*itr == go_guid)</div>
<div class="line"><a id="l01576" name="l01576"></a><span class="lineno"> 1576</span>                    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01577" name="l01577"></a><span class="lineno"> 1577</span>        }</div>
<div class="line"><a id="l01578" name="l01578"></a><span class="lineno"> 1578</span>    }</div>
<div class="line"><a id="l01579" name="l01579"></a><span class="lineno"> 1579</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01580" name="l01580"></a><span class="lineno"> 1580</span>}</div>
<div class="line"><a id="l01581" name="l01581"></a><span class="lineno"> 1581</span> </div>
<div class="line"><a id="l01582" name="l01582"></a><span class="lineno"><a class="line" href="../../d1/d78/a08256.html#a361d3a758f1146282aae85b4ed294c59"> 1582</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d1/d78/a08256.html#a361d3a758f1146282aae85b4ed294c59">GameEventMgr::UpdateEventQuests</a>(<a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a> event_id, <span class="keywordtype">bool</span> activate)</div>
<div class="line"><a id="l01583" name="l01583"></a><span class="lineno"> 1583</span>{</div>
<div class="line"><a id="l01584" name="l01584"></a><span class="lineno"> 1584</span>    QuestRelList::iterator itr;</div>
<div class="line"><a id="l01585" name="l01585"></a><span class="lineno"> 1585</span>    <span class="keywordflow">for</span> (itr = <a class="code hl_variable" href="../../d1/d78/a08256.html#a7b61b9926bb2e7ad9a3be4e541f9a4e8">mGameEventCreatureQuests</a>[event_id].begin(); itr != <a class="code hl_variable" href="../../d1/d78/a08256.html#a7b61b9926bb2e7ad9a3be4e541f9a4e8">mGameEventCreatureQuests</a>[event_id].end(); ++itr)</div>
<div class="line"><a id="l01586" name="l01586"></a><span class="lineno"> 1586</span>    {</div>
<div class="line"><a id="l01587" name="l01587"></a><span class="lineno"> 1587</span>        <a class="code hl_typedef" href="../../d8/d4e/a01355.html#ae93b697a9b22d427db8d45f79d10aa34">QuestRelations</a>* CreatureQuestMap = <a class="code hl_define" href="../../d8/d4e/a01355.html#a736e30da2b5261060ac6cdbb5de3b787">sObjectMgr</a>-&gt;GetCreatureQuestRelationMap();</div>
<div class="line"><a id="l01588" name="l01588"></a><span class="lineno"> 1588</span>        <span class="keywordflow">if</span> (activate)                                           <span class="comment">// Add the pair(id, quest) to the multimap</span></div>
<div class="line"><a id="l01589" name="l01589"></a><span class="lineno"> 1589</span>            CreatureQuestMap-&gt;insert(QuestRelations::value_type(itr-&gt;first, itr-&gt;second));</div>
<div class="line"><a id="l01590" name="l01590"></a><span class="lineno"> 1590</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l01591" name="l01591"></a><span class="lineno"> 1591</span>        {</div>
<div class="line"><a id="l01592" name="l01592"></a><span class="lineno"> 1592</span>            <span class="keywordflow">if</span> (!<a class="code hl_function" href="../../d1/d78/a08256.html#ab32f27d9d20652c91cfa6aef6c67bab1">hasCreatureQuestActiveEventExcept</a>(itr-&gt;second, event_id))</div>
<div class="line"><a id="l01593" name="l01593"></a><span class="lineno"> 1593</span>            {</div>
<div class="line"><a id="l01594" name="l01594"></a><span class="lineno"> 1594</span>                <span class="comment">// Remove the pair(id, quest) from the multimap</span></div>
<div class="line"><a id="l01595" name="l01595"></a><span class="lineno"> 1595</span>                QuestRelations::iterator qitr = CreatureQuestMap-&gt;find(itr-&gt;first);</div>
<div class="line"><a id="l01596" name="l01596"></a><span class="lineno"> 1596</span>                <span class="keywordflow">if</span> (qitr == CreatureQuestMap-&gt;end())</div>
<div class="line"><a id="l01597" name="l01597"></a><span class="lineno"> 1597</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01598" name="l01598"></a><span class="lineno"> 1598</span>                QuestRelations::iterator lastElement = CreatureQuestMap-&gt;upper_bound(itr-&gt;first);</div>
<div class="line"><a id="l01599" name="l01599"></a><span class="lineno"> 1599</span>                <span class="keywordflow">for</span> (; qitr != lastElement; ++qitr)</div>
<div class="line"><a id="l01600" name="l01600"></a><span class="lineno"> 1600</span>                {</div>
<div class="line"><a id="l01601" name="l01601"></a><span class="lineno"> 1601</span>                    <span class="keywordflow">if</span> (qitr-&gt;second == itr-&gt;second)</div>
<div class="line"><a id="l01602" name="l01602"></a><span class="lineno"> 1602</span>                    {</div>
<div class="line"><a id="l01603" name="l01603"></a><span class="lineno"> 1603</span>                        CreatureQuestMap-&gt;erase(qitr);          <span class="comment">// iterator is now no more valid</span></div>
<div class="line"><a id="l01604" name="l01604"></a><span class="lineno"> 1604</span>                        <span class="keywordflow">break</span>;                                  <span class="comment">// but we can exit loop since the element is found</span></div>
<div class="line"><a id="l01605" name="l01605"></a><span class="lineno"> 1605</span>                    }</div>
<div class="line"><a id="l01606" name="l01606"></a><span class="lineno"> 1606</span>                }</div>
<div class="line"><a id="l01607" name="l01607"></a><span class="lineno"> 1607</span>            }</div>
<div class="line"><a id="l01608" name="l01608"></a><span class="lineno"> 1608</span>        }</div>
<div class="line"><a id="l01609" name="l01609"></a><span class="lineno"> 1609</span>    }</div>
<div class="line"><a id="l01610" name="l01610"></a><span class="lineno"> 1610</span>    <span class="keywordflow">for</span> (itr = <a class="code hl_variable" href="../../d1/d78/a08256.html#ab470698b19df4edd09f6b32fcfe120fc">mGameEventGameObjectQuests</a>[event_id].begin(); itr != <a class="code hl_variable" href="../../d1/d78/a08256.html#ab470698b19df4edd09f6b32fcfe120fc">mGameEventGameObjectQuests</a>[event_id].end(); ++itr)</div>
<div class="line"><a id="l01611" name="l01611"></a><span class="lineno"> 1611</span>    {</div>
<div class="line"><a id="l01612" name="l01612"></a><span class="lineno"> 1612</span>        <a class="code hl_typedef" href="../../d8/d4e/a01355.html#ae93b697a9b22d427db8d45f79d10aa34">QuestRelations</a>* GameObjectQuestMap = <a class="code hl_define" href="../../d8/d4e/a01355.html#a736e30da2b5261060ac6cdbb5de3b787">sObjectMgr</a>-&gt;GetGOQuestRelationMap();</div>
<div class="line"><a id="l01613" name="l01613"></a><span class="lineno"> 1613</span>        <span class="keywordflow">if</span> (activate)                                           <span class="comment">// Add the pair(id, quest) to the multimap</span></div>
<div class="line"><a id="l01614" name="l01614"></a><span class="lineno"> 1614</span>            GameObjectQuestMap-&gt;insert(QuestRelations::value_type(itr-&gt;first, itr-&gt;second));</div>
<div class="line"><a id="l01615" name="l01615"></a><span class="lineno"> 1615</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l01616" name="l01616"></a><span class="lineno"> 1616</span>        {</div>
<div class="line"><a id="l01617" name="l01617"></a><span class="lineno"> 1617</span>            <span class="keywordflow">if</span> (!<a class="code hl_function" href="../../d1/d78/a08256.html#adddda916da8f95d50cfa17f28f76fe91">hasGameObjectQuestActiveEventExcept</a>(itr-&gt;second, event_id))</div>
<div class="line"><a id="l01618" name="l01618"></a><span class="lineno"> 1618</span>            {</div>
<div class="line"><a id="l01619" name="l01619"></a><span class="lineno"> 1619</span>                <span class="comment">// Remove the pair(id, quest) from the multimap</span></div>
<div class="line"><a id="l01620" name="l01620"></a><span class="lineno"> 1620</span>                QuestRelations::iterator qitr = GameObjectQuestMap-&gt;find(itr-&gt;first);</div>
<div class="line"><a id="l01621" name="l01621"></a><span class="lineno"> 1621</span>                <span class="keywordflow">if</span> (qitr == GameObjectQuestMap-&gt;end())</div>
<div class="line"><a id="l01622" name="l01622"></a><span class="lineno"> 1622</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01623" name="l01623"></a><span class="lineno"> 1623</span>                QuestRelations::iterator lastElement = GameObjectQuestMap-&gt;upper_bound(itr-&gt;first);</div>
<div class="line"><a id="l01624" name="l01624"></a><span class="lineno"> 1624</span>                <span class="keywordflow">for</span> (; qitr != lastElement; ++qitr)</div>
<div class="line"><a id="l01625" name="l01625"></a><span class="lineno"> 1625</span>                {</div>
<div class="line"><a id="l01626" name="l01626"></a><span class="lineno"> 1626</span>                    <span class="keywordflow">if</span> (qitr-&gt;second == itr-&gt;second)</div>
<div class="line"><a id="l01627" name="l01627"></a><span class="lineno"> 1627</span>                    {</div>
<div class="line"><a id="l01628" name="l01628"></a><span class="lineno"> 1628</span>                        GameObjectQuestMap-&gt;erase(qitr);        <span class="comment">// iterator is now no more valid</span></div>
<div class="line"><a id="l01629" name="l01629"></a><span class="lineno"> 1629</span>                        <span class="keywordflow">break</span>;                                  <span class="comment">// but we can exit loop since the element is found</span></div>
<div class="line"><a id="l01630" name="l01630"></a><span class="lineno"> 1630</span>                    }</div>
<div class="line"><a id="l01631" name="l01631"></a><span class="lineno"> 1631</span>                }</div>
<div class="line"><a id="l01632" name="l01632"></a><span class="lineno"> 1632</span>            }</div>
<div class="line"><a id="l01633" name="l01633"></a><span class="lineno"> 1633</span>        }</div>
<div class="line"><a id="l01634" name="l01634"></a><span class="lineno"> 1634</span>    }</div>
<div class="line"><a id="l01635" name="l01635"></a><span class="lineno"> 1635</span>}</div>
<div class="line"><a id="l01636" name="l01636"></a><span class="lineno"> 1636</span> </div>
<div class="line"><a id="l01637" name="l01637"></a><span class="lineno"><a class="line" href="../../d1/d78/a08256.html#a4947451f4fb593dbc16ac29d77dd603c"> 1637</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d1/d78/a08256.html#a4947451f4fb593dbc16ac29d77dd603c">GameEventMgr::UpdateWorldStates</a>(<a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a> event_id, <span class="keywordtype">bool</span> Activate)</div>
<div class="line"><a id="l01638" name="l01638"></a><span class="lineno"> 1638</span>{</div>
<div class="line"><a id="l01639" name="l01639"></a><span class="lineno"> 1639</span>    <a class="code hl_struct" href="../../d8/dba/a08244.html">GameEventData</a> <span class="keyword">const</span>&amp; <span class="keyword">event</span> = <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id];</div>
<div class="line"><a id="l01640" name="l01640"></a><span class="lineno"> 1640</span>    <span class="keywordflow">if</span> (event.holiday_id != <a class="code hl_enumvalue" href="../../d9/d4e/a04307.html#ad279224fea61f9754572051fc5ff1faba28168544ac4271e71835f87f564500f7">HOLIDAY_NONE</a>)</div>
<div class="line"><a id="l01641" name="l01641"></a><span class="lineno"> 1641</span>    {</div>
<div class="line"><a id="l01642" name="l01642"></a><span class="lineno"> 1642</span>        <a class="code hl_enumeration" href="../../d9/d4e/a04307.html#aaef9ddb244c12d22800aee24c3b637a2">BattlegroundTypeId</a> bgTypeId = <a class="code hl_function" href="../../d0/d90/a06760.html#ac0f83277c43b85d594bfc78d7891914b">BattlegroundMgr::WeekendHolidayIdToBGType</a>(event.holiday_id);</div>
<div class="line"><a id="l01643" name="l01643"></a><span class="lineno"> 1643</span>        <span class="keywordflow">if</span> (bgTypeId != <a class="code hl_enumvalue" href="../../d9/d4e/a04307.html#aaef9ddb244c12d22800aee24c3b637a2a8748942e38a5e4140daf8e10cb08f0c7">BATTLEGROUND_TYPE_NONE</a>)</div>
<div class="line"><a id="l01644" name="l01644"></a><span class="lineno"> 1644</span>        {</div>
<div class="line"><a id="l01645" name="l01645"></a><span class="lineno"> 1645</span>            <a class="code hl_struct" href="../../df/d5d/a30040.html">BattlemasterListEntry</a> <span class="keyword">const</span>* bl = <a class="code hl_variable" href="../../d9/d7c/a01073.html#a5a1a250429eec448b673fbe580f64fa6">sBattlemasterListStore</a>.LookupEntry(bgTypeId);</div>
<div class="line"><a id="l01646" name="l01646"></a><span class="lineno"> 1646</span>            <span class="keywordflow">if</span> (bl &amp;&amp; bl-&gt;<a class="code hl_variable" href="../../df/d5d/a30040.html#a3f70ffbb1abb5a96fe91c2eec3682c8b">HolidayWorldStateId</a>)</div>
<div class="line"><a id="l01647" name="l01647"></a><span class="lineno"> 1647</span>            {</div>
<div class="line"><a id="l01648" name="l01648"></a><span class="lineno"> 1648</span>                <a class="code hl_class" href="../../db/dcb/a10284.html">WorldPackets::WorldState::UpdateWorldState</a> worldstate;</div>
<div class="line"><a id="l01649" name="l01649"></a><span class="lineno"> 1649</span>                worldstate.<a class="code hl_variable" href="../../db/dcb/a10284.html#aa73278b324822f509f48e6edcdaed457">VariableID</a> = bl-&gt;<a class="code hl_variable" href="../../df/d5d/a30040.html#a3f70ffbb1abb5a96fe91c2eec3682c8b">HolidayWorldStateId</a>;</div>
<div class="line"><a id="l01650" name="l01650"></a><span class="lineno"> 1650</span>                worldstate.<a class="code hl_variable" href="../../db/dcb/a10284.html#a51fa2401d8af4c1c7848b423cb6f056f">Value</a> = Activate ? 1 : 0;</div>
<div class="line"><a id="l01651" name="l01651"></a><span class="lineno"> 1651</span>                <a class="code hl_define" href="../../d3/d74/a04418.html#ga05dfb35c344e5b947a19e4284e7f5fa7">sWorld</a>-&gt;SendGlobalMessage(worldstate.<a class="code hl_function" href="../../db/dcb/a10284.html#a76a4c5d6a06ce8d86a2d3f04f68e838d">Write</a>());</div>
<div class="line"><a id="l01652" name="l01652"></a><span class="lineno"> 1652</span>            }</div>
<div class="line"><a id="l01653" name="l01653"></a><span class="lineno"> 1653</span>        }</div>
<div class="line"><a id="l01654" name="l01654"></a><span class="lineno"> 1654</span>    }</div>
<div class="line"><a id="l01655" name="l01655"></a><span class="lineno"> 1655</span>}</div>
<div class="line"><a id="l01656" name="l01656"></a><span class="lineno"> 1656</span> </div>
<div class="line"><a id="l01657" name="l01657"></a><span class="lineno"><a class="line" href="../../d1/d78/a08256.html#a0af4cb4225e30b14f996407a3d75d13d"> 1657</a></span><a class="code hl_function" href="../../d1/d78/a08256.html#a0af4cb4225e30b14f996407a3d75d13d">GameEventMgr::GameEventMgr</a>() : isSystemInit(false)</div>
<div class="line"><a id="l01658" name="l01658"></a><span class="lineno"> 1658</span>{</div>
<div class="line"><a id="l01659" name="l01659"></a><span class="lineno"> 1659</span>}</div>
<div class="line"><a id="l01660" name="l01660"></a><span class="lineno"> 1660</span> </div>
<div class="line"><a id="l01661" name="l01661"></a><span class="lineno"><a class="line" href="../../d1/d78/a08256.html#a11767f07de64da985d77bef86b86a2c4"> 1661</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d1/d78/a08256.html#a11767f07de64da985d77bef86b86a2c4">GameEventMgr::HandleQuestComplete</a>(<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> quest_id)</div>
<div class="line"><a id="l01662" name="l01662"></a><span class="lineno"> 1662</span>{</div>
<div class="line"><a id="l01663" name="l01663"></a><span class="lineno"> 1663</span>    <span class="comment">// translate the quest to event and condition</span></div>
<div class="line"><a id="l01664" name="l01664"></a><span class="lineno"> 1664</span>    QuestIdToEventConditionMap::iterator itr = <a class="code hl_variable" href="../../d1/d78/a08256.html#aa2123dfc70039ad79394bc554233a906">mQuestToEventConditions</a>.find(quest_id);</div>
<div class="line"><a id="l01665" name="l01665"></a><span class="lineno"> 1665</span>    <span class="comment">// quest is registered</span></div>
<div class="line"><a id="l01666" name="l01666"></a><span class="lineno"> 1666</span>    <span class="keywordflow">if</span> (itr != <a class="code hl_variable" href="../../d1/d78/a08256.html#aa2123dfc70039ad79394bc554233a906">mQuestToEventConditions</a>.end())</div>
<div class="line"><a id="l01667" name="l01667"></a><span class="lineno"> 1667</span>    {</div>
<div class="line"><a id="l01668" name="l01668"></a><span class="lineno"> 1668</span>        <a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a> event_id = itr-&gt;second.event_id;</div>
<div class="line"><a id="l01669" name="l01669"></a><span class="lineno"> 1669</span>        <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> condition = itr-&gt;second.condition;</div>
<div class="line"><a id="l01670" name="l01670"></a><span class="lineno"> 1670</span>        <span class="keywordtype">float</span> num = itr-&gt;second.num;</div>
<div class="line"><a id="l01671" name="l01671"></a><span class="lineno"> 1671</span> </div>
<div class="line"><a id="l01672" name="l01672"></a><span class="lineno"> 1672</span>        <span class="comment">// the event is not active, so return, don&#39;t increase condition finishes</span></div>
<div class="line"><a id="l01673" name="l01673"></a><span class="lineno"> 1673</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="../../d1/d78/a08256.html#a259b6e7b37520d0c23f06c6988e626c9">IsActiveEvent</a>(event_id))</div>
<div class="line"><a id="l01674" name="l01674"></a><span class="lineno"> 1674</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01675" name="l01675"></a><span class="lineno"> 1675</span>        <span class="comment">// not in correct phase, return</span></div>
<div class="line"><a id="l01676" name="l01676"></a><span class="lineno"> 1676</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id].state != <a class="code hl_enumvalue" href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5a627f133a79fe9018b98ee3646e334ff7">GAMEEVENT_WORLD_CONDITIONS</a>)</div>
<div class="line"><a id="l01677" name="l01677"></a><span class="lineno"> 1677</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01678" name="l01678"></a><span class="lineno"> 1678</span>        GameEventConditionMap::iterator citr = <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id].conditions.find(condition);</div>
<div class="line"><a id="l01679" name="l01679"></a><span class="lineno"> 1679</span>        <span class="comment">// condition is registered</span></div>
<div class="line"><a id="l01680" name="l01680"></a><span class="lineno"> 1680</span>        <span class="keywordflow">if</span> (citr != <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id].conditions.end())</div>
<div class="line"><a id="l01681" name="l01681"></a><span class="lineno"> 1681</span>        {</div>
<div class="line"><a id="l01682" name="l01682"></a><span class="lineno"> 1682</span>            <span class="comment">// increase the done count, only if less then the req</span></div>
<div class="line"><a id="l01683" name="l01683"></a><span class="lineno"> 1683</span>            <span class="keywordflow">if</span> (citr-&gt;second.done &lt; citr-&gt;second.reqNum)</div>
<div class="line"><a id="l01684" name="l01684"></a><span class="lineno"> 1684</span>            {</div>
<div class="line"><a id="l01685" name="l01685"></a><span class="lineno"> 1685</span>                citr-&gt;second.done += num;</div>
<div class="line"><a id="l01686" name="l01686"></a><span class="lineno"> 1686</span>                <span class="comment">// check max limit</span></div>
<div class="line"><a id="l01687" name="l01687"></a><span class="lineno"> 1687</span>                <span class="keywordflow">if</span> (citr-&gt;second.done &gt; citr-&gt;second.reqNum)</div>
<div class="line"><a id="l01688" name="l01688"></a><span class="lineno"> 1688</span>                    citr-&gt;second.done = citr-&gt;second.reqNum;</div>
<div class="line"><a id="l01689" name="l01689"></a><span class="lineno"> 1689</span>                <span class="comment">// save the change to db</span></div>
<div class="line"><a id="l01690" name="l01690"></a><span class="lineno"> 1690</span>                <a class="code hl_typedef" href="../../d0/d3e/a00566.html#a96bac9a371212c6bab7a9448214666c0">CharacterDatabaseTransaction</a> trans = <a class="code hl_variable" href="../../d9/d19/a00560.html#a7e7534bc66d79434bd280b77cb124eec">CharacterDatabase</a>.BeginTransaction();</div>
<div class="line"><a id="l01691" name="l01691"></a><span class="lineno"> 1691</span> </div>
<div class="line"><a id="l01692" name="l01692"></a><span class="lineno"> 1692</span>                <a class="code hl_class" href="../../d4/dcb/a05336.html">CharacterDatabasePreparedStatement</a>* stmt = <a class="code hl_variable" href="../../d9/d19/a00560.html#a7e7534bc66d79434bd280b77cb124eec">CharacterDatabase</a>.GetPreparedStatement(<a class="code hl_enumvalue" href="../../dc/d25/a00596.html#a76116b4fa282d8e35bf8f8e940b5cba7a830f0c29c0efd7ac5fc390363d45349f">CHAR_DEL_GAME_EVENT_CONDITION_SAVE</a>);</div>
<div class="line"><a id="l01693" name="l01693"></a><span class="lineno"> 1693</span>                stmt-&gt;<a class="code hl_function" href="../../d1/d06/a05468.html#a52fc2e65042c1db51f0923725a0f0ed0">SetData</a>(0, <a class="code hl_typedef" href="../../d1/da8/a00230.html#a15a8d014fadf85c99a2268d8cbd00767">uint8</a>(event_id));</div>
<div class="line"><a id="l01694" name="l01694"></a><span class="lineno"> 1694</span>                stmt-&gt;<a class="code hl_function" href="../../d1/d06/a05468.html#a52fc2e65042c1db51f0923725a0f0ed0">SetData</a>(1, condition);</div>
<div class="line"><a id="l01695" name="l01695"></a><span class="lineno"> 1695</span>                trans-&gt;Append(stmt);</div>
<div class="line"><a id="l01696" name="l01696"></a><span class="lineno"> 1696</span> </div>
<div class="line"><a id="l01697" name="l01697"></a><span class="lineno"> 1697</span>                stmt = <a class="code hl_variable" href="../../d9/d19/a00560.html#a7e7534bc66d79434bd280b77cb124eec">CharacterDatabase</a>.GetPreparedStatement(<a class="code hl_enumvalue" href="../../dc/d25/a00596.html#a76116b4fa282d8e35bf8f8e940b5cba7abbf6f96ca06e7e092f9735091cb734ee">CHAR_INS_GAME_EVENT_CONDITION_SAVE</a>);</div>
<div class="line"><a id="l01698" name="l01698"></a><span class="lineno"> 1698</span>                stmt-&gt;<a class="code hl_function" href="../../d1/d06/a05468.html#a52fc2e65042c1db51f0923725a0f0ed0">SetData</a>(0, <a class="code hl_typedef" href="../../d1/da8/a00230.html#a15a8d014fadf85c99a2268d8cbd00767">uint8</a>(event_id));</div>
<div class="line"><a id="l01699" name="l01699"></a><span class="lineno"> 1699</span>                stmt-&gt;<a class="code hl_function" href="../../d1/d06/a05468.html#a52fc2e65042c1db51f0923725a0f0ed0">SetData</a>(1, condition);</div>
<div class="line"><a id="l01700" name="l01700"></a><span class="lineno"> 1700</span>                stmt-&gt;<a class="code hl_function" href="../../d1/d06/a05468.html#a52fc2e65042c1db51f0923725a0f0ed0">SetData</a>(2, citr-&gt;second.done);</div>
<div class="line"><a id="l01701" name="l01701"></a><span class="lineno"> 1701</span>                trans-&gt;Append(stmt);</div>
<div class="line"><a id="l01702" name="l01702"></a><span class="lineno"> 1702</span>                <a class="code hl_variable" href="../../d9/d19/a00560.html#a7e7534bc66d79434bd280b77cb124eec">CharacterDatabase</a>.CommitTransaction(trans);</div>
<div class="line"><a id="l01703" name="l01703"></a><span class="lineno"> 1703</span>                <span class="comment">// check if all conditions are met, if so, update the event state</span></div>
<div class="line"><a id="l01704" name="l01704"></a><span class="lineno"> 1704</span>                <span class="keywordflow">if</span> (<a class="code hl_function" href="../../d1/d78/a08256.html#a90cfd68d799f3ac60f7eaf6eaa867e01">CheckOneGameEventConditions</a>(event_id))</div>
<div class="line"><a id="l01705" name="l01705"></a><span class="lineno"> 1705</span>                {</div>
<div class="line"><a id="l01706" name="l01706"></a><span class="lineno"> 1706</span>                    <span class="comment">// changed, save to DB the gameevent state</span></div>
<div class="line"><a id="l01707" name="l01707"></a><span class="lineno"> 1707</span>                    <a class="code hl_function" href="../../d1/d78/a08256.html#a89b36d2ce1114ee9b9316aa1ce41ff41">SaveWorldEventStateToDB</a>(event_id);</div>
<div class="line"><a id="l01708" name="l01708"></a><span class="lineno"> 1708</span>                    <span class="comment">// force update events to set timer</span></div>
<div class="line"><a id="l01709" name="l01709"></a><span class="lineno"> 1709</span>                    <a class="code hl_define" href="../../d3/d74/a04418.html#ga05dfb35c344e5b947a19e4284e7f5fa7">sWorld</a>-&gt;ForceGameEventUpdate();</div>
<div class="line"><a id="l01710" name="l01710"></a><span class="lineno"> 1710</span>                }</div>
<div class="line"><a id="l01711" name="l01711"></a><span class="lineno"> 1711</span>            }</div>
<div class="line"><a id="l01712" name="l01712"></a><span class="lineno"> 1712</span>        }</div>
<div class="line"><a id="l01713" name="l01713"></a><span class="lineno"> 1713</span>    }</div>
<div class="line"><a id="l01714" name="l01714"></a><span class="lineno"> 1714</span>}</div>
<div class="line"><a id="l01715" name="l01715"></a><span class="lineno"> 1715</span> </div>
<div class="line"><a id="l01716" name="l01716"></a><span class="lineno"><a class="line" href="../../d1/d78/a08256.html#a90cfd68d799f3ac60f7eaf6eaa867e01"> 1716</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="../../d1/d78/a08256.html#a90cfd68d799f3ac60f7eaf6eaa867e01">GameEventMgr::CheckOneGameEventConditions</a>(<a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a> event_id)</div>
<div class="line"><a id="l01717" name="l01717"></a><span class="lineno"> 1717</span>{</div>
<div class="line"><a id="l01718" name="l01718"></a><span class="lineno"> 1718</span>    <span class="keywordflow">for</span> (GameEventConditionMap::const_iterator itr = <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id].conditions.begin(); itr != <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id].conditions.end(); ++itr)</div>
<div class="line"><a id="l01719" name="l01719"></a><span class="lineno"> 1719</span>        <span class="keywordflow">if</span> (itr-&gt;second.done &lt; itr-&gt;second.reqNum)</div>
<div class="line"><a id="l01720" name="l01720"></a><span class="lineno"> 1720</span>            <span class="comment">// return false if a condition doesn&#39;t match</span></div>
<div class="line"><a id="l01721" name="l01721"></a><span class="lineno"> 1721</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01722" name="l01722"></a><span class="lineno"> 1722</span>    <span class="comment">// set the phase</span></div>
<div class="line"><a id="l01723" name="l01723"></a><span class="lineno"> 1723</span>    <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id].state = <a class="code hl_enumvalue" href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5aa9ecd88c85a086ee5273110051a00bc0">GAMEEVENT_WORLD_NEXTPHASE</a>;</div>
<div class="line"><a id="l01724" name="l01724"></a><span class="lineno"> 1724</span>    <span class="comment">// set the followup events&#39; start time</span></div>
<div class="line"><a id="l01725" name="l01725"></a><span class="lineno"> 1725</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id].nextstart)</div>
<div class="line"><a id="l01726" name="l01726"></a><span class="lineno"> 1726</span>    {</div>
<div class="line"><a id="l01727" name="l01727"></a><span class="lineno"> 1727</span>        time_t currenttime = <a class="code hl_function" href="../../d1/d55/a04496.html#adbe1785d1327dedf2ac403b7cc8e99c2">GameTime::GetGameTime</a>().count();</div>
<div class="line"><a id="l01728" name="l01728"></a><span class="lineno"> 1728</span>        <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id].nextstart = currenttime + <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id].length * 60;</div>
<div class="line"><a id="l01729" name="l01729"></a><span class="lineno"> 1729</span>    }</div>
<div class="line"><a id="l01730" name="l01730"></a><span class="lineno"> 1730</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01731" name="l01731"></a><span class="lineno"> 1731</span>}</div>
<div class="line"><a id="l01732" name="l01732"></a><span class="lineno"> 1732</span> </div>
<div class="line"><a id="l01733" name="l01733"></a><span class="lineno"><a class="line" href="../../d1/d78/a08256.html#a89b36d2ce1114ee9b9316aa1ce41ff41"> 1733</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d1/d78/a08256.html#a89b36d2ce1114ee9b9316aa1ce41ff41">GameEventMgr::SaveWorldEventStateToDB</a>(<a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a> event_id)</div>
<div class="line"><a id="l01734" name="l01734"></a><span class="lineno"> 1734</span>{</div>
<div class="line"><a id="l01735" name="l01735"></a><span class="lineno"> 1735</span>    <a class="code hl_typedef" href="../../d0/d3e/a00566.html#a96bac9a371212c6bab7a9448214666c0">CharacterDatabaseTransaction</a> trans = <a class="code hl_variable" href="../../d9/d19/a00560.html#a7e7534bc66d79434bd280b77cb124eec">CharacterDatabase</a>.BeginTransaction();</div>
<div class="line"><a id="l01736" name="l01736"></a><span class="lineno"> 1736</span> </div>
<div class="line"><a id="l01737" name="l01737"></a><span class="lineno"> 1737</span>    <a class="code hl_class" href="../../d4/dcb/a05336.html">CharacterDatabasePreparedStatement</a>* stmt = <a class="code hl_variable" href="../../d9/d19/a00560.html#a7e7534bc66d79434bd280b77cb124eec">CharacterDatabase</a>.GetPreparedStatement(<a class="code hl_enumvalue" href="../../dc/d25/a00596.html#a76116b4fa282d8e35bf8f8e940b5cba7a1b1c3e937a709055b3e1b7a98100a9f9">CHAR_DEL_GAME_EVENT_SAVE</a>);</div>
<div class="line"><a id="l01738" name="l01738"></a><span class="lineno"> 1738</span>    stmt-&gt;<a class="code hl_function" href="../../d1/d06/a05468.html#a52fc2e65042c1db51f0923725a0f0ed0">SetData</a>(0, <a class="code hl_typedef" href="../../d1/da8/a00230.html#a15a8d014fadf85c99a2268d8cbd00767">uint8</a>(event_id));</div>
<div class="line"><a id="l01739" name="l01739"></a><span class="lineno"> 1739</span>    trans-&gt;Append(stmt);</div>
<div class="line"><a id="l01740" name="l01740"></a><span class="lineno"> 1740</span> </div>
<div class="line"><a id="l01741" name="l01741"></a><span class="lineno"> 1741</span>    stmt = <a class="code hl_variable" href="../../d9/d19/a00560.html#a7e7534bc66d79434bd280b77cb124eec">CharacterDatabase</a>.GetPreparedStatement(<a class="code hl_enumvalue" href="../../dc/d25/a00596.html#a76116b4fa282d8e35bf8f8e940b5cba7a597bd4df13ce8d2be083304c8a23d793">CHAR_INS_GAME_EVENT_SAVE</a>);</div>
<div class="line"><a id="l01742" name="l01742"></a><span class="lineno"> 1742</span>    stmt-&gt;<a class="code hl_function" href="../../d1/d06/a05468.html#a52fc2e65042c1db51f0923725a0f0ed0">SetData</a>(0, <a class="code hl_typedef" href="../../d1/da8/a00230.html#a15a8d014fadf85c99a2268d8cbd00767">uint8</a>(event_id));</div>
<div class="line"><a id="l01743" name="l01743"></a><span class="lineno"> 1743</span>    stmt-&gt;<a class="code hl_function" href="../../d1/d06/a05468.html#a52fc2e65042c1db51f0923725a0f0ed0">SetData</a>(1, <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id].state);</div>
<div class="line"><a id="l01744" name="l01744"></a><span class="lineno"> 1744</span>    stmt-&gt;<a class="code hl_function" href="../../d1/d06/a05468.html#a52fc2e65042c1db51f0923725a0f0ed0">SetData</a>(2, <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id].nextstart ? <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>(<a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id].nextstart) : 0);</div>
<div class="line"><a id="l01745" name="l01745"></a><span class="lineno"> 1745</span>    trans-&gt;Append(stmt);</div>
<div class="line"><a id="l01746" name="l01746"></a><span class="lineno"> 1746</span>    <a class="code hl_variable" href="../../d9/d19/a00560.html#a7e7534bc66d79434bd280b77cb124eec">CharacterDatabase</a>.CommitTransaction(trans);</div>
<div class="line"><a id="l01747" name="l01747"></a><span class="lineno"> 1747</span>}</div>
<div class="line"><a id="l01748" name="l01748"></a><span class="lineno"> 1748</span> </div>
<div class="line"><a id="l01749" name="l01749"></a><span class="lineno"><a class="line" href="../../d1/d78/a08256.html#abb2f155e59b2c038456eeb06da275631"> 1749</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d1/d78/a08256.html#abb2f155e59b2c038456eeb06da275631">GameEventMgr::SendWorldStateUpdate</a>(<a class="code hl_class" href="../../df/d6a/a08044.html">Player</a>* player, <a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a> event_id)</div>
<div class="line"><a id="l01750" name="l01750"></a><span class="lineno"> 1750</span>{</div>
<div class="line"><a id="l01751" name="l01751"></a><span class="lineno"> 1751</span>    GameEventConditionMap::const_iterator itr;</div>
<div class="line"><a id="l01752" name="l01752"></a><span class="lineno"> 1752</span>    <span class="keywordflow">for</span> (itr = <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id].conditions.begin(); itr != <a class="code hl_variable" href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">mGameEvent</a>[event_id].conditions.end(); ++itr)</div>
<div class="line"><a id="l01753" name="l01753"></a><span class="lineno"> 1753</span>    {</div>
<div class="line"><a id="l01754" name="l01754"></a><span class="lineno"> 1754</span>        <span class="keywordflow">if</span> (itr-&gt;second.done_world_state)</div>
<div class="line"><a id="l01755" name="l01755"></a><span class="lineno"> 1755</span>            player-&gt;<a class="code hl_function" href="../../df/d6a/a08044.html#a2a12863caf54ad9a8af56bda556d7a4b">SendUpdateWorldState</a>(itr-&gt;second.done_world_state, (<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>)(itr-&gt;second.done));</div>
<div class="line"><a id="l01756" name="l01756"></a><span class="lineno"> 1756</span>        <span class="keywordflow">if</span> (itr-&gt;second.max_world_state)</div>
<div class="line"><a id="l01757" name="l01757"></a><span class="lineno"> 1757</span>            player-&gt;<a class="code hl_function" href="../../df/d6a/a08044.html#a2a12863caf54ad9a8af56bda556d7a4b">SendUpdateWorldState</a>(itr-&gt;second.max_world_state, (<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a>)(itr-&gt;second.reqNum));</div>
<div class="line"><a id="l01758" name="l01758"></a><span class="lineno"> 1758</span>    }</div>
<div class="line"><a id="l01759" name="l01759"></a><span class="lineno"> 1759</span>}</div>
<div class="line"><a id="l01760" name="l01760"></a><span class="lineno"> 1760</span> </div>
<div class="line"><a id="l01761" name="l01761"></a><span class="lineno"><a class="line" href="../../d7/d21/a08232.html"> 1761</a></span><span class="keyword">class </span><a class="code hl_class" href="../../d7/d21/a08232.html">GameEventAIHookWorker</a></div>
<div class="line"><a id="l01762" name="l01762"></a><span class="lineno"> 1762</span>{</div>
<div class="line"><a id="l01763" name="l01763"></a><span class="lineno"> 1763</span><span class="keyword">public</span>:</div>
<div class="line"><a id="l01764" name="l01764"></a><span class="lineno"><a class="line" href="../../d7/d21/a08232.html#ad72640a18d2d32a9201c965089ee49cf"> 1764</a></span>    <a class="code hl_function" href="../../d7/d21/a08232.html#ad72640a18d2d32a9201c965089ee49cf">GameEventAIHookWorker</a>(<a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a> eventId, <span class="keywordtype">bool</span> activate) : <a class="code hl_variable" href="../../d7/d21/a08232.html#ab1ee68bb7134e84780772eba2cfac766">_eventId</a>(eventId), <a class="code hl_variable" href="../../d7/d21/a08232.html#a756665eafa08f3c8c51ccef69bdd619f">_activate</a>(activate) { }</div>
<div class="line"><a id="l01765" name="l01765"></a><span class="lineno"> 1765</span> </div>
<div class="line"><a id="l01766" name="l01766"></a><span class="lineno"><a class="line" href="../../d7/d21/a08232.html#a23d979ee43838e7d58e9123e36474a5a"> 1766</a></span>    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d7/d21/a08232.html#a23d979ee43838e7d58e9123e36474a5a">Visit</a>(std::unordered_map&lt;ObjectGuid, Creature*&gt;&amp; creatureMap)</div>
<div class="line"><a id="l01767" name="l01767"></a><span class="lineno"> 1767</span>    {</div>
<div class="line"><a id="l01768" name="l01768"></a><span class="lineno"> 1768</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; p : creatureMap)</div>
<div class="line"><a id="l01769" name="l01769"></a><span class="lineno"> 1769</span>            <span class="keywordflow">if</span> (p.second-&gt;IsInWorld() &amp;&amp; !p.second-&gt;IsDuringRemoveFromWorld() &amp;&amp; p.second-&gt;FindMap() &amp;&amp; p.second-&gt;IsAIEnabled &amp;&amp; p.second-&gt;AI())</div>
<div class="line"><a id="l01770" name="l01770"></a><span class="lineno"> 1770</span>                p.second-&gt;AI()-&gt;sOnGameEvent(<a class="code hl_variable" href="../../d7/d21/a08232.html#a756665eafa08f3c8c51ccef69bdd619f">_activate</a>, <a class="code hl_variable" href="../../d7/d21/a08232.html#ab1ee68bb7134e84780772eba2cfac766">_eventId</a>);</div>
<div class="line"><a id="l01771" name="l01771"></a><span class="lineno"> 1771</span>    }</div>
<div class="line"><a id="l01772" name="l01772"></a><span class="lineno"> 1772</span> </div>
<div class="line"><a id="l01773" name="l01773"></a><span class="lineno"><a class="line" href="../../d7/d21/a08232.html#a79106ec550d072d690bbf3496d76cb0a"> 1773</a></span>    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d7/d21/a08232.html#a79106ec550d072d690bbf3496d76cb0a">Visit</a>(std::unordered_map&lt;ObjectGuid, GameObject*&gt;&amp; gameObjectMap)</div>
<div class="line"><a id="l01774" name="l01774"></a><span class="lineno"> 1774</span>    {</div>
<div class="line"><a id="l01775" name="l01775"></a><span class="lineno"> 1775</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; p : gameObjectMap)</div>
<div class="line"><a id="l01776" name="l01776"></a><span class="lineno"> 1776</span>            <span class="keywordflow">if</span> (p.second-&gt;IsInWorld() &amp;&amp; p.second-&gt;FindMap() &amp;&amp; p.second-&gt;AI())</div>
<div class="line"><a id="l01777" name="l01777"></a><span class="lineno"> 1777</span>                p.second-&gt;AI()-&gt;OnGameEvent(<a class="code hl_variable" href="../../d7/d21/a08232.html#a756665eafa08f3c8c51ccef69bdd619f">_activate</a>, <a class="code hl_variable" href="../../d7/d21/a08232.html#ab1ee68bb7134e84780772eba2cfac766">_eventId</a>);</div>
<div class="line"><a id="l01778" name="l01778"></a><span class="lineno"> 1778</span>    }</div>
<div class="line"><a id="l01779" name="l01779"></a><span class="lineno"> 1779</span> </div>
<div class="line"><a id="l01780" name="l01780"></a><span class="lineno"> 1780</span>    <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</div>
<div class="line"><a id="l01781" name="l01781"></a><span class="lineno"><a class="line" href="../../d7/d21/a08232.html#a165476edd8b252bbb90b8b78fae963a6"> 1781</a></span>    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d7/d21/a08232.html#a165476edd8b252bbb90b8b78fae963a6">Visit</a>(std::unordered_map&lt;ObjectGuid, T*&gt;&amp;) { }</div>
<div class="line"><a id="l01782" name="l01782"></a><span class="lineno"> 1782</span> </div>
<div class="line"><a id="l01783" name="l01783"></a><span class="lineno"> 1783</span><span class="keyword">private</span>:</div>
<div class="line"><a id="l01784" name="l01784"></a><span class="lineno"><a class="line" href="../../d7/d21/a08232.html#ab1ee68bb7134e84780772eba2cfac766"> 1784</a></span>    <a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a> <a class="code hl_variable" href="../../d7/d21/a08232.html#ab1ee68bb7134e84780772eba2cfac766">_eventId</a>;</div>
<div class="line"><a id="l01785" name="l01785"></a><span class="lineno"><a class="line" href="../../d7/d21/a08232.html#a756665eafa08f3c8c51ccef69bdd619f"> 1785</a></span>    <span class="keywordtype">bool</span> <a class="code hl_variable" href="../../d7/d21/a08232.html#a756665eafa08f3c8c51ccef69bdd619f">_activate</a>;</div>
<div class="line"><a id="l01786" name="l01786"></a><span class="lineno"> 1786</span>};</div>
<div class="line"><a id="l01787" name="l01787"></a><span class="lineno"> 1787</span> </div>
<div class="line"><a id="l01788" name="l01788"></a><span class="lineno"><a class="line" href="../../d1/d78/a08256.html#a986be1d18003b8288ea3d7b422fc4d9a"> 1788</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d1/d78/a08256.html#a986be1d18003b8288ea3d7b422fc4d9a">GameEventMgr::RunSmartAIScripts</a>(<a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a> event_id, <span class="keywordtype">bool</span> activate)</div>
<div class="line"><a id="l01789" name="l01789"></a><span class="lineno"> 1789</span>{</div>
<div class="line"><a id="l01792" name="l01792"></a><span class="lineno"> 1792</span>    <a class="code hl_define" href="../../d7/d29/a01589.html#a9132749f8376c48b0ca7212eb3293905">sMapMgr</a>-&gt;DoForAllMaps([event_id, activate](<a class="code hl_class" href="../../db/d9f/a09188.html">Map</a>* map)</div>
<div class="line"><a id="l01793" name="l01793"></a><span class="lineno"> 1793</span>    {</div>
<div class="line"><a id="l01794" name="l01794"></a><span class="lineno"> 1794</span>        <a class="code hl_class" href="../../d7/d21/a08232.html">GameEventAIHookWorker</a> worker(event_id, activate);</div>
<div class="line"><a id="l01795" name="l01795"></a><span class="lineno"> 1795</span>        <a class="code hl_class" href="../../de/d1b/a04948.html">TypeContainerVisitor&lt;GameEventAIHookWorker, MapStoredObjectTypesContainer&gt;</a> visitor(worker);</div>
<div class="line"><a id="l01796" name="l01796"></a><span class="lineno"> 1796</span>        visitor.<a class="code hl_function" href="../../de/d1b/a04948.html#af8110dd70655223f06fb08b552420a6d">Visit</a>(map-&gt;<a class="code hl_function" href="../../db/d9f/a09188.html#a1bef904cde2aa309f70873821f164630">GetObjectsStore</a>());</div>
<div class="line"><a id="l01797" name="l01797"></a><span class="lineno"> 1797</span>    });</div>
<div class="line"><a id="l01798" name="l01798"></a><span class="lineno"> 1798</span>}</div>
<div class="line"><a id="l01799" name="l01799"></a><span class="lineno"> 1799</span> </div>
<div class="line"><a id="l01800" name="l01800"></a><span class="lineno"><a class="line" href="../../d1/d78/a08256.html#ab5346c6b86054d0f5f172242d59325eb"> 1800</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="../../d1/d78/a08256.html#ab5346c6b86054d0f5f172242d59325eb">GameEventMgr::SetHolidayEventTime</a>(<a class="code hl_struct" href="../../d8/dba/a08244.html">GameEventData</a>&amp; event)</div>
<div class="line"><a id="l01801" name="l01801"></a><span class="lineno"> 1801</span>{</div>
<div class="line"><a id="l01802" name="l01802"></a><span class="lineno"> 1802</span>    <span class="keywordflow">if</span> (!event.<a class="code hl_variable" href="../../d8/dba/a08244.html#a23a3f6d7f036f6c5b47b84ef1242d056">holidayStage</a>) <span class="comment">// Ignore holiday</span></div>
<div class="line"><a id="l01803" name="l01803"></a><span class="lineno"> 1803</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01804" name="l01804"></a><span class="lineno"> 1804</span> </div>
<div class="line"><a id="l01805" name="l01805"></a><span class="lineno"> 1805</span>    <span class="keyword">const</span> <a class="code hl_struct" href="../../d1/d3d/a30196.html">HolidaysEntry</a>* holiday = <a class="code hl_variable" href="../../d9/d7c/a01073.html#a817e11f567a65f71476999c0012318bd">sHolidaysStore</a>.LookupEntry(event.<a class="code hl_variable" href="../../d8/dba/a08244.html#aa13c2c2eacb9475e18c1d1370566e988">holiday_id</a>);</div>
<div class="line"><a id="l01806" name="l01806"></a><span class="lineno"> 1806</span> </div>
<div class="line"><a id="l01807" name="l01807"></a><span class="lineno"> 1807</span>    <span class="keywordflow">if</span> (!holiday-&gt;<a class="code hl_variable" href="../../d1/d3d/a30196.html#ac5b08b086ef0668508ea9da48642e95b">Date</a>[0] || !holiday-&gt;<a class="code hl_variable" href="../../d1/d3d/a30196.html#a10cae1b1fbb91930209a714c545b129b">Duration</a>[0]) <span class="comment">// Invalid definitions</span></div>
<div class="line"><a id="l01808" name="l01808"></a><span class="lineno"> 1808</span>    {</div>
<div class="line"><a id="l01809" name="l01809"></a><span class="lineno"> 1809</span>        <a class="code hl_define" href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a>(<span class="stringliteral">&quot;sql.sql&quot;</span>, <span class="stringliteral">&quot;Missing date or duration for holiday {}.&quot;</span>, event.<a class="code hl_variable" href="../../d8/dba/a08244.html#aa13c2c2eacb9475e18c1d1370566e988">holiday_id</a>);</div>
<div class="line"><a id="l01810" name="l01810"></a><span class="lineno"> 1810</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01811" name="l01811"></a><span class="lineno"> 1811</span>    }</div>
<div class="line"><a id="l01812" name="l01812"></a><span class="lineno"> 1812</span> </div>
<div class="line"><a id="l01813" name="l01813"></a><span class="lineno"> 1813</span>    <a class="code hl_typedef" href="../../d1/da8/a00230.html#a15a8d014fadf85c99a2268d8cbd00767">uint8</a> stageIndex = <span class="keyword">event</span>.holidayStage - 1;</div>
<div class="line"><a id="l01814" name="l01814"></a><span class="lineno"> 1814</span>    <span class="keyword">event</span>.length = holiday-&gt;<a class="code hl_variable" href="../../d1/d3d/a30196.html#a10cae1b1fbb91930209a714c545b129b">Duration</a>[stageIndex] * <a class="code hl_variable" href="../../df/dc8/a00122.html#ac78ba8a81d12635c129fe2f92ca46c6f">HOUR</a> / <a class="code hl_variable" href="../../df/dc8/a00122.html#afacf27522adfacf698390ddafc53fa30">MINUTE</a>;</div>
<div class="line"><a id="l01815" name="l01815"></a><span class="lineno"> 1815</span> </div>
<div class="line"><a id="l01816" name="l01816"></a><span class="lineno"> 1816</span>    time_t stageOffset = 0;</div>
<div class="line"><a id="l01817" name="l01817"></a><span class="lineno"> 1817</span>    <span class="keywordflow">for</span> (<a class="code hl_typedef" href="../../d1/da8/a00230.html#a15a8d014fadf85c99a2268d8cbd00767">uint8</a> i = 0; i &lt; stageIndex; ++i)</div>
<div class="line"><a id="l01818" name="l01818"></a><span class="lineno"> 1818</span>    {</div>
<div class="line"><a id="l01819" name="l01819"></a><span class="lineno"> 1819</span>        stageOffset += holiday-&gt;<a class="code hl_variable" href="../../d1/d3d/a30196.html#a10cae1b1fbb91930209a714c545b129b">Duration</a>[i] * <a class="code hl_variable" href="../../df/dc8/a00122.html#ac78ba8a81d12635c129fe2f92ca46c6f">HOUR</a>;</div>
<div class="line"><a id="l01820" name="l01820"></a><span class="lineno"> 1820</span>    }</div>
<div class="line"><a id="l01821" name="l01821"></a><span class="lineno"> 1821</span> </div>
<div class="line"><a id="l01822" name="l01822"></a><span class="lineno"> 1822</span>    <span class="keywordflow">switch</span> (holiday-&gt;<a class="code hl_variable" href="../../d1/d3d/a30196.html#a082b59a0ead8223e590cbb371f3ad122">CalendarFilterType</a>)</div>
<div class="line"><a id="l01823" name="l01823"></a><span class="lineno"> 1823</span>    {</div>
<div class="line"><a id="l01824" name="l01824"></a><span class="lineno"> 1824</span>        <span class="keywordflow">case</span> -1: <span class="comment">// Yearly</span></div>
<div class="line"><a id="l01825" name="l01825"></a><span class="lineno"> 1825</span>            <span class="keyword">event</span>.occurence = <a class="code hl_variable" href="../../df/dc8/a00122.html#a0552dd357fedab8892f8550548357a55">YEAR</a> / <a class="code hl_variable" href="../../df/dc8/a00122.html#afacf27522adfacf698390ddafc53fa30">MINUTE</a>; <span class="comment">// Not all too useful</span></div>
<div class="line"><a id="l01826" name="l01826"></a><span class="lineno"> 1826</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01827" name="l01827"></a><span class="lineno"> 1827</span>        <span class="keywordflow">case</span> 0: <span class="comment">// Weekly</span></div>
<div class="line"><a id="l01828" name="l01828"></a><span class="lineno"> 1828</span>            <span class="keyword">event</span>.occurence = <a class="code hl_variable" href="../../df/dc8/a00122.html#a688431b3f57feed4c5408d11114cdf1a">WEEK</a> / <a class="code hl_variable" href="../../df/dc8/a00122.html#afacf27522adfacf698390ddafc53fa30">MINUTE</a>;</div>
<div class="line"><a id="l01829" name="l01829"></a><span class="lineno"> 1829</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01830" name="l01830"></a><span class="lineno"> 1830</span>        <span class="keywordflow">case</span> 1: <span class="comment">// Defined dates only (Darkmoon Faire)</span></div>
<div class="line"><a id="l01831" name="l01831"></a><span class="lineno"> 1831</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01832" name="l01832"></a><span class="lineno"> 1832</span>        <span class="keywordflow">case</span> 2: <span class="comment">// Only used for looping events (Call to Arms)</span></div>
<div class="line"><a id="l01833" name="l01833"></a><span class="lineno"> 1833</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01834" name="l01834"></a><span class="lineno"> 1834</span>    }</div>
<div class="line"><a id="l01835" name="l01835"></a><span class="lineno"> 1835</span> </div>
<div class="line"><a id="l01836" name="l01836"></a><span class="lineno"> 1836</span>    <span class="keywordflow">if</span> (holiday-&gt;<a class="code hl_variable" href="../../d1/d3d/a30196.html#afa2d93998650f88e62bfa76807961274">Looping</a>)</div>
<div class="line"><a id="l01837" name="l01837"></a><span class="lineno"> 1837</span>    {</div>
<div class="line"><a id="l01838" name="l01838"></a><span class="lineno"> 1838</span>        <span class="keyword">event</span>.occurence = 0;</div>
<div class="line"><a id="l01839" name="l01839"></a><span class="lineno"> 1839</span>        <span class="keywordflow">for</span> (<a class="code hl_typedef" href="../../d1/da8/a00230.html#a15a8d014fadf85c99a2268d8cbd00767">uint8</a> i = 0; i &lt; <a class="code hl_define" href="../../d1/d7a/a04262.html#ae4bf557cbdd070d5483ea758ef1ef0f2">MAX_HOLIDAY_DURATIONS</a> &amp;&amp; holiday-&gt;<a class="code hl_variable" href="../../d1/d3d/a30196.html#a10cae1b1fbb91930209a714c545b129b">Duration</a>[i]; ++i)</div>
<div class="line"><a id="l01840" name="l01840"></a><span class="lineno"> 1840</span>        {</div>
<div class="line"><a id="l01841" name="l01841"></a><span class="lineno"> 1841</span>            <span class="keyword">event</span>.occurence += holiday-&gt;<a class="code hl_variable" href="../../d1/d3d/a30196.html#a10cae1b1fbb91930209a714c545b129b">Duration</a>[i] * <a class="code hl_variable" href="../../df/dc8/a00122.html#ac78ba8a81d12635c129fe2f92ca46c6f">HOUR</a> / <a class="code hl_variable" href="../../df/dc8/a00122.html#afacf27522adfacf698390ddafc53fa30">MINUTE</a>;</div>
<div class="line"><a id="l01842" name="l01842"></a><span class="lineno"> 1842</span>        }</div>
<div class="line"><a id="l01843" name="l01843"></a><span class="lineno"> 1843</span>    }</div>
<div class="line"><a id="l01844" name="l01844"></a><span class="lineno"> 1844</span> </div>
<div class="line"><a id="l01845" name="l01845"></a><span class="lineno"> 1845</span>    <span class="keywordtype">bool</span> singleDate = ((holiday-&gt;<a class="code hl_variable" href="../../d1/d3d/a30196.html#ac5b08b086ef0668508ea9da48642e95b">Date</a>[0] &gt;&gt; 24) &amp; 0x1F) == 31; <span class="comment">// Events with fixed date within year have - 1</span></div>
<div class="line"><a id="l01846" name="l01846"></a><span class="lineno"> 1846</span> </div>
<div class="line"><a id="l01847" name="l01847"></a><span class="lineno"> 1847</span>    time_t curTime = <a class="code hl_function" href="../../d1/d55/a04496.html#adbe1785d1327dedf2ac403b7cc8e99c2">GameTime::GetGameTime</a>().count();</div>
<div class="line"><a id="l01848" name="l01848"></a><span class="lineno"> 1848</span>    <span class="keywordflow">for</span> (<a class="code hl_typedef" href="../../d1/da8/a00230.html#a15a8d014fadf85c99a2268d8cbd00767">uint8</a> i = 0; i &lt; <a class="code hl_define" href="../../d1/d7a/a04262.html#ae9554dfb95ff901f440f4166cf1d04ab">MAX_HOLIDAY_DATES</a> &amp;&amp; holiday-&gt;<a class="code hl_variable" href="../../d1/d3d/a30196.html#ac5b08b086ef0668508ea9da48642e95b">Date</a>[i]; ++i)</div>
<div class="line"><a id="l01849" name="l01849"></a><span class="lineno"> 1849</span> </div>
<div class="line"><a id="l01850" name="l01850"></a><span class="lineno"> 1850</span>    {</div>
<div class="line"><a id="l01851" name="l01851"></a><span class="lineno"> 1851</span>        <a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> date = holiday-&gt;<a class="code hl_variable" href="../../d1/d3d/a30196.html#ac5b08b086ef0668508ea9da48642e95b">Date</a>[i];</div>
<div class="line"><a id="l01852" name="l01852"></a><span class="lineno"> 1852</span> </div>
<div class="line"><a id="l01853" name="l01853"></a><span class="lineno"> 1853</span>        tm timeInfo;</div>
<div class="line"><a id="l01854" name="l01854"></a><span class="lineno"> 1854</span>        <span class="keywordflow">if</span> (singleDate)</div>
<div class="line"><a id="l01855" name="l01855"></a><span class="lineno"> 1855</span>        {</div>
<div class="line"><a id="l01856" name="l01856"></a><span class="lineno"> 1856</span>            timeInfo = <a class="code hl_function" href="../../d6/df1/a04447.html#ab6a946894ec0cb9fa9bf76afa8e7fec8">Acore::Time::TimeBreakdown</a>(curTime);</div>
<div class="line"><a id="l01857" name="l01857"></a><span class="lineno"> 1857</span>            timeInfo.tm_year -= 1; <span class="comment">// First try last year (event active through New Year)</span></div>
<div class="line"><a id="l01858" name="l01858"></a><span class="lineno"> 1858</span>        }</div>
<div class="line"><a id="l01859" name="l01859"></a><span class="lineno"> 1859</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l01860" name="l01860"></a><span class="lineno"> 1860</span>        {</div>
<div class="line"><a id="l01861" name="l01861"></a><span class="lineno"> 1861</span>            timeInfo.tm_year = ((date &gt;&gt; 24) &amp; 0x1F) + 100;</div>
<div class="line"><a id="l01862" name="l01862"></a><span class="lineno"> 1862</span>        }</div>
<div class="line"><a id="l01863" name="l01863"></a><span class="lineno"> 1863</span> </div>
<div class="line"><a id="l01864" name="l01864"></a><span class="lineno"> 1864</span>        timeInfo.tm_mon = (date &gt;&gt; 20) &amp; 0xF;</div>
<div class="line"><a id="l01865" name="l01865"></a><span class="lineno"> 1865</span>        timeInfo.tm_mday = ((date &gt;&gt; 14) &amp; 0x3F) + 1;</div>
<div class="line"><a id="l01866" name="l01866"></a><span class="lineno"> 1866</span>        timeInfo.tm_hour = (date &gt;&gt; 6) &amp; 0x1F;</div>
<div class="line"><a id="l01867" name="l01867"></a><span class="lineno"> 1867</span>        timeInfo.tm_min = date &amp; 0x3F;</div>
<div class="line"><a id="l01868" name="l01868"></a><span class="lineno"> 1868</span>        timeInfo.tm_sec = 0;</div>
<div class="line"><a id="l01869" name="l01869"></a><span class="lineno"> 1869</span>        timeInfo.tm_isdst = -1;</div>
<div class="line"><a id="l01870" name="l01870"></a><span class="lineno"> 1870</span> </div>
<div class="line"><a id="l01871" name="l01871"></a><span class="lineno"> 1871</span>        <span class="comment">// try to get next start time (skip past dates)</span></div>
<div class="line"><a id="l01872" name="l01872"></a><span class="lineno"> 1872</span>        time_t startTime = mktime(&amp;timeInfo);</div>
<div class="line"><a id="l01873" name="l01873"></a><span class="lineno"> 1873</span>        <span class="keywordflow">if</span> (curTime &lt; startTime + event.<a class="code hl_variable" href="../../d8/dba/a08244.html#ac45297bad99ddb339b3aa18ec5912c1c">length</a> * <a class="code hl_variable" href="../../df/dc8/a00122.html#afacf27522adfacf698390ddafc53fa30">MINUTE</a>)</div>
<div class="line"><a id="l01874" name="l01874"></a><span class="lineno"> 1874</span>        {</div>
<div class="line"><a id="l01875" name="l01875"></a><span class="lineno"> 1875</span>            <span class="keyword">event</span>.start = startTime + stageOffset;</div>
<div class="line"><a id="l01876" name="l01876"></a><span class="lineno"> 1876</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01877" name="l01877"></a><span class="lineno"> 1877</span>        }</div>
<div class="line"><a id="l01878" name="l01878"></a><span class="lineno"> 1878</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (singleDate)</div>
<div class="line"><a id="l01879" name="l01879"></a><span class="lineno"> 1879</span>        {</div>
<div class="line"><a id="l01880" name="l01880"></a><span class="lineno"> 1880</span>            tm tmCopy = <a class="code hl_function" href="../../d6/df1/a04447.html#ab6a946894ec0cb9fa9bf76afa8e7fec8">Acore::Time::TimeBreakdown</a>(curTime);</div>
<div class="line"><a id="l01881" name="l01881"></a><span class="lineno"> 1881</span>            <span class="keywordtype">int</span> year = tmCopy.tm_year; <span class="comment">// This year</span></div>
<div class="line"><a id="l01882" name="l01882"></a><span class="lineno"> 1882</span>            tmCopy = timeInfo;</div>
<div class="line"><a id="l01883" name="l01883"></a><span class="lineno"> 1883</span>            tmCopy.tm_year = year;</div>
<div class="line"><a id="l01884" name="l01884"></a><span class="lineno"> 1884</span>            <span class="keyword">event</span>.start = mktime(&amp;tmCopy) + stageOffset;</div>
<div class="line"><a id="l01885" name="l01885"></a><span class="lineno"> 1885</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01886" name="l01886"></a><span class="lineno"> 1886</span>        }</div>
<div class="line"><a id="l01887" name="l01887"></a><span class="lineno"> 1887</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l01888" name="l01888"></a><span class="lineno"> 1888</span>        {</div>
<div class="line"><a id="l01889" name="l01889"></a><span class="lineno"> 1889</span>            <span class="comment">// date is due and not a singleDate event, try with next DBC date (modified by holiday_dates)</span></div>
<div class="line"><a id="l01890" name="l01890"></a><span class="lineno"> 1890</span>            <span class="comment">// if none is found we don&#39;t modify start date and use the one in game_event</span></div>
<div class="line"><a id="l01891" name="l01891"></a><span class="lineno"> 1891</span>        }</div>
<div class="line"><a id="l01892" name="l01892"></a><span class="lineno"> 1892</span>    }</div>
<div class="line"><a id="l01893" name="l01893"></a><span class="lineno"> 1893</span>}</div>
<div class="line"><a id="l01894" name="l01894"></a><span class="lineno"> 1894</span> </div>
<div class="line"><a id="l01895" name="l01895"></a><span class="lineno"><a class="line" href="../../d1/d78/a08256.html#a4acee91da0694ed4493cc31756eaa000"> 1895</a></span><a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> <a class="code hl_function" href="../../d1/d78/a08256.html#a4acee91da0694ed4493cc31756eaa000">GameEventMgr::GetHolidayEventId</a>(<a class="code hl_typedef" href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a> holidayId)<span class="keyword"> const</span></div>
<div class="line"><a id="l01896" name="l01896"></a><span class="lineno"> 1896</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01897" name="l01897"></a><span class="lineno"> 1897</span>    <span class="keyword">auto</span> <span class="keyword">const</span>&amp; <a class="code hl_enumeration" href="../../d8/db1/a03098.html#ad29858f6d8ab73f2970f41cb21a76b84">events</a> = <a class="code hl_define" href="../../d3/da4/a01343.html#a3c1c916d94272dfe845b9cc5e8fc292a">sGameEventMgr</a>-&gt;GetEventMap();</div>
<div class="line"><a id="l01898" name="l01898"></a><span class="lineno"> 1898</span> </div>
<div class="line"><a id="l01899" name="l01899"></a><span class="lineno"> 1899</span>    <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; eventEntry : <a class="code hl_enumeration" href="../../d8/db1/a03098.html#ad29858f6d8ab73f2970f41cb21a76b84">events</a>)</div>
<div class="line"><a id="l01900" name="l01900"></a><span class="lineno"> 1900</span>    {</div>
<div class="line"><a id="l01901" name="l01901"></a><span class="lineno"> 1901</span>        <span class="keywordflow">if</span> (eventEntry.holiday_id == holidayId)</div>
<div class="line"><a id="l01902" name="l01902"></a><span class="lineno"> 1902</span>        {</div>
<div class="line"><a id="l01903" name="l01903"></a><span class="lineno"> 1903</span>            <span class="keywordflow">return</span> eventEntry.eventId;</div>
<div class="line"><a id="l01904" name="l01904"></a><span class="lineno"> 1904</span>        }</div>
<div class="line"><a id="l01905" name="l01905"></a><span class="lineno"> 1905</span>    }</div>
<div class="line"><a id="l01906" name="l01906"></a><span class="lineno"> 1906</span> </div>
<div class="line"><a id="l01907" name="l01907"></a><span class="lineno"> 1907</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l01908" name="l01908"></a><span class="lineno"> 1908</span>}</div>
<div class="line"><a id="l01909" name="l01909"></a><span class="lineno"> 1909</span> </div>
<div class="line"><a id="l01910" name="l01910"></a><span class="lineno"><a class="line" href="../../d7/d51/a01340.html#a429db26781d2673aa2f031fc1327ffaf"> 1910</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="../../d7/d51/a01340.html#a429db26781d2673aa2f031fc1327ffaf">IsHolidayActive</a>(<a class="code hl_enumeration" href="../../d9/d4e/a04307.html#ad279224fea61f9754572051fc5ff1fab">HolidayIds</a> <span class="keywordtype">id</span>)</div>
<div class="line"><a id="l01911" name="l01911"></a><span class="lineno"> 1911</span>{</div>
<div class="line"><a id="l01912" name="l01912"></a><span class="lineno"> 1912</span>    <span class="keywordflow">if</span> (<span class="keywordtype">id</span> == <a class="code hl_enumvalue" href="../../d9/d4e/a04307.html#ad279224fea61f9754572051fc5ff1faba28168544ac4271e71835f87f564500f7">HOLIDAY_NONE</a>)</div>
<div class="line"><a id="l01913" name="l01913"></a><span class="lineno"> 1913</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01914" name="l01914"></a><span class="lineno"> 1914</span> </div>
<div class="line"><a id="l01915" name="l01915"></a><span class="lineno"> 1915</span>    <a class="code hl_typedef" href="../../d1/d78/a08256.html#a2d313485105c8ef04b27833f312a2601">GameEventMgr::GameEventDataMap</a> <span class="keyword">const</span>&amp; <a class="code hl_enumeration" href="../../d8/db1/a03098.html#ad29858f6d8ab73f2970f41cb21a76b84">events</a> = <a class="code hl_define" href="../../d3/da4/a01343.html#a3c1c916d94272dfe845b9cc5e8fc292a">sGameEventMgr</a>-&gt;GetEventMap();</div>
<div class="line"><a id="l01916" name="l01916"></a><span class="lineno"> 1916</span>    <a class="code hl_typedef" href="../../d1/d78/a08256.html#a9d1e67f8edbe01fedd10c5fb0aeac2cf">GameEventMgr::ActiveEvents</a> <span class="keyword">const</span>&amp; ae = <a class="code hl_define" href="../../d3/da4/a01343.html#a3c1c916d94272dfe845b9cc5e8fc292a">sGameEventMgr</a>-&gt;GetActiveEventList();</div>
<div class="line"><a id="l01917" name="l01917"></a><span class="lineno"> 1917</span> </div>
<div class="line"><a id="l01918" name="l01918"></a><span class="lineno"> 1918</span>    <span class="keywordflow">for</span> (GameEventMgr::ActiveEvents::const_iterator itr = ae.begin(); itr != ae.end(); ++itr)</div>
<div class="line"><a id="l01919" name="l01919"></a><span class="lineno"> 1919</span>        <span class="keywordflow">if</span> (<a class="code hl_enumeration" href="../../d8/db1/a03098.html#ad29858f6d8ab73f2970f41cb21a76b84">events</a>[*itr].holiday_id == <span class="keywordtype">id</span>)</div>
<div class="line"><a id="l01920" name="l01920"></a><span class="lineno"> 1920</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01921" name="l01921"></a><span class="lineno"> 1921</span> </div>
<div class="line"><a id="l01922" name="l01922"></a><span class="lineno"> 1922</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01923" name="l01923"></a><span class="lineno"> 1923</span>}</div>
<div class="line"><a id="l01924" name="l01924"></a><span class="lineno"> 1924</span> </div>
<div class="line"><a id="l01925" name="l01925"></a><span class="lineno"><a class="line" href="../../d7/d51/a01340.html#aaddb0f1fada20faf4702603241206f91"> 1925</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="../../d7/d51/a01340.html#aaddb0f1fada20faf4702603241206f91">IsEventActive</a>(<a class="code hl_typedef" href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a> event_id)</div>
<div class="line"><a id="l01926" name="l01926"></a><span class="lineno"> 1926</span>{</div>
<div class="line"><a id="l01927" name="l01927"></a><span class="lineno"> 1927</span>    <a class="code hl_typedef" href="../../d1/d78/a08256.html#a9d1e67f8edbe01fedd10c5fb0aeac2cf">GameEventMgr::ActiveEvents</a> <span class="keyword">const</span>&amp; ae = <a class="code hl_define" href="../../d3/da4/a01343.html#a3c1c916d94272dfe845b9cc5e8fc292a">sGameEventMgr</a>-&gt;GetActiveEventList();</div>
<div class="line"><a id="l01928" name="l01928"></a><span class="lineno"> 1928</span>    <span class="keywordflow">return</span> ae.find(event_id) != ae.end();</div>
<div class="line"><a id="l01929" name="l01929"></a><span class="lineno"> 1929</span>}</div>
<div class="ttc" id="aa00122_html_a0552dd357fedab8892f8550548357a55"><div class="ttname"><a href="../../df/dc8/a00122.html#a0552dd357fedab8892f8550548357a55">YEAR</a></div><div class="ttdeci">constexpr auto YEAR</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dc8/a00122_source.html#l00061">Common.h:61</a></div></div>
<div class="ttc" id="aa00122_html_a688431b3f57feed4c5408d11114cdf1a"><div class="ttname"><a href="../../df/dc8/a00122.html#a688431b3f57feed4c5408d11114cdf1a">WEEK</a></div><div class="ttdeci">constexpr auto WEEK</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dc8/a00122_source.html#l00059">Common.h:59</a></div></div>
<div class="ttc" id="aa00122_html_a84190f79c8167211609f67284e066c58"><div class="ttname"><a href="../../df/dc8/a00122.html#a84190f79c8167211609f67284e066c58">IN_MILLISECONDS</a></div><div class="ttdeci">constexpr auto IN_MILLISECONDS</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dc8/a00122_source.html#l00062">Common.h:62</a></div></div>
<div class="ttc" id="aa00122_html_ac78ba8a81d12635c129fe2f92ca46c6f"><div class="ttname"><a href="../../df/dc8/a00122.html#ac78ba8a81d12635c129fe2f92ca46c6f">HOUR</a></div><div class="ttdeci">constexpr auto HOUR</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dc8/a00122_source.html#l00057">Common.h:57</a></div></div>
<div class="ttc" id="aa00122_html_afacf27522adfacf698390ddafc53fa30"><div class="ttname"><a href="../../df/dc8/a00122.html#afacf27522adfacf698390ddafc53fa30">MINUTE</a></div><div class="ttdeci">constexpr auto MINUTE</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dc8/a00122_source.html#l00056">Common.h:56</a></div></div>
<div class="ttc" id="aa00230_html_a0bf9964a3ce962c07ad3d8b5432bbbcd"><div class="ttname"><a href="../../d1/da8/a00230.html#a0bf9964a3ce962c07ad3d8b5432bbbcd">int32</a></div><div class="ttdeci">std::int32_t int32</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/da8/a00230_source.html#l00104">Define.h:104</a></div></div>
<div class="ttc" id="aa00230_html_a15a8d014fadf85c99a2268d8cbd00767"><div class="ttname"><a href="../../d1/da8/a00230.html#a15a8d014fadf85c99a2268d8cbd00767">uint8</a></div><div class="ttdeci">std::uint8_t uint8</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/da8/a00230_source.html#l00110">Define.h:110</a></div></div>
<div class="ttc" id="aa00230_html_a22f78cc9780bf32aff91ae17c3101c8d"><div class="ttname"><a href="../../d1/da8/a00230.html#a22f78cc9780bf32aff91ae17c3101c8d">uint32</a></div><div class="ttdeci">std::uint32_t uint32</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/da8/a00230_source.html#l00108">Define.h:108</a></div></div>
<div class="ttc" id="aa00230_html_a3bb8a71f4ae9af551f71e9eb2c9c3325"><div class="ttname"><a href="../../d1/da8/a00230.html#a3bb8a71f4ae9af551f71e9eb2c9c3325">int8</a></div><div class="ttdeci">std::int8_t int8</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/da8/a00230_source.html#l00106">Define.h:106</a></div></div>
<div class="ttc" id="aa00230_html_ac4dd6ce78ce3b840c53bd4b3c63ed09b"><div class="ttname"><a href="../../d1/da8/a00230.html#ac4dd6ce78ce3b840c53bd4b3c63ed09b">uint64</a></div><div class="ttdeci">std::uint64_t uint64</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/da8/a00230_source.html#l00107">Define.h:107</a></div></div>
<div class="ttc" id="aa00230_html_ad9c79638db63f1dfe2b085743b5cbf7b"><div class="ttname"><a href="../../d1/da8/a00230.html#ad9c79638db63f1dfe2b085743b5cbf7b">uint16</a></div><div class="ttdeci">std::uint16_t uint16</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/da8/a00230_source.html#l00109">Define.h:109</a></div></div>
<div class="ttc" id="aa00230_html_aecf4e3680a32207d17f62a3426731878"><div class="ttname"><a href="../../d1/da8/a00230.html#aecf4e3680a32207d17f62a3426731878">int16</a></div><div class="ttdeci">std::int16_t int16</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/da8/a00230_source.html#l00105">Define.h:105</a></div></div>
<div class="ttc" id="aa00317_html"><div class="ttname"><a href="../../da/de0/a00317.html">Log.h</a></div></div>
<div class="ttc" id="aa00317_html_a271e427d8e8481efd5cd5f537ec9e419"><div class="ttname"><a href="../../da/de0/a00317.html#a271e427d8e8481efd5cd5f537ec9e419">LOG_INFO</a></div><div class="ttdeci">#define LOG_INFO(filterType__,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/de0/a00317_source.html#l00167">Log.h:167</a></div></div>
<div class="ttc" id="aa00317_html_a43832e3fa8508deb4ce43e520005fcd9"><div class="ttname"><a href="../../da/de0/a00317.html#a43832e3fa8508deb4ce43e520005fcd9">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR(filterType__,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/de0/a00317_source.html#l00159">Log.h:159</a></div></div>
<div class="ttc" id="aa00317_html_a47ac782b14a7531c6232777165a1a161"><div class="ttname"><a href="../../da/de0/a00317.html#a47ac782b14a7531c6232777165a1a161">LOG_DEBUG</a></div><div class="ttdeci">#define LOG_DEBUG(filterType__,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/de0/a00317_source.html#l00171">Log.h:171</a></div></div>
<div class="ttc" id="aa00317_html_adf09840a666e1d86bcd3439105db6edc"><div class="ttname"><a href="../../da/de0/a00317.html#adf09840a666e1d86bcd3439105db6edc">LOG_WARN</a></div><div class="ttdeci">#define LOG_WARN(filterType__,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/de0/a00317_source.html#l00163">Log.h:163</a></div></div>
<div class="ttc" id="aa00488_html_a23a2c8663a05f2b03a6f85501972e8c0"><div class="ttname"><a href="../../d4/ddf/a00488.html#a23a2c8663a05f2b03a6f85501972e8c0">GetMSTimeDiffToNow</a></div><div class="ttdeci">uint32 GetMSTimeDiffToNow(uint32 oldMSTime)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/a00488_source.html#l00131">Timer.h:131</a></div></div>
<div class="ttc" id="aa00488_html_a4476c8e13ea790c3536f2749105f9cb9"><div class="ttname"><a href="../../d4/ddf/a00488.html#a4476c8e13ea790c3536f2749105f9cb9">getMSTime</a></div><div class="ttdeci">uint32 getMSTime()</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/a00488_source.html#l00103">Timer.h:103</a></div></div>
<div class="ttc" id="aa00506_html"><div class="ttname"><a href="../../d4/d1f/a00506.html">Util.h</a></div></div>
<div class="ttc" id="aa00560_html_a7e7534bc66d79434bd280b77cb124eec"><div class="ttname"><a href="../../d9/d19/a00560.html#a7e7534bc66d79434bd280b77cb124eec">CharacterDatabase</a></div><div class="ttdeci">DatabaseWorkerPool&lt; CharacterDatabaseConnection &gt; CharacterDatabase</div><div class="ttdoc">Accessor to the character database.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d19/a00560_source.html#l00021">DatabaseEnv.cpp:21</a></div></div>
<div class="ttc" id="aa00560_html_afa9a6509f9913c9c7dd3081523badd7c"><div class="ttname"><a href="../../d9/d19/a00560.html#afa9a6509f9913c9c7dd3081523badd7c">WorldDatabase</a></div><div class="ttdeci">DatabaseWorkerPool&lt; WorldDatabaseConnection &gt; WorldDatabase</div><div class="ttdoc">Accessor to the world database.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d19/a00560_source.html#l00020">DatabaseEnv.cpp:20</a></div></div>
<div class="ttc" id="aa00566_html_a96bac9a371212c6bab7a9448214666c0"><div class="ttname"><a href="../../d0/d3e/a00566.html#a96bac9a371212c6bab7a9448214666c0">CharacterDatabaseTransaction</a></div><div class="ttdeci">SQLTransaction&lt; CharacterDatabaseConnection &gt; CharacterDatabaseTransaction</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d3e/a00566_source.html#l00070">DatabaseEnvFwd.h:70</a></div></div>
<div class="ttc" id="aa00566_html_ab0c9feeec448a181290fcb39565b8253"><div class="ttname"><a href="../../d0/d3e/a00566.html#ab0c9feeec448a181290fcb39565b8253">QueryResult</a></div><div class="ttdeci">std::shared_ptr&lt; ResultSet &gt; QueryResult</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d3e/a00566_source.html#l00028">DatabaseEnvFwd.h:28</a></div></div>
<div class="ttc" id="aa00596_html_a76116b4fa282d8e35bf8f8e940b5cba7a1b1c3e937a709055b3e1b7a98100a9f9"><div class="ttname"><a href="../../dc/d25/a00596.html#a76116b4fa282d8e35bf8f8e940b5cba7a1b1c3e937a709055b3e1b7a98100a9f9">CHAR_DEL_GAME_EVENT_SAVE</a></div><div class="ttdeci">@ CHAR_DEL_GAME_EVENT_SAVE</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d25/a00596_source.html#l00215">CharacterDatabase.h:215</a></div></div>
<div class="ttc" id="aa00596_html_a76116b4fa282d8e35bf8f8e940b5cba7a51c20332895bfb84502a43681c4eb711"><div class="ttname"><a href="../../dc/d25/a00596.html#a76116b4fa282d8e35bf8f8e940b5cba7a51c20332895bfb84502a43681c4eb711">CHAR_DEL_ALL_GAME_EVENT_CONDITION_SAVE</a></div><div class="ttdeci">@ CHAR_DEL_ALL_GAME_EVENT_CONDITION_SAVE</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d25/a00596_source.html#l00218">CharacterDatabase.h:218</a></div></div>
<div class="ttc" id="aa00596_html_a76116b4fa282d8e35bf8f8e940b5cba7a597bd4df13ce8d2be083304c8a23d793"><div class="ttname"><a href="../../dc/d25/a00596.html#a76116b4fa282d8e35bf8f8e940b5cba7a597bd4df13ce8d2be083304c8a23d793">CHAR_INS_GAME_EVENT_SAVE</a></div><div class="ttdeci">@ CHAR_INS_GAME_EVENT_SAVE</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d25/a00596_source.html#l00216">CharacterDatabase.h:216</a></div></div>
<div class="ttc" id="aa00596_html_a76116b4fa282d8e35bf8f8e940b5cba7a830f0c29c0efd7ac5fc390363d45349f"><div class="ttname"><a href="../../dc/d25/a00596.html#a76116b4fa282d8e35bf8f8e940b5cba7a830f0c29c0efd7ac5fc390363d45349f">CHAR_DEL_GAME_EVENT_CONDITION_SAVE</a></div><div class="ttdeci">@ CHAR_DEL_GAME_EVENT_CONDITION_SAVE</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d25/a00596_source.html#l00219">CharacterDatabase.h:219</a></div></div>
<div class="ttc" id="aa00596_html_a76116b4fa282d8e35bf8f8e940b5cba7abbf6f96ca06e7e092f9735091cb734ee"><div class="ttname"><a href="../../dc/d25/a00596.html#a76116b4fa282d8e35bf8f8e940b5cba7abbf6f96ca06e7e092f9735091cb734ee">CHAR_INS_GAME_EVENT_CONDITION_SAVE</a></div><div class="ttdeci">@ CHAR_INS_GAME_EVENT_CONDITION_SAVE</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d25/a00596_source.html#l00220">CharacterDatabase.h:220</a></div></div>
<div class="ttc" id="aa00716_html"><div class="ttname"><a href="../../d2/d94/a00716.html">GameObjectAI.h</a></div></div>
<div class="ttc" id="aa00752_html"><div class="ttname"><a href="../../dd/d5c/a00752.html">UnitAI.h</a></div></div>
<div class="ttc" id="aa00887_html"><div class="ttname"><a href="../../d7/d92/a00887.html">BattlegroundMgr.h</a></div></div>
<div class="ttc" id="aa00887_html_abe50926a988d0fff4ee6ba0358c6b278"><div class="ttname"><a href="../../d7/d92/a00887.html#abe50926a988d0fff4ee6ba0358c6b278">sBattlegroundMgr</a></div><div class="ttdeci">#define sBattlegroundMgr</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d92/a00887_source.html#l00188">BattlegroundMgr.h:188</a></div></div>
<div class="ttc" id="aa01070_html"><div class="ttname"><a href="../../d5/d67/a01070.html">DisableMgr.h</a></div></div>
<div class="ttc" id="aa01070_html_affa2a0d7ee61f6e1bc7c6cb7d2c1b64cad7a3460f1783f4ff25dfd3a6e5416ff0"><div class="ttname"><a href="../../d5/d67/a01070.html#affa2a0d7ee61f6e1bc7c6cb7d2c1b64cad7a3460f1783f4ff25dfd3a6e5416ff0">DISABLE_TYPE_GAME_EVENT</a></div><div class="ttdeci">@ DISABLE_TYPE_GAME_EVENT</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d67/a01070_source.html#l00039">DisableMgr.h:38</a></div></div>
<div class="ttc" id="aa01073_html_a5a1a250429eec448b673fbe580f64fa6"><div class="ttname"><a href="../../d9/d7c/a01073.html#a5a1a250429eec448b673fbe580f64fa6">sBattlemasterListStore</a></div><div class="ttdeci">DBCStorage&lt; BattlemasterListEntry &gt; sBattlemasterListStore(BattlemasterListEntryfmt)</div></div>
<div class="ttc" id="aa01073_html_a817e11f567a65f71476999c0012318bd"><div class="ttname"><a href="../../d9/d7c/a01073.html#a817e11f567a65f71476999c0012318bd">sHolidaysStore</a></div><div class="ttdeci">DBCStorage&lt; HolidaysEntry &gt; sHolidaysStore(Holidaysfmt)</div></div>
<div class="ttc" id="aa01151_html"><div class="ttname"><a href="../../de/df1/a01151.html">GossipDef.h</a></div></div>
<div class="ttc" id="aa01265_html"><div class="ttname"><a href="../../da/dd8/a01265.html">Player.h</a></div></div>
<div class="ttc" id="aa01316_html"><div class="ttname"><a href="../../d4/d49/a01316.html">Transport.h</a></div></div>
<div class="ttc" id="aa01340_html_a429db26781d2673aa2f031fc1327ffaf"><div class="ttname"><a href="../../d7/d51/a01340.html#a429db26781d2673aa2f031fc1327ffaf">IsHolidayActive</a></div><div class="ttdeci">bool IsHolidayActive(HolidayIds id)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01910">GameEventMgr.cpp:1910</a></div></div>
<div class="ttc" id="aa01340_html_aaddb0f1fada20faf4702603241206f91"><div class="ttname"><a href="../../d7/d51/a01340.html#aaddb0f1fada20faf4702603241206f91">IsEventActive</a></div><div class="ttdeci">bool IsEventActive(uint16 event_id)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01925">GameEventMgr.cpp:1925</a></div></div>
<div class="ttc" id="aa01343_html"><div class="ttname"><a href="../../d3/da4/a01343.html">GameEventMgr.h</a></div></div>
<div class="ttc" id="aa01343_html_a3c1c916d94272dfe845b9cc5e8fc292a"><div class="ttname"><a href="../../d3/da4/a01343.html#a3c1c916d94272dfe845b9cc5e8fc292a">sGameEventMgr</a></div><div class="ttdeci">#define sGameEventMgr</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00186">GameEventMgr.h:186</a></div></div>
<div class="ttc" id="aa01343_html_adaa73d920934a951856f7ce003ce2342"><div class="ttname"><a href="../../d3/da4/a01343.html#adaa73d920934a951856f7ce003ce2342">max_ge_check_delay</a></div><div class="ttdeci">#define max_ge_check_delay</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00027">GameEventMgr.h:27</a></div></div>
<div class="ttc" id="aa01343_html_aeb9f2334f35e9f2b2fd8c2ac5630e3b5"><div class="ttname"><a href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5">GameEventState</a></div><div class="ttdeci">GameEventState</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00029">GameEventMgr.h:30</a></div></div>
<div class="ttc" id="aa01343_html_aeb9f2334f35e9f2b2fd8c2ac5630e3b5a0951d2c0686f93e6e7d0e002b4521921"><div class="ttname"><a href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5a0951d2c0686f93e6e7d0e002b4521921">GAMEEVENT_NORMAL</a></div><div class="ttdeci">@ GAMEEVENT_NORMAL</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00031">GameEventMgr.h:31</a></div></div>
<div class="ttc" id="aa01343_html_aeb9f2334f35e9f2b2fd8c2ac5630e3b5a2612ea68e0c9d21dae1af2e9ac04bc81"><div class="ttname"><a href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5a2612ea68e0c9d21dae1af2e9ac04bc81">GAMEEVENT_INTERNAL</a></div><div class="ttdeci">@ GAMEEVENT_INTERNAL</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00036">GameEventMgr.h:36</a></div></div>
<div class="ttc" id="aa01343_html_aeb9f2334f35e9f2b2fd8c2ac5630e3b5a50f420580ff8bcf744a958e2613085bf"><div class="ttname"><a href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5a50f420580ff8bcf744a958e2613085bf">GAMEEVENT_WORLD_FINISHED</a></div><div class="ttdeci">@ GAMEEVENT_WORLD_FINISHED</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00035">GameEventMgr.h:35</a></div></div>
<div class="ttc" id="aa01343_html_aeb9f2334f35e9f2b2fd8c2ac5630e3b5a627f133a79fe9018b98ee3646e334ff7"><div class="ttname"><a href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5a627f133a79fe9018b98ee3646e334ff7">GAMEEVENT_WORLD_CONDITIONS</a></div><div class="ttdeci">@ GAMEEVENT_WORLD_CONDITIONS</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00033">GameEventMgr.h:33</a></div></div>
<div class="ttc" id="aa01343_html_aeb9f2334f35e9f2b2fd8c2ac5630e3b5aa9ecd88c85a086ee5273110051a00bc0"><div class="ttname"><a href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5aa9ecd88c85a086ee5273110051a00bc0">GAMEEVENT_WORLD_NEXTPHASE</a></div><div class="ttdeci">@ GAMEEVENT_WORLD_NEXTPHASE</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00034">GameEventMgr.h:34</a></div></div>
<div class="ttc" id="aa01343_html_aeb9f2334f35e9f2b2fd8c2ac5630e3b5ac5c7f13cfd107dd2d1efb99ce8dd5136"><div class="ttname"><a href="../../d3/da4/a01343.html#aeb9f2334f35e9f2b2fd8c2ac5630e3b5ac5c7f13cfd107dd2d1efb99ce8dd5136">GAMEEVENT_WORLD_INACTIVE</a></div><div class="ttdeci">@ GAMEEVENT_WORLD_INACTIVE</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00032">GameEventMgr.h:32</a></div></div>
<div class="ttc" id="aa01355_html"><div class="ttname"><a href="../../d8/d4e/a01355.html">ObjectMgr.h</a></div></div>
<div class="ttc" id="aa01355_html_a736e30da2b5261060ac6cdbb5de3b787"><div class="ttname"><a href="../../d8/d4e/a01355.html#a736e30da2b5261060ac6cdbb5de3b787">sObjectMgr</a></div><div class="ttdeci">#define sObjectMgr</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d4e/a01355_source.html#l01606">ObjectMgr.h:1606</a></div></div>
<div class="ttc" id="aa01355_html_ae93b697a9b22d427db8d45f79d10aa34"><div class="ttname"><a href="../../d8/d4e/a01355.html#ae93b697a9b22d427db8d45f79d10aa34">QuestRelations</a></div><div class="ttdeci">std::multimap&lt; uint32, uint32 &gt; QuestRelations</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d4e/a01355_source.html#l00518">ObjectMgr.h:518</a></div></div>
<div class="ttc" id="aa01589_html"><div class="ttname"><a href="../../d7/d29/a01589.html">MapMgr.h</a></div></div>
<div class="ttc" id="aa01589_html_a9132749f8376c48b0ca7212eb3293905"><div class="ttname"><a href="../../d7/d29/a01589.html#a9132749f8376c48b0ca7212eb3293905">sMapMgr</a></div><div class="ttdeci">#define sMapMgr</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d29/a01589_source.html#l00212">MapMgr.h:212</a></div></div>
<div class="ttc" id="aa01643_html"><div class="ttname"><a href="../../d4/d49/a01643.html">Language.h</a></div></div>
<div class="ttc" id="aa01643_html_af9ee42b1cf006ecb2d2e74fe71c0761aa229b4b99cf47a371d3633cc3f21800df"><div class="ttname"><a href="../../d4/d49/a01643.html#af9ee42b1cf006ecb2d2e74fe71c0761aa229b4b99cf47a371d3633cc3f21800df">LANG_EVENTMESSAGE</a></div><div class="ttdeci">@ LANG_EVENTMESSAGE</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d49/a01643_source.html#l00036">Language.h:36</a></div></div>
<div class="ttc" id="aa01805_html"><div class="ttname"><a href="../../d7/d62/a01805.html">PoolMgr.h</a></div></div>
<div class="ttc" id="aa01805_html_a9189dd9c6265b9e6d57104dd61a5fe85"><div class="ttname"><a href="../../d7/d62/a01805.html#a9189dd9c6265b9e6d57104dd61a5fe85">sPoolMgr</a></div><div class="ttdeci">#define sPoolMgr</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d62/a01805_source.html#l00163">PoolMgr.h:163</a></div></div>
<div class="ttc" id="aa01958_html"><div class="ttname"><a href="../../d3/d67/a01958.html">ScriptMgr.h</a></div></div>
<div class="ttc" id="aa01958_html_ae8161e629869974bc49b1cbfc73c1087"><div class="ttname"><a href="../../d3/d67/a01958.html#ae8161e629869974bc49b1cbfc73c1087">sScriptMgr</a></div><div class="ttdeci">#define sScriptMgr</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d67/a01958_source.html#l02690">ScriptMgr.h:2690</a></div></div>
<div class="ttc" id="aa02048_html"><div class="ttname"><a href="../../d1/d39/a02048.html">WorldStatePackets.h</a></div></div>
<div class="ttc" id="aa02168_html"><div class="ttname"><a href="../../d1/dce/a02168.html">GameTime.h</a></div></div>
<div class="ttc" id="aa02234_html_a17aac4c166ebe43e3b8fdccf9e012e41a03feb682b413bff57fddbc0f97cc7253"><div class="ttname"><a href="../../d8/d6f/a02234.html#a17aac4c166ebe43e3b8fdccf9e012e41a03feb682b413bff57fddbc0f97cc7253">CONFIG_ARENA_SEASON_ID</a></div><div class="ttdeci">@ CONFIG_ARENA_SEASON_ID</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d6f/a02234_source.html#l00320">IWorld.h:320</a></div></div>
<div class="ttc" id="aa02234_html_a17aac4c166ebe43e3b8fdccf9e012e41a39e301a074c376e4a98a7d8222017733"><div class="ttname"><a href="../../d8/d6f/a02234.html#a17aac4c166ebe43e3b8fdccf9e012e41a39e301a074c376e4a98a7d8222017733">CONFIG_EVENT_ANNOUNCE</a></div><div class="ttdeci">@ CONFIG_EVENT_ANNOUNCE</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d6f/a02234_source.html#l00275">IWorld.h:275</a></div></div>
<div class="ttc" id="aa02240_html"><div class="ttname"><a href="../../dc/d35/a02240.html">World.h</a></div></div>
<div class="ttc" id="aa03098_html_ad29858f6d8ab73f2970f41cb21a76b84"><div class="ttname"><a href="../../d8/db1/a03098.html#ad29858f6d8ab73f2970f41cb21a76b84">events</a></div><div class="ttdeci">events</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/db1/a03098_source.html#l00042">boss_sartura.cpp:43</a></div></div>
<div class="ttc" id="aa04262_html_ae4bf557cbdd070d5483ea758ef1ef0f2"><div class="ttname"><a href="../../d1/d7a/a04262.html#ae4bf557cbdd070d5483ea758ef1ef0f2">MAX_HOLIDAY_DURATIONS</a></div><div class="ttdeci">#define MAX_HOLIDAY_DURATIONS</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d7a/a04262_source.html#l01110">DBCStructure.h:1110</a></div></div>
<div class="ttc" id="aa04262_html_ae9554dfb95ff901f440f4166cf1d04ab"><div class="ttname"><a href="../../d1/d7a/a04262.html#ae9554dfb95ff901f440f4166cf1d04ab">MAX_HOLIDAY_DATES</a></div><div class="ttdeci">#define MAX_HOLIDAY_DATES</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d7a/a04262_source.html#l01111">DBCStructure.h:1111</a></div></div>
<div class="ttc" id="aa04307_html_aaef9ddb244c12d22800aee24c3b637a2"><div class="ttname"><a href="../../d9/d4e/a04307.html#aaef9ddb244c12d22800aee24c3b637a2">BattlegroundTypeId</a></div><div class="ttdeci">BattlegroundTypeId</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d4e/a04307_source.html#l03450">SharedDefines.h:3451</a></div></div>
<div class="ttc" id="aa04307_html_aaef9ddb244c12d22800aee24c3b637a2a8748942e38a5e4140daf8e10cb08f0c7"><div class="ttname"><a href="../../d9/d4e/a04307.html#aaef9ddb244c12d22800aee24c3b637a2a8748942e38a5e4140daf8e10cb08f0c7">BATTLEGROUND_TYPE_NONE</a></div><div class="ttdeci">@ BATTLEGROUND_TYPE_NONE</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d4e/a04307_source.html#l03452">SharedDefines.h:3452</a></div></div>
<div class="ttc" id="aa04307_html_ad279224fea61f9754572051fc5ff1fab"><div class="ttname"><a href="../../d9/d4e/a04307.html#ad279224fea61f9754572051fc5ff1fab">HolidayIds</a></div><div class="ttdeci">HolidayIds</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d4e/a04307_source.html#l02712">SharedDefines.h:2713</a></div></div>
<div class="ttc" id="aa04307_html_ad279224fea61f9754572051fc5ff1faba28168544ac4271e71835f87f564500f7"><div class="ttname"><a href="../../d9/d4e/a04307.html#ad279224fea61f9754572051fc5ff1faba28168544ac4271e71835f87f564500f7">HOLIDAY_NONE</a></div><div class="ttdeci">@ HOLIDAY_NONE</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d4e/a04307_source.html#l02714">SharedDefines.h:2714</a></div></div>
<div class="ttc" id="aa04418_html_ga05dfb35c344e5b947a19e4284e7f5fa7"><div class="ttname"><a href="../../d3/d74/a04418.html#ga05dfb35c344e5b947a19e4284e7f5fa7">sWorld</a></div><div class="ttdeci">#define sWorld</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d35/a02240_source.html#l00458">World.h:458</a></div></div>
<div class="ttc" id="aa04447_html_ab6a946894ec0cb9fa9bf76afa8e7fec8"><div class="ttname"><a href="../../d6/df1/a04447.html#ab6a946894ec0cb9fa9bf76afa8e7fec8">Acore::Time::TimeBreakdown</a></div><div class="ttdeci">AC_COMMON_API std::tm TimeBreakdown(time_t t=0)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d1a/a00485_source.html#l00233">Timer.cpp:233</a></div></div>
<div class="ttc" id="aa04466_html_a6673bbc719c96febfc86a4220a988ed0"><div class="ttname"><a href="../../dd/d3c/a04466.html#a6673bbc719c96febfc86a4220a988ed0">DisableMgr::IsDisabledFor</a></div><div class="ttdeci">bool IsDisabledFor(DisableType type, uint32 entry, Unit const *unit, uint8 flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d49/a01067_source.html#l00304">DisableMgr.cpp:304</a></div></div>
<div class="ttc" id="aa04496_html_adbe1785d1327dedf2ac403b7cc8e99c2"><div class="ttname"><a href="../../d1/d55/a04496.html#adbe1785d1327dedf2ac403b7cc8e99c2">GameTime::GetGameTime</a></div><div class="ttdeci">Seconds GetGameTime()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d4c/a02165_source.html#l00038">GameTime.cpp:38</a></div></div>
<div class="ttc" id="aa04948_html"><div class="ttname"><a href="../../de/d1b/a04948.html">TypeContainerVisitor</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d39/a00257_source.html#l00084">TypeContainerVisitor.h:85</a></div></div>
<div class="ttc" id="aa04948_html_af8110dd70655223f06fb08b552420a6d"><div class="ttname"><a href="../../de/d1b/a04948.html#af8110dd70655223f06fb08b552420a6d">TypeContainerVisitor::Visit</a></div><div class="ttdeci">void Visit(TYPE_CONTAINER &amp;c)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d39/a00257_source.html#l00089">TypeContainerVisitor.h:89</a></div></div>
<div class="ttc" id="aa05336_html"><div class="ttname"><a href="../../d4/dcb/a05336.html">PreparedStatement</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/daa/a00638_source.html#l00157">PreparedStatement.h:158</a></div></div>
<div class="ttc" id="aa05368_html"><div class="ttname"><a href="../../d3/d02/a05368.html">Field</a></div><div class="ttdoc">Class used to access individual fields of database query result.</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/db1/a00590_source.html#l00098">Field.h:99</a></div></div>
<div class="ttc" id="aa05368_html_aae507d21d3570ffdaf1643ba02946f01"><div class="ttname"><a href="../../d3/d02/a05368.html#aae507d21d3570ffdaf1643ba02946f01">Field::Get</a></div><div class="ttdeci">std::enable_if_t&lt; std::is_arithmetic_v&lt; T &gt;, T &gt; Get() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/db1/a00590_source.html#l00113">Field.h:113</a></div></div>
<div class="ttc" id="aa05468_html_a52fc2e65042c1db51f0923725a0f0ed0"><div class="ttname"><a href="../../d1/d06/a05468.html#a52fc2e65042c1db51f0923725a0f0ed0">PreparedStatementBase::SetData</a></div><div class="ttdeci">Acore::Types::is_default&lt; T &gt; SetData(const uint8 index, T value)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/daa/a00638_source.html#l00078">PreparedStatement.h:78</a></div></div>
<div class="ttc" id="aa06760_html_ac0f83277c43b85d594bfc78d7891914b"><div class="ttname"><a href="../../d0/d90/a06760.html#ac0f83277c43b85d594bfc78d7891914b">BattlegroundMgr::WeekendHolidayIdToBGType</a></div><div class="ttdeci">static BattlegroundTypeId WeekendHolidayIdToBGType(HolidayIds holiday)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d08/a00884_source.html#l00874">BattlegroundMgr.cpp:874</a></div></div>
<div class="ttc" id="aa07436_html"><div class="ttname"><a href="../../dc/d6f/a07436.html">Creature</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d28/a01133_source.html#l00045">Creature.h:46</a></div></div>
<div class="ttc" id="aa07436_html_a94ab8e421d4a244df52b7a6b74b2842a"><div class="ttname"><a href="../../dc/d6f/a07436.html#a94ab8e421d4a244df52b7a6b74b2842a">Creature::GetSpawnId</a></div><div class="ttdeci">ObjectGuid::LowType GetSpawnId() const</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d28/a01133_source.html#l00066">Creature.h:66</a></div></div>
<div class="ttc" id="aa07436_html_afdb3640b2f108f85cf1746195c75a5bd"><div class="ttname"><a href="../../dc/d6f/a07436.html#afdb3640b2f108f85cf1746195c75a5bd">Creature::LoadCreatureFromDB</a></div><div class="ttdeci">bool LoadCreatureFromDB(ObjectGuid::LowType guid, Map *map, bool addToMap=true, bool gridLoad=false, bool allowDuplicate=false)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d61/a01130_source.html#l01645">Creature.cpp:1645</a></div></div>
<div class="ttc" id="aa07484_html"><div class="ttname"><a href="../../d0/dd1/a07484.html">CreatureData</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dae/a01136_source.html#l00358">CreatureData.h:359</a></div></div>
<div class="ttc" id="aa07484_html_a51bd5a47d052accca3944095253d0d7a"><div class="ttname"><a href="../../d0/dd1/a07484.html#a51bd5a47d052accca3944095253d0d7a">CreatureData::displayid</a></div><div class="ttdeci">uint32 displayid</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dae/a01136_source.html#l00366">CreatureData.h:366</a></div></div>
<div class="ttc" id="aa07484_html_ac2d910ad95ea363dbe0a685d5db6cc79"><div class="ttname"><a href="../../d0/dd1/a07484.html#ac2d910ad95ea363dbe0a685d5db6cc79">CreatureData::equipmentId</a></div><div class="ttdeci">int8 equipmentId</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dae/a01136_source.html#l00367">CreatureData.h:367</a></div></div>
<div class="ttc" id="aa07484_html_ad7b505ecbc54fd74d99d6d396b66ee84"><div class="ttname"><a href="../../d0/dd1/a07484.html#ad7b505ecbc54fd74d99d6d396b66ee84">CreatureData::mapid</a></div><div class="ttdeci">uint16 mapid</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dae/a01136_source.html#l00364">CreatureData.h:364</a></div></div>
<div class="ttc" id="aa07744_html"><div class="ttname"><a href="../../d7/d9e/a07744.html">GameObjectData</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/daf/a01169_source.html#l00771">GameObject.h:772</a></div></div>
<div class="ttc" id="aa07748_html"><div class="ttname"><a href="../../d7/dc7/a07748.html">GameObject</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/daf/a01169_source.html#l00812">GameObject.h:813</a></div></div>
<div class="ttc" id="aa07748_html_a480c82a758a0654c31d5cda1ab8495e8"><div class="ttname"><a href="../../d7/dc7/a07748.html#a480c82a758a0654c31d5cda1ab8495e8">GameObject::isSpawnedByDefault</a></div><div class="ttdeci">bool isSpawnedByDefault() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/daf/a01169_source.html#l00888">GameObject.h:888</a></div></div>
<div class="ttc" id="aa07748_html_acfb1d37bab02bb7a8e87a94fa9eeab8d"><div class="ttname"><a href="../../d7/dc7/a07748.html#acfb1d37bab02bb7a8e87a94fa9eeab8d">GameObject::LoadGameObjectFromDB</a></div><div class="ttdeci">bool LoadGameObjectFromDB(ObjectGuid::LowType guid, Map *map, bool addToMap=true)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dee/a01166_source.html#l01093">GameObject.cpp:1093</a></div></div>
<div class="ttc" id="aa07852_html_aa278d50613c05dc1333df5185a6993eb"><div class="ttname"><a href="../../da/d98/a07852.html#aa278d50613c05dc1333df5185a6993eb">ObjectGuid::LowType</a></div><div class="ttdeci">uint32 LowType</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d31/a01208_source.html#l00124">ObjectGuid.h:124</a></div></div>
<div class="ttc" id="aa08044_html"><div class="ttname"><a href="../../df/d6a/a08044.html">Player</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/dd8/a01265_source.html#l01045">Player.h:1046</a></div></div>
<div class="ttc" id="aa08044_html_a2a12863caf54ad9a8af56bda556d7a4b"><div class="ttname"><a href="../../df/d6a/a08044.html#a2a12863caf54ad9a8af56bda556d7a4b">Player::SendUpdateWorldState</a></div><div class="ttdeci">void SendUpdateWorldState(uint32 variable, uint32 value) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d7a/a01292_source.html#l02189">PlayerUpdates.cpp:2189</a></div></div>
<div class="ttc" id="aa08092_html"><div class="ttname"><a href="../../d5/d49/a08092.html">StaticTransport</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d49/a01316_source.html#l00111">Transport.h:112</a></div></div>
<div class="ttc" id="aa08232_html"><div class="ttname"><a href="../../d7/d21/a08232.html">GameEventAIHookWorker</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01761">GameEventMgr.cpp:1762</a></div></div>
<div class="ttc" id="aa08232_html_a165476edd8b252bbb90b8b78fae963a6"><div class="ttname"><a href="../../d7/d21/a08232.html#a165476edd8b252bbb90b8b78fae963a6">GameEventAIHookWorker::Visit</a></div><div class="ttdeci">void Visit(std::unordered_map&lt; ObjectGuid, T * &gt; &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01781">GameEventMgr.cpp:1781</a></div></div>
<div class="ttc" id="aa08232_html_a23d979ee43838e7d58e9123e36474a5a"><div class="ttname"><a href="../../d7/d21/a08232.html#a23d979ee43838e7d58e9123e36474a5a">GameEventAIHookWorker::Visit</a></div><div class="ttdeci">void Visit(std::unordered_map&lt; ObjectGuid, Creature * &gt; &amp;creatureMap)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01766">GameEventMgr.cpp:1766</a></div></div>
<div class="ttc" id="aa08232_html_a756665eafa08f3c8c51ccef69bdd619f"><div class="ttname"><a href="../../d7/d21/a08232.html#a756665eafa08f3c8c51ccef69bdd619f">GameEventAIHookWorker::_activate</a></div><div class="ttdeci">bool _activate</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01785">GameEventMgr.cpp:1785</a></div></div>
<div class="ttc" id="aa08232_html_a79106ec550d072d690bbf3496d76cb0a"><div class="ttname"><a href="../../d7/d21/a08232.html#a79106ec550d072d690bbf3496d76cb0a">GameEventAIHookWorker::Visit</a></div><div class="ttdeci">void Visit(std::unordered_map&lt; ObjectGuid, GameObject * &gt; &amp;gameObjectMap)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01773">GameEventMgr.cpp:1773</a></div></div>
<div class="ttc" id="aa08232_html_ab1ee68bb7134e84780772eba2cfac766"><div class="ttname"><a href="../../d7/d21/a08232.html#ab1ee68bb7134e84780772eba2cfac766">GameEventAIHookWorker::_eventId</a></div><div class="ttdeci">uint16 _eventId</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01784">GameEventMgr.cpp:1784</a></div></div>
<div class="ttc" id="aa08232_html_ad72640a18d2d32a9201c965089ee49cf"><div class="ttname"><a href="../../d7/d21/a08232.html#ad72640a18d2d32a9201c965089ee49cf">GameEventAIHookWorker::GameEventAIHookWorker</a></div><div class="ttdeci">GameEventAIHookWorker(uint16 eventId, bool activate)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01764">GameEventMgr.cpp:1764</a></div></div>
<div class="ttc" id="aa08244_html"><div class="ttname"><a href="../../d8/dba/a08244.html">GameEventData</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00056">GameEventMgr.h:57</a></div></div>
<div class="ttc" id="aa08244_html_a04c813525fef572000608f32650565ff"><div class="ttname"><a href="../../d8/dba/a08244.html#a04c813525fef572000608f32650565ff">GameEventData::occurence</a></div><div class="ttdeci">uint32 occurence</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00063">GameEventMgr.h:63</a></div></div>
<div class="ttc" id="aa08244_html_a1bf3980d02cd0dc304b2ffbd5afb7b9f"><div class="ttname"><a href="../../d8/dba/a08244.html#a1bf3980d02cd0dc304b2ffbd5afb7b9f">GameEventData::end</a></div><div class="ttdeci">time_t end</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00061">GameEventMgr.h:61</a></div></div>
<div class="ttc" id="aa08244_html_a23a3f6d7f036f6c5b47b84ef1242d056"><div class="ttname"><a href="../../d8/dba/a08244.html#a23a3f6d7f036f6c5b47b84ef1242d056">GameEventData::holidayStage</a></div><div class="ttdeci">uint8 holidayStage</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00066">GameEventMgr.h:66</a></div></div>
<div class="ttc" id="aa08244_html_a54a6e90fd4b68093a99e32b198eab2fb"><div class="ttname"><a href="../../d8/dba/a08244.html#a54a6e90fd4b68093a99e32b198eab2fb">GameEventData::state</a></div><div class="ttdeci">GameEventState state</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00067">GameEventMgr.h:67</a></div></div>
<div class="ttc" id="aa08244_html_a7271996d66a36e41b21502fa4d5305fe"><div class="ttname"><a href="../../d8/dba/a08244.html#a7271996d66a36e41b21502fa4d5305fe">GameEventData::announce</a></div><div class="ttdeci">uint8 announce</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00071">GameEventMgr.h:71</a></div></div>
<div class="ttc" id="aa08244_html_a858501847212a8771f676641ad61aacd"><div class="ttname"><a href="../../d8/dba/a08244.html#a858501847212a8771f676641ad61aacd">GameEventData::eventId</a></div><div class="ttdeci">uint32 eventId</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00059">GameEventMgr.h:59</a></div></div>
<div class="ttc" id="aa08244_html_aa13c2c2eacb9475e18c1d1370566e988"><div class="ttname"><a href="../../d8/dba/a08244.html#aa13c2c2eacb9475e18c1d1370566e988">GameEventData::holiday_id</a></div><div class="ttdeci">HolidayIds holiday_id</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00065">GameEventMgr.h:65</a></div></div>
<div class="ttc" id="aa08244_html_ac45297bad99ddb339b3aa18ec5912c1c"><div class="ttname"><a href="../../d8/dba/a08244.html#ac45297bad99ddb339b3aa18ec5912c1c">GameEventData::length</a></div><div class="ttdeci">uint32 length</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00064">GameEventMgr.h:64</a></div></div>
<div class="ttc" id="aa08244_html_ac4da43ddbb3b95f00589f49ed250092d"><div class="ttname"><a href="../../d8/dba/a08244.html#ac4da43ddbb3b95f00589f49ed250092d">GameEventData::start</a></div><div class="ttdeci">time_t start</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00060">GameEventMgr.h:60</a></div></div>
<div class="ttc" id="aa08244_html_adca87b4b2205273a29dd2a547be90da6"><div class="ttname"><a href="../../d8/dba/a08244.html#adca87b4b2205273a29dd2a547be90da6">GameEventData::conditions</a></div><div class="ttdeci">GameEventConditionMap conditions</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00068">GameEventMgr.h:68</a></div></div>
<div class="ttc" id="aa08244_html_ae0259f021337b3ad47dfbbc1f361965f"><div class="ttname"><a href="../../d8/dba/a08244.html#ae0259f021337b3ad47dfbbc1f361965f">GameEventData::nextstart</a></div><div class="ttdeci">time_t nextstart</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00062">GameEventMgr.h:62</a></div></div>
<div class="ttc" id="aa08244_html_aebdadbaadbba367601674146a27a283f"><div class="ttname"><a href="../../d8/dba/a08244.html#aebdadbaadbba367601674146a27a283f">GameEventData::description</a></div><div class="ttdeci">std::string description</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00070">GameEventMgr.h:70</a></div></div>
<div class="ttc" id="aa08248_html"><div class="ttname"><a href="../../dd/d37/a08248.html">ModelEquip</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00076">GameEventMgr.h:77</a></div></div>
<div class="ttc" id="aa08248_html_a53296cbdf02039d19610c21e0f7d5d1d"><div class="ttname"><a href="../../dd/d37/a08248.html#a53296cbdf02039d19610c21e0f7d5d1d">ModelEquip::modelid</a></div><div class="ttdeci">uint32 modelid</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00078">GameEventMgr.h:78</a></div></div>
<div class="ttc" id="aa08248_html_a93a895fa31cef29fa739225316886e78"><div class="ttname"><a href="../../dd/d37/a08248.html#a93a895fa31cef29fa739225316886e78">ModelEquip::equipement_id_prev</a></div><div class="ttdeci">uint8 equipement_id_prev</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00081">GameEventMgr.h:81</a></div></div>
<div class="ttc" id="aa08248_html_a976ce0cdd7c8e95465bc999d26347bde"><div class="ttname"><a href="../../dd/d37/a08248.html#a976ce0cdd7c8e95465bc999d26347bde">ModelEquip::modelid_prev</a></div><div class="ttdeci">uint32 modelid_prev</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00079">GameEventMgr.h:79</a></div></div>
<div class="ttc" id="aa08248_html_af21361c600fb9609f554b64bc5cfb4c2"><div class="ttname"><a href="../../dd/d37/a08248.html#af21361c600fb9609f554b64bc5cfb4c2">ModelEquip::equipment_id</a></div><div class="ttdeci">uint8 equipment_id</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00080">GameEventMgr.h:80</a></div></div>
<div class="ttc" id="aa08252_html"><div class="ttname"><a href="../../d1/d86/a08252.html">NPCVendorEntry</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00084">GameEventMgr.h:85</a></div></div>
<div class="ttc" id="aa08252_html_a48cb32b398e0dc6928a30bb254b05a11"><div class="ttname"><a href="../../d1/d86/a08252.html#a48cb32b398e0dc6928a30bb254b05a11">NPCVendorEntry::maxcount</a></div><div class="ttdeci">int32 maxcount</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00088">GameEventMgr.h:88</a></div></div>
<div class="ttc" id="aa08252_html_a8f2e01fb177f33afeef9e37ffd456ff2"><div class="ttname"><a href="../../d1/d86/a08252.html#a8f2e01fb177f33afeef9e37ffd456ff2">NPCVendorEntry::item</a></div><div class="ttdeci">uint32 item</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00087">GameEventMgr.h:87</a></div></div>
<div class="ttc" id="aa08252_html_a924aaeec6de12ef02b5d2f9801571a1f"><div class="ttname"><a href="../../d1/d86/a08252.html#a924aaeec6de12ef02b5d2f9801571a1f">NPCVendorEntry::entry</a></div><div class="ttdeci">uint32 entry</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00086">GameEventMgr.h:86</a></div></div>
<div class="ttc" id="aa08252_html_ab86bdb08475c1c2b75755fffcb6b8275"><div class="ttname"><a href="../../d1/d86/a08252.html#ab86bdb08475c1c2b75755fffcb6b8275">NPCVendorEntry::incrtime</a></div><div class="ttdeci">uint32 incrtime</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00089">GameEventMgr.h:89</a></div></div>
<div class="ttc" id="aa08252_html_ac826dc078ef456ed93bf23175bce243d"><div class="ttname"><a href="../../d1/d86/a08252.html#ac826dc078ef456ed93bf23175bce243d">NPCVendorEntry::ExtendedCost</a></div><div class="ttdeci">uint32 ExtendedCost</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00090">GameEventMgr.h:90</a></div></div>
<div class="ttc" id="aa08256_html"><div class="ttname"><a href="../../d1/d78/a08256.html">GameEventMgr</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00097">GameEventMgr.h:98</a></div></div>
<div class="ttc" id="aa08256_html_a05276e1cc9758c37008cfafe14dec717"><div class="ttname"><a href="../../d1/d78/a08256.html#a05276e1cc9758c37008cfafe14dec717">GameEventMgr::instance</a></div><div class="ttdeci">static GameEventMgr * instance()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l00038">GameEventMgr.cpp:38</a></div></div>
<div class="ttc" id="aa08256_html_a0af4cb4225e30b14f996407a3d75d13d"><div class="ttname"><a href="../../d1/d78/a08256.html#a0af4cb4225e30b14f996407a3d75d13d">GameEventMgr::GameEventMgr</a></div><div class="ttdeci">GameEventMgr()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01657">GameEventMgr.cpp:1657</a></div></div>
<div class="ttc" id="aa08256_html_a0eb36f16c54cf394e57c862d3defc444"><div class="ttname"><a href="../../d1/d78/a08256.html#a0eb36f16c54cf394e57c862d3defc444">GameEventMgr::NextCheck</a></div><div class="ttdeci">uint32 NextCheck(uint16 entry) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l00082">GameEventMgr.cpp:82</a></div></div>
<div class="ttc" id="aa08256_html_a11767f07de64da985d77bef86b86a2c4"><div class="ttname"><a href="../../d1/d78/a08256.html#a11767f07de64da985d77bef86b86a2c4">GameEventMgr::HandleQuestComplete</a></div><div class="ttdeci">void HandleQuestComplete(uint32 quest_id)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01661">GameEventMgr.cpp:1661</a></div></div>
<div class="ttc" id="aa08256_html_a174197311760e9c22650e362368ec630"><div class="ttname"><a href="../../d1/d78/a08256.html#a174197311760e9c22650e362368ec630">GameEventMgr::LoadHolidayDates</a></div><div class="ttdeci">void LoadHolidayDates()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01006">GameEventMgr.cpp:1006</a></div></div>
<div class="ttc" id="aa08256_html_a177cd794e719b24cf1bc70fc7316a8e5"><div class="ttname"><a href="../../d1/d78/a08256.html#a177cd794e719b24cf1bc70fc7316a8e5">GameEventMgr::m_ActiveEvents</a></div><div class="ttdeci">ActiveEvents m_ActiveEvents</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00177">GameEventMgr.h:177</a></div></div>
<div class="ttc" id="aa08256_html_a1a07f3fb3ac74ddb929d00a0c5078186"><div class="ttname"><a href="../../d1/d78/a08256.html#a1a07f3fb3ac74ddb929d00a0c5078186">GameEventMgr::StartEvent</a></div><div class="ttdeci">bool StartEvent(uint16 event_id, bool overwrite=false)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l00135">GameEventMgr.cpp:135</a></div></div>
<div class="ttc" id="aa08256_html_a1ee64142406435bcde6d61fcda1733e9"><div class="ttname"><a href="../../d1/d78/a08256.html#a1ee64142406435bcde6d61fcda1733e9">GameEventMgr::mGameEvent</a></div><div class="ttdeci">GameEventDataMap mGameEvent</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00173">GameEventMgr.h:173</a></div></div>
<div class="ttc" id="aa08256_html_a23a28a5ae28efdd54deceeca15969196"><div class="ttname"><a href="../../d1/d78/a08256.html#a23a28a5ae28efdd54deceeca15969196">GameEventMgr::mGameEventNPCFlags</a></div><div class="ttdeci">GameEventNPCFlagMap mGameEventNPCFlags</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00176">GameEventMgr.h:176</a></div></div>
<div class="ttc" id="aa08256_html_a259b6e7b37520d0c23f06c6988e626c9"><div class="ttname"><a href="../../d1/d78/a08256.html#a259b6e7b37520d0c23f06c6988e626c9">GameEventMgr::IsActiveEvent</a></div><div class="ttdeci">bool IsActiveEvent(uint16 event_id)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00115">GameEventMgr.h:115</a></div></div>
<div class="ttc" id="aa08256_html_a26e2b8498a7fe67293acbf09ae1e9e8f"><div class="ttname"><a href="../../d1/d78/a08256.html#a26e2b8498a7fe67293acbf09ae1e9e8f">GameEventMgr::mGameEventPoolIds</a></div><div class="ttdeci">GameEventIdMap mGameEventPoolIds</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00172">GameEventMgr.h:172</a></div></div>
<div class="ttc" id="aa08256_html_a28ca52de327400c39c8709cd40dd1e97"><div class="ttname"><a href="../../d1/d78/a08256.html#a28ca52de327400c39c8709cd40dd1e97">GameEventMgr::Initialize</a></div><div class="ttdeci">void Initialize()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01070">GameEventMgr.cpp:1070</a></div></div>
<div class="ttc" id="aa08256_html_a2d313485105c8ef04b27833f312a2601"><div class="ttname"><a href="../../d1/d78/a08256.html#a2d313485105c8ef04b27833f312a2601">GameEventMgr::GameEventDataMap</a></div><div class="ttdeci">std::vector&lt; GameEventData &gt; GameEventDataMap</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00107">GameEventMgr.h:107</a></div></div>
<div class="ttc" id="aa08256_html_a2d4bee5a141e7042d7114ff064fe9ade"><div class="ttname"><a href="../../d1/d78/a08256.html#a2d4bee5a141e7042d7114ff064fe9ade">GameEventMgr::GameEventSpawn</a></div><div class="ttdeci">void GameEventSpawn(int16 event_id)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01320">GameEventMgr.cpp:1320</a></div></div>
<div class="ttc" id="aa08256_html_a2e48d935ab7e575ab566c28108f98579"><div class="ttname"><a href="../../d1/d78/a08256.html#a2e48d935ab7e575ab566c28108f98579">GameEventMgr::GameEventUnspawn</a></div><div class="ttdeci">void GameEventUnspawn(int16 event_id)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01393">GameEventMgr.cpp:1393</a></div></div>
<div class="ttc" id="aa08256_html_a340bf17cd48de8175a242d54e0bc88b9"><div class="ttname"><a href="../../d1/d78/a08256.html#a340bf17cd48de8175a242d54e0bc88b9">GameEventMgr::mGameEventCreatureGuids</a></div><div class="ttdeci">GameEventGuidMap mGameEventCreatureGuids</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00181">GameEventMgr.h:181</a></div></div>
<div class="ttc" id="aa08256_html_a348077472c4104a3a027f17e48fac77d"><div class="ttname"><a href="../../d1/d78/a08256.html#a348077472c4104a3a027f17e48fac77d">GameEventMgr::RemoveActiveEvent</a></div><div class="ttdeci">void RemoveActiveEvent(uint16 event_id)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00128">GameEventMgr.h:128</a></div></div>
<div class="ttc" id="aa08256_html_a35786821592979db6fe8b9df9176a359"><div class="ttname"><a href="../../d1/d78/a08256.html#a35786821592979db6fe8b9df9176a359">GameEventMgr::UnApplyEvent</a></div><div class="ttdeci">void UnApplyEvent(uint16 event_id)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01207">GameEventMgr.cpp:1207</a></div></div>
<div class="ttc" id="aa08256_html_a361d3a758f1146282aae85b4ed294c59"><div class="ttname"><a href="../../d1/d78/a08256.html#a361d3a758f1146282aae85b4ed294c59">GameEventMgr::UpdateEventQuests</a></div><div class="ttdeci">void UpdateEventQuests(uint16 event_id, bool activate)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01582">GameEventMgr.cpp:1582</a></div></div>
<div class="ttc" id="aa08256_html_a46a7a0698d46d61af6af5b836d6d404c"><div class="ttname"><a href="../../d1/d78/a08256.html#a46a7a0698d46d61af6af5b836d6d404c">GameEventMgr::UpdateEventNPCVendor</a></div><div class="ttdeci">void UpdateEventNPCVendor(uint16 event_id, bool activate)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01309">GameEventMgr.cpp:1309</a></div></div>
<div class="ttc" id="aa08256_html_a47049ee9c568f10b36c295610954992e"><div class="ttname"><a href="../../d1/d78/a08256.html#a47049ee9c568f10b36c295610954992e">GameEventMgr::GuidLowList</a></div><div class="ttdeci">std::list&lt; ObjectGuid::LowType &gt; GuidLowList</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00148">GameEventMgr.h:148</a></div></div>
<div class="ttc" id="aa08256_html_a4947451f4fb593dbc16ac29d77dd603c"><div class="ttname"><a href="../../d1/d78/a08256.html#a4947451f4fb593dbc16ac29d77dd603c">GameEventMgr::UpdateWorldStates</a></div><div class="ttdeci">void UpdateWorldStates(uint16 event_id, bool Activate)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01637">GameEventMgr.cpp:1637</a></div></div>
<div class="ttc" id="aa08256_html_a4a5a551385d8845370ebb857f6bf2b27"><div class="ttname"><a href="../../d1/d78/a08256.html#a4a5a551385d8845370ebb857f6bf2b27">GameEventMgr::hasCreatureActiveEventExcept</a></div><div class="ttdeci">bool hasCreatureActiveEventExcept(ObjectGuid::LowType creature_guid, uint16 event_id)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01553">GameEventMgr.cpp:1553</a></div></div>
<div class="ttc" id="aa08256_html_a4acee91da0694ed4493cc31756eaa000"><div class="ttname"><a href="../../d1/d78/a08256.html#a4acee91da0694ed4493cc31756eaa000">GameEventMgr::GetHolidayEventId</a></div><div class="ttdeci">uint32 GetHolidayEventId(uint32 holidayId) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01895">GameEventMgr.cpp:1895</a></div></div>
<div class="ttc" id="aa08256_html_a5028dfb5e2139cbf84a39e1ab4de383b"><div class="ttname"><a href="../../d1/d78/a08256.html#a5028dfb5e2139cbf84a39e1ab4de383b">GameEventMgr::Update</a></div><div class="ttdeci">uint32 Update()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01128">GameEventMgr.cpp:1128</a></div></div>
<div class="ttc" id="aa08256_html_a51884149cf37ed74fa6c7a44f8a06a61"><div class="ttname"><a href="../../d1/d78/a08256.html#a51884149cf37ed74fa6c7a44f8a06a61">GameEventMgr::AddActiveEvent</a></div><div class="ttdeci">void AddActiveEvent(uint16 event_id)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00127">GameEventMgr.h:127</a></div></div>
<div class="ttc" id="aa08256_html_a58234f75e541fdaeccc43ddd1c6b9c8b"><div class="ttname"><a href="../../d1/d78/a08256.html#a58234f75e541fdaeccc43ddd1c6b9c8b">GameEventMgr::StartInternalEvent</a></div><div class="ttdeci">void StartInternalEvent(uint16 event_id)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l00121">GameEventMgr.cpp:121</a></div></div>
<div class="ttc" id="aa08256_html_a61419244efe985de58d3459749ec6c86"><div class="ttname"><a href="../../d1/d78/a08256.html#a61419244efe985de58d3459749ec6c86">GameEventMgr::LoadFromDB</a></div><div class="ttdeci">void LoadFromDB()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l00240">GameEventMgr.cpp:240</a></div></div>
<div class="ttc" id="aa08256_html_a65de367ad07e0033c356f3e4559c96b7"><div class="ttname"><a href="../../d1/d78/a08256.html#a65de367ad07e0033c356f3e4559c96b7">GameEventMgr::ApplyNewEvent</a></div><div class="ttdeci">void ApplyNewEvent(uint16 event_id)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01230">GameEventMgr.cpp:1230</a></div></div>
<div class="ttc" id="aa08256_html_a6b958e82cbac452d531da25e2dba66d7"><div class="ttname"><a href="../../d1/d78/a08256.html#a6b958e82cbac452d531da25e2dba66d7">GameEventMgr::mGameEventModelEquip</a></div><div class="ttdeci">GameEventModelEquipMap mGameEventModelEquip</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00169">GameEventMgr.h:169</a></div></div>
<div class="ttc" id="aa08256_html_a70bc9ff853dd8cb95db57ad231d4b7b0"><div class="ttname"><a href="../../d1/d78/a08256.html#a70bc9ff853dd8cb95db57ad231d4b7b0">GameEventMgr::ModelEquipList</a></div><div class="ttdeci">std::list&lt; ModelEquipPair &gt; ModelEquipList</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00153">GameEventMgr.h:153</a></div></div>
<div class="ttc" id="aa08256_html_a733cc959fd929bb86442c44fa2cb3ef9"><div class="ttname"><a href="../../d1/d78/a08256.html#a733cc959fd929bb86442c44fa2cb3ef9">GameEventMgr::UpdateBattlegroundSettings</a></div><div class="ttdeci">void UpdateBattlegroundSettings()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01301">GameEventMgr.cpp:1301</a></div></div>
<div class="ttc" id="aa08256_html_a75d9f60bb8efddc6290683f0bc22bc0f"><div class="ttname"><a href="../../d1/d78/a08256.html#a75d9f60bb8efddc6290683f0bc22bc0f">GameEventMgr::mGameEventBattlegroundHolidays</a></div><div class="ttdeci">GameEventBitmask mGameEventBattlegroundHolidays</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00174">GameEventMgr.h:174</a></div></div>
<div class="ttc" id="aa08256_html_a7a78bd9b0c6f4cc32e386794955ac3b5"><div class="ttname"><a href="../../d1/d78/a08256.html#a7a78bd9b0c6f4cc32e386794955ac3b5">GameEventMgr::mGameEventVendors</a></div><div class="ttdeci">GameEventNPCVendorMap mGameEventVendors</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00168">GameEventMgr.h:168</a></div></div>
<div class="ttc" id="aa08256_html_a7b61b9926bb2e7ad9a3be4e541f9a4e8"><div class="ttname"><a href="../../d1/d78/a08256.html#a7b61b9926bb2e7ad9a3be4e541f9a4e8">GameEventMgr::mGameEventCreatureQuests</a></div><div class="ttdeci">GameEventQuestMap mGameEventCreatureQuests</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00166">GameEventMgr.h:166</a></div></div>
<div class="ttc" id="aa08256_html_a7e8911e4170a84527a7eb3d73a8a30f1"><div class="ttname"><a href="../../d1/d78/a08256.html#a7e8911e4170a84527a7eb3d73a8a30f1">GameEventMgr::mGameEventGameobjectGuids</a></div><div class="ttdeci">GameEventGuidMap mGameEventGameobjectGuids</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00182">GameEventMgr.h:182</a></div></div>
<div class="ttc" id="aa08256_html_a89b36d2ce1114ee9b9316aa1ce41ff41"><div class="ttname"><a href="../../d1/d78/a08256.html#a89b36d2ce1114ee9b9316aa1ce41ff41">GameEventMgr::SaveWorldEventStateToDB</a></div><div class="ttdeci">void SaveWorldEventStateToDB(uint16 event_id)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01733">GameEventMgr.cpp:1733</a></div></div>
<div class="ttc" id="aa08256_html_a8fb888e0cb07a113ec9096ff88ed9f32"><div class="ttname"><a href="../../d1/d78/a08256.html#a8fb888e0cb07a113ec9096ff88ed9f32">GameEventMgr::UpdateEventNPCFlags</a></div><div class="ttdeci">void UpdateEventNPCFlags(uint16 event_id)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01266">GameEventMgr.cpp:1266</a></div></div>
<div class="ttc" id="aa08256_html_a90cfd68d799f3ac60f7eaf6eaa867e01"><div class="ttname"><a href="../../d1/d78/a08256.html#a90cfd68d799f3ac60f7eaf6eaa867e01">GameEventMgr::CheckOneGameEventConditions</a></div><div class="ttdeci">bool CheckOneGameEventConditions(uint16 event_id)</div><div class="ttdoc">Runs SMART_EVENT_GAME_EVENT_START/_END SAI.</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01716">GameEventMgr.cpp:1716</a></div></div>
<div class="ttc" id="aa08256_html_a9243c0f76a791ab4f0613afc06026141"><div class="ttname"><a href="../../d1/d78/a08256.html#a9243c0f76a791ab4f0613afc06026141">GameEventMgr::ChangeEquipOrModel</a></div><div class="ttdeci">void ChangeEquipOrModel(int16 event_id, bool activate)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01469">GameEventMgr.cpp:1469</a></div></div>
<div class="ttc" id="aa08256_html_a95b7a4e78f4da9bf58cac7bba5554dcc"><div class="ttname"><a href="../../d1/d78/a08256.html#a95b7a4e78f4da9bf58cac7bba5554dcc">GameEventMgr::StartSystem</a></div><div class="ttdeci">uint32 StartSystem()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01095">GameEventMgr.cpp:1095</a></div></div>
<div class="ttc" id="aa08256_html_a986be1d18003b8288ea3d7b422fc4d9a"><div class="ttname"><a href="../../d1/d78/a08256.html#a986be1d18003b8288ea3d7b422fc4d9a">GameEventMgr::RunSmartAIScripts</a></div><div class="ttdeci">void RunSmartAIScripts(uint16 event_id, bool activate)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01788">GameEventMgr.cpp:1788</a></div></div>
<div class="ttc" id="aa08256_html_a9d1e67f8edbe01fedd10c5fb0aeac2cf"><div class="ttname"><a href="../../d1/d78/a08256.html#a9d1e67f8edbe01fedd10c5fb0aeac2cf">GameEventMgr::ActiveEvents</a></div><div class="ttdeci">std::set&lt; uint16 &gt; ActiveEvents</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00106">GameEventMgr.h:106</a></div></div>
<div class="ttc" id="aa08256_html_aa2123dfc70039ad79394bc554233a906"><div class="ttname"><a href="../../d1/d78/a08256.html#aa2123dfc70039ad79394bc554233a906">GameEventMgr::mQuestToEventConditions</a></div><div class="ttdeci">QuestIdToEventConditionMap mQuestToEventConditions</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00175">GameEventMgr.h:175</a></div></div>
<div class="ttc" id="aa08256_html_aa3fc438e41a455a600381c2d4f0bdb11"><div class="ttname"><a href="../../d1/d78/a08256.html#aa3fc438e41a455a600381c2d4f0bdb11">GameEventMgr::_gameEventSeasonalQuestsMap</a></div><div class="ttdeci">GameEventSeasonalQuestsMap _gameEventSeasonalQuestsMap</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00179">GameEventMgr.h:179</a></div></div>
<div class="ttc" id="aa08256_html_ab32f27d9d20652c91cfa6aef6c67bab1"><div class="ttname"><a href="../../d1/d78/a08256.html#ab32f27d9d20652c91cfa6aef6c67bab1">GameEventMgr::hasCreatureQuestActiveEventExcept</a></div><div class="ttdeci">bool hasCreatureQuestActiveEventExcept(uint32 quest_id, uint16 event_id)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01526">GameEventMgr.cpp:1526</a></div></div>
<div class="ttc" id="aa08256_html_ab33aa86e40a4465f89f444ba16bd962d"><div class="ttname"><a href="../../d1/d78/a08256.html#ab33aa86e40a4465f89f444ba16bd962d">GameEventMgr::NPCFlagList</a></div><div class="ttdeci">std::list&lt; GuidNPCFlagPair &gt; NPCFlagList</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00162">GameEventMgr.h:162</a></div></div>
<div class="ttc" id="aa08256_html_ab3f5d0658fb968dcc19141f20735d5d2"><div class="ttname"><a href="../../d1/d78/a08256.html#ab3f5d0658fb968dcc19141f20735d5d2">GameEventMgr::IdList</a></div><div class="ttdeci">std::list&lt; uint32 &gt; IdList</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00149">GameEventMgr.h:149</a></div></div>
<div class="ttc" id="aa08256_html_ab470698b19df4edd09f6b32fcfe120fc"><div class="ttname"><a href="../../d1/d78/a08256.html#ab470698b19df4edd09f6b32fcfe120fc">GameEventMgr::mGameEventGameObjectQuests</a></div><div class="ttdeci">GameEventQuestMap mGameEventGameObjectQuests</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00167">GameEventMgr.h:167</a></div></div>
<div class="ttc" id="aa08256_html_ab5346c6b86054d0f5f172242d59325eb"><div class="ttname"><a href="../../d1/d78/a08256.html#ab5346c6b86054d0f5f172242d59325eb">GameEventMgr::SetHolidayEventTime</a></div><div class="ttdeci">void SetHolidayEventTime(GameEventData &amp;event)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01800">GameEventMgr.cpp:1800</a></div></div>
<div class="ttc" id="aa08256_html_aba8e2aaa06b172227768debf82e99b5a"><div class="ttname"><a href="../../d1/d78/a08256.html#aba8e2aaa06b172227768debf82e99b5a">GameEventMgr::QuestRelList</a></div><div class="ttdeci">std::list&lt; QuestRelation &gt; QuestRelList</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00156">GameEventMgr.h:156</a></div></div>
<div class="ttc" id="aa08256_html_abb2f155e59b2c038456eeb06da275631"><div class="ttname"><a href="../../d1/d78/a08256.html#abb2f155e59b2c038456eeb06da275631">GameEventMgr::SendWorldStateUpdate</a></div><div class="ttdeci">void SendWorldStateUpdate(Player *player, uint16 event_id)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01749">GameEventMgr.cpp:1749</a></div></div>
<div class="ttc" id="aa08256_html_abcc4042cec52a1f35f7c160d975b83f0"><div class="ttname"><a href="../../d1/d78/a08256.html#abcc4042cec52a1f35f7c160d975b83f0">GameEventMgr::hasGameObjectActiveEventExcept</a></div><div class="ttdeci">bool hasGameObjectActiveEventExcept(ObjectGuid::LowType go_guid, uint16 event_id)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01567">GameEventMgr.cpp:1567</a></div></div>
<div class="ttc" id="aa08256_html_abd6517d99e2187dce7a8db423c8c8886"><div class="ttname"><a href="../../d1/d78/a08256.html#abd6517d99e2187dce7a8db423c8c8886">GameEventMgr::GetNPCFlag</a></div><div class="ttdeci">uint32 GetNPCFlag(Creature *cr)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01055">GameEventMgr.cpp:1055</a></div></div>
<div class="ttc" id="aa08256_html_ac955ad9b948e13cde6de5f9f3dd01d03"><div class="ttname"><a href="../../d1/d78/a08256.html#ac955ad9b948e13cde6de5f9f3dd01d03">GameEventMgr::CheckOneGameEvent</a></div><div class="ttdeci">bool CheckOneGameEvent(uint16 entry) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l00044">GameEventMgr.cpp:44</a></div></div>
<div class="ttc" id="aa08256_html_aceae3117877a732131349ccd5593b0af"><div class="ttname"><a href="../../d1/d78/a08256.html#aceae3117877a732131349ccd5593b0af">GameEventMgr::isSystemInit</a></div><div class="ttdeci">bool isSystemInit</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00178">GameEventMgr.h:178</a></div></div>
<div class="ttc" id="aa08256_html_ad7b6407e4c5fd950446c22e4a82cdc64"><div class="ttname"><a href="../../d1/d78/a08256.html#ad7b6407e4c5fd950446c22e4a82cdc64">GameEventMgr::StopEvent</a></div><div class="ttdeci">void StopEvent(uint16 event_id, bool overwrite=false)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l00194">GameEventMgr.cpp:194</a></div></div>
<div class="ttc" id="aa08256_html_adb0056cf47ac017721acb3374bafcb74"><div class="ttname"><a href="../../d1/d78/a08256.html#adb0056cf47ac017721acb3374bafcb74">GameEventMgr::StartArenaSeason</a></div><div class="ttdeci">void StartArenaSeason()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01103">GameEventMgr.cpp:1103</a></div></div>
<div class="ttc" id="aa08256_html_adcc6d8a9aaefca1ae44783598d70531f"><div class="ttname"><a href="../../d1/d78/a08256.html#adcc6d8a9aaefca1ae44783598d70531f">GameEventMgr::NPCVendorList</a></div><div class="ttdeci">std::list&lt; NPCVendorEntry &gt; NPCVendorList</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00158">GameEventMgr.h:158</a></div></div>
<div class="ttc" id="aa08256_html_adddda916da8f95d50cfa17f28f76fe91"><div class="ttname"><a href="../../d1/d78/a08256.html#adddda916da8f95d50cfa17f28f76fe91">GameEventMgr::hasGameObjectQuestActiveEventExcept</a></div><div class="ttdeci">bool hasGameObjectQuestActiveEventExcept(uint32 quest_id, uint16 event_id)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d51/a01340_source.html#l01540">GameEventMgr.cpp:1540</a></div></div>
<div class="ttc" id="aa08256_html_ae2b1a729f3af63b9dac537b6ac3b1d3f"><div class="ttname"><a href="../../d1/d78/a08256.html#ae2b1a729f3af63b9dac537b6ac3b1d3f">GameEventMgr::QuestRelation</a></div><div class="ttdeci">std::pair&lt; uint32, uint32 &gt; QuestRelation</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00155">GameEventMgr.h:155</a></div></div>
<div class="ttc" id="aa08256_html_aea098683abd57a8a9b4878eb6a3ee747"><div class="ttname"><a href="../../d1/d78/a08256.html#aea098683abd57a8a9b4878eb6a3ee747">GameEventMgr::GuidNPCFlagPair</a></div><div class="ttdeci">std::pair&lt; ObjectGuid::LowType, uint32 &gt; GuidNPCFlagPair</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00161">GameEventMgr.h:161</a></div></div>
<div class="ttc" id="aa08256_html_afca80ec9e1640a85eaae605f2e166748"><div class="ttname"><a href="../../d1/d78/a08256.html#afca80ec9e1640a85eaae605f2e166748">GameEventMgr::modifiedHolidays</a></div><div class="ttdeci">std::vector&lt; uint32 &gt; modifiedHolidays</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da4/a01343_source.html#l00183">GameEventMgr.h:183</a></div></div>
<div class="ttc" id="aa09188_html"><div class="ttname"><a href="../../db/d9f/a09188.html">Map</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/daa/a01577_source.html#l00311">Map.h:312</a></div></div>
<div class="ttc" id="aa09188_html_a1bef904cde2aa309f70873821f164630"><div class="ttname"><a href="../../db/d9f/a09188.html#a1bef904cde2aa309f70873821f164630">Map::GetObjectsStore</a></div><div class="ttdeci">MapStoredObjectTypesContainer &amp; GetObjectsStore()</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/daa/a01577_source.html#l00515">Map.h:515</a></div></div>
<div class="ttc" id="aa09188_html_aae3a929aefb05046ef304ffba10aae71"><div class="ttname"><a href="../../db/d9f/a09188.html#aae3a929aefb05046ef304ffba10aae71">Map::Instanceable</a></div><div class="ttdeci">bool Instanceable() const</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/daa/a01577_source.html#l00446">Map.h:446</a></div></div>
<div class="ttc" id="aa09188_html_abdb1b9067ac6ad5b27ec537c654a2e1a"><div class="ttname"><a href="../../db/d9f/a09188.html#abdb1b9067ac6ad5b27ec537c654a2e1a">Map::IsGridLoaded</a></div><div class="ttdeci">bool IsGridLoaded(float x, float y) const</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/daa/a01577_source.html#l00368">Map.h:368</a></div></div>
<div class="ttc" id="aa09188_html_aec8fdf932b6233dd3ee23b469d2b10a5"><div class="ttname"><a href="../../db/d9f/a09188.html#aec8fdf932b6233dd3ee23b469d2b10a5">Map::AddToMap</a></div><div class="ttdeci">bool AddToMap(T *, bool checkTransport=false)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df5/a01574_source.html#l00557">Map.cpp:557</a></div></div>
<div class="ttc" id="aa09560_html"><div class="ttname"><a href="../../d1/db9/a09560.html">Quest</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d29/a01817_source.html#l00206">QuestDef.h:207</a></div></div>
<div class="ttc" id="aa10284_html"><div class="ttname"><a href="../../db/dcb/a10284.html">WorldPackets::WorldState::UpdateWorldState</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d39/a02048_source.html#l00049">WorldStatePackets.h:50</a></div></div>
<div class="ttc" id="aa10284_html_a51fa2401d8af4c1c7848b423cb6f056f"><div class="ttname"><a href="../../db/dcb/a10284.html#a51fa2401d8af4c1c7848b423cb6f056f">WorldPackets::WorldState::UpdateWorldState::Value</a></div><div class="ttdeci">int32 Value</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d39/a02048_source.html#l00057">WorldStatePackets.h:57</a></div></div>
<div class="ttc" id="aa10284_html_a76a4c5d6a06ce8d86a2d3f04f68e838d"><div class="ttname"><a href="../../db/dcb/a10284.html#a76a4c5d6a06ce8d86a2d3f04f68e838d">WorldPackets::WorldState::UpdateWorldState::Write</a></div><div class="ttdeci">WorldPacket const * Write() override</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d13/a02045_source.html#l00040">WorldStatePackets.cpp:40</a></div></div>
<div class="ttc" id="aa10284_html_aa73278b324822f509f48e6edcdaed457"><div class="ttname"><a href="../../db/dcb/a10284.html#aa73278b324822f509f48e6edcdaed457">WorldPackets::WorldState::UpdateWorldState::VariableID</a></div><div class="ttdeci">int32 VariableID</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d39/a02048_source.html#l00056">WorldStatePackets.h:56</a></div></div>
<div class="ttc" id="aa30040_html"><div class="ttname"><a href="../../df/d5d/a30040.html">BattlemasterListEntry</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d7a/a04262_source.html#l00603">DBCStructure.h:604</a></div></div>
<div class="ttc" id="aa30040_html_a3f70ffbb1abb5a96fe91c2eec3682c8b"><div class="ttname"><a href="../../df/d5d/a30040.html#a3f70ffbb1abb5a96fe91c2eec3682c8b">BattlemasterListEntry::HolidayWorldStateId</a></div><div class="ttdeci">uint32 HolidayWorldStateId</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d7a/a04262_source.html#l00612">DBCStructure.h:612</a></div></div>
<div class="ttc" id="aa30196_html"><div class="ttname"><a href="../../d1/d3d/a30196.html">HolidaysEntry</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d7a/a04262_source.html#l01114">DBCStructure.h:1115</a></div></div>
<div class="ttc" id="aa30196_html_a082b59a0ead8223e590cbb371f3ad122"><div class="ttname"><a href="../../d1/d3d/a30196.html#a082b59a0ead8223e590cbb371f3ad122">HolidaysEntry::CalendarFilterType</a></div><div class="ttdeci">int32 CalendarFilterType</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d7a/a04262_source.html#l01126">DBCStructure.h:1126</a></div></div>
<div class="ttc" id="aa30196_html_a10cae1b1fbb91930209a714c545b129b"><div class="ttname"><a href="../../d1/d3d/a30196.html#a10cae1b1fbb91930209a714c545b129b">HolidaysEntry::Duration</a></div><div class="ttdeci">uint32 Duration[MAX_HOLIDAY_DURATIONS]</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d7a/a04262_source.html#l01117">DBCStructure.h:1117</a></div></div>
<div class="ttc" id="aa30196_html_ac5b08b086ef0668508ea9da48642e95b"><div class="ttname"><a href="../../d1/d3d/a30196.html#ac5b08b086ef0668508ea9da48642e95b">HolidaysEntry::Date</a></div><div class="ttdeci">uint32 Date[MAX_HOLIDAY_DATES]</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d7a/a04262_source.html#l01118">DBCStructure.h:1118</a></div></div>
<div class="ttc" id="aa30196_html_afa2d93998650f88e62bfa76807961274"><div class="ttname"><a href="../../d1/d3d/a30196.html#afa2d93998650f88e62bfa76807961274">HolidaysEntry::Looping</a></div><div class="ttdeci">uint32 Looping</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d7a/a04262_source.html#l01120">DBCStructure.h:1120</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_f7e0c1f1a42fff32e0ff6393fb6a6d60.html">azerothcore-wotlk</a></li><li class="navelem"><a class="el" href="../../dir_ee82ee7794f367a672177b3bd595def7.html">src</a></li><li class="navelem"><a class="el" href="../../dir_cfd62069f43c6d31c3f6e771507ef478.html">server</a></li><li class="navelem"><a class="el" href="../../dir_355661791026b33f9301c754e4db8b50.html">game</a></li><li class="navelem"><a class="el" href="../../dir_be7ddcf5a4570b7daa864eaef60ffbc7.html">Events</a></li><li class="navelem"><a class="el" href="../../d7/d51/a01340.html">GameEventMgr.cpp</a></li>
    <li class="footer">Generated on Wed Nov 9 2022 22:09:31 for AzeorthCore by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
